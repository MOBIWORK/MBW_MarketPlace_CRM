import{_ as _e,a as fe,A as pe,C as ve,b as ge,L as be,S as ye,c as xe}from"./SLASection-ffc44f4e.js";import{D as Ce,a0 as he,C as we,Q as P,a1 as ke,a2 as Ve,H as Ie,G as _,c as T,s as z,o as d,b as p,u as s,a as f,w as i,k as v,f as o,F as q,K as x,J as D,a3 as G,P as W,a4 as ze,a5 as Ue,a6 as Le,a7 as J,n as H,N as K,a8 as Ae,d as r,t as C,a9 as Se,L as $e,aa as Ne,M as U,ab as F,ac as Ee,x as Me,ad as Te,ae as De,af as Q,ag as Fe}from"./index-fd4111d0.js";import{I as Be}from"./IndicatorIcon-b09272ab.js";import{C as Re}from"./CameraIcon-5987e2d3.js";import{_ as je,a as Oe}from"./LayoutHeader-4431816a.js";import{s as Pe,_ as qe}from"./statuses-ded37fc4.js";import{_ as Ge}from"./CustomActions-78928ae0.js";import{o as We}from"./organizations-47b1381a.js";import{c as X,w as Je}from"./settings-c0b8fd73.js";import{F as He}from"./FileUploader-3fcaee7d.js";import{_ as Y}from"./Switch.vue_vue_type_script_setup_true_lang-4098f148.js";import{_ as Ke}from"./Tabs-9726eea5.js";import"./FadedScrollableDiv-b9eabb0e.js";import"./CalendarIcon-7eb5de62.js";import"./EmailTemplateModal-754da216.js";import"./TaskModal-3d86a4d5.js";import"./DatetimePicker-76bd67f8.js";import"./label-3c481436.js";const Qe={key:1,class:"flex h-full overflow-hidden"},Xe={class:"flex items-center justify-start gap-5 border-b p-5"},Ye={class:"group relative size-12"},Ze={class:"z-1 absolute bottom-0.5 left-0 right-0.5 flex h-9 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-3 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(12px 0 0 0)","clip-path":"inset(12px 0 0 0)"}},ea={class:"flex flex-col gap-2.5 truncate"},aa={class:"truncate text-2xl font-medium"},ta={class:"flex gap-1.5"},sa={key:1,class:"flex flex-1 flex-col justify-between overflow-hidden"},la={class:"flex flex-col overflow-y-auto"},oa={class:"mb-3 flex justify-between items-center"},na={class:"flex items-center gap-2"},ia={class:"block text-base"},da={class:"ml-6"},ra={key:1,class:"mt-2.5 text-base text-gray-600"},ua={class:"mb-3 mt-6 flex items-center justify-between"},ma={class:"flex items-center gap-2"},ca={class:"block text-base"},_a={class:"ml-6"},fa={key:1,class:"mt-2.5 text-base text-gray-600"},Na={__name:"Lead",props:{leadId:{type:String,required:!0}},setup(Z){const{$dialog:ee,makeCall:ae}=Ce(),{getContactByName:h,contacts:te}=he(),{organizations:se}=We(),{statusOptions:le,getLeadStatus:oe}=Pe(),L=we(),A=Z,t=P({url:"crm.fcrm.doctype.crm_lead.api.get_lead",params:{name:A.leadId},cache:["lead",A.leadId],transform(a){for(let e=0;e<a.doctype_fields.length;e++)for(let n=0;n<a.doctype_fields[e].fields.length;n++)a.doctype_fields[e].fields[n].name=="lead_owner"&&(a.doctype_fields[e].fields[n].hidden_delete=!0);return a},onSuccess:a=>{ke(a),Ve(a,{doc:a,$dialog:ee,router:L,updateField:g,createToast:x,deleteDoc:me,call:D})}});Ie(()=>{t.data||(t.fetch(),window.location.hash!=null&&window.location.hash!=""&&(w.value=4))});const S=_(!1),$=_(!1);function ne(){t.fetch()}function B(a,e,n){if(e=Array.isArray(a)?"":e,!Array.isArray(a)&&ie(a,e))return;let m=1;P({url:"frappe.client.set_value",params:{doctype:"CRM Lead",name:A.leadId,fieldname:a,value:e},auto:!0,onSuccess:()=>{t.reload(),S.value=!0,x({title:__("Lead updated"),icon:"check",iconClasses:"text-green-600"}),n==null||n()},onError:E=>{var I;m>0&&(x({title:__("Error updating lead"),text:__((I=E.messages)==null?void 0:I[0]),icon:"x",iconClasses:"text-red-600"}),m-=1)}})}function ie(a,e){var m;let n=t.data.all_fields||{};return(m=n[a])!=null&&m.reqd&&!e?(x({title:__("Error Updating Lead"),text:__("{0} is a required field",[n[a].label]),icon:"x",iconClasses:"text-red-600"}),!0):!1}const de=T(()=>{let a=[{label:__("Leads"),route:{name:"Leads"}}];return a.push({label:t.data.first_name||__("Untitled"),route:{name:"Lead",params:{leadId:t.data.name}}}),a}),w=_(0),re=T(()=>[{name:"Activity",label:__("Activity"),icon:pe},{name:"Emails",label:__("Emails"),icon:G},{name:"Calls",label:__("Calls"),icon:W,condition:()=>X.value},{name:"Tasks",label:__("Tasks"),icon:ze},{name:"Notes",label:__("Notes"),icon:Ue},{name:"Comment",label:__("Comment"),icon:ve},{name:"WhatsApp",label:__("WhatsApp"),icon:Le,condition:()=>Je.value}].filter(e=>e.condition?e.condition():!0));function ue(a){let e=a.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(e))return __("Only PNG and JPG images are allowed")}const N=T(()=>{let a=t.data;return a?a.doctype_fields:[]});function g(a,e,n){B(a,e,()=>{t.data[a]=e,n==null||n()}),a=="status"&&e=="Chất lượng"&&(k.value=!0)}async function me(a){await D("frappe.client.delete",{doctype:"CRM Lead",name:a}),L.push({name:"Leads"})}const k=_(!1),b=_(!1),y=_(!1),c=_(""),V=_("");async function R(a){let e=!1;if(b.value&&!c.value){x({title:__("Error"),text:__("Please select an existing contact"),icon:"x",iconClasses:"text-red-600"});return}if(y.value&&!V.value){x({title:__("Error"),text:__("Please select an existing organization"),icon:"x",iconClasses:"text-red-600"});return}if(b.value&&c.value&&(t.data.salutation=h(c.value).salutation,t.data.first_name=h(c.value).first_name,t.data.last_name=h(c.value).last_name,t.data.email_id=h(c.value).email_id,t.data.mobile_no=h(c.value).mobile_no,b.value=!1,e=!0),y.value&&V.value&&(t.data.organization=V.value,y.value=!1,e=!0),e)B({salutation:t.data.salutation,first_name:t.data.first_name,last_name:t.data.last_name,email_id:t.data.email_id,mobile_no:t.data.mobile_no,organization:t.data.organization},"",()=>R(!0)),k.value=!1;else{let n=await D("crm.api.doc.convert_to_deal",{lead:t.data.name});n&&(a&&(await se.reload(),await te.reload()),L.push({name:"Deal",params:{dealId:n}}))}}const j=_(null);function ce(){j.value.emailBox.show=!0}return(a,e)=>{var O;const n=z("FeatherIcon"),m=z("Button"),E=z("ErrorMessage"),I=z("Dialog");return d(),p(q,null,[s(t).data?(d(),f(je,{key:0},{"left-header":i(()=>[o(s(Oe),{items:de.value},null,8,["items"])]),"right-header":i(()=>{var l;return[s(t).data._customActions?(d(),f(Ge,{key:0,actions:s(t).data._customActions},null,8,["actions"])):v("",!0),(d(),f(J(((l=s(t).data._assignedTo)==null?void 0:l.length)==1?"Button":"div"),null,{default:i(()=>[o(qe,{avatars:s(t).data._assignedTo,onClick:e[0]||(e[0]=u=>$.value=!0)},null,8,["avatars"])]),_:1})),o(s(K),{options:s(le)("lead",g)},{default:i(({open:u})=>[o(m,{label:a.__(s(t).data.status),class:H(s(oe)(s(t).data.status).colorClass)},{prefix:i(()=>[o(Be)]),suffix:i(()=>[o(n,{name:u?"chevron-up":"chevron-down",class:"h-4"},null,8,["name"])]),_:2},1032,["label","class"])]),_:1},8,["options"]),o(m,{label:a.__("Convert to Deal"),variant:"solid",onClick:e[1]||(e[1]=u=>k.value=!0)},null,8,["label"])]}),_:1})):v("",!0),(O=s(t))!=null&&O.data?(d(),p("div",Qe,[o(s(Ke),{modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=l=>w.value=l),tabs:re.value},{default:i(({tab:l})=>[o(ge,{ref_key:"activities",ref:j,doctype:"CRM Lead",title:l.name,reload:S.value,"onUpdate:reload":e[2]||(e[2]=u=>S.value=u),tabIndex:w.value,"onUpdate:tabIndex":e[3]||(e[3]=u=>w.value=u),modelValue:s(t),"onUpdate:modelValue":e[4]||(e[4]=u=>Ae(t)?t.value=u:null)},null,8,["title","reload","tabIndex","modelValue"])]),_:1},8,["modelValue","tabs"]),o(_e,{class:"flex flex-col justify-between border-l",side:"right"},{default:i(()=>[r("div",{class:"flex h-10.5 cursor-copy items-center border-b px-5 py-2.5 text-lg font-medium",onClick:e[6]||(e[6]=l=>s(Se)(s(t).data.name))},C(a.__(s(t).data.name)),1),o(s(He),{onSuccess:e[10]||(e[10]=l=>g("image",l.file_url)),validateFile:ue},{default:i(({openFileSelector:l,error:u})=>[r("div",Xe,[r("div",Ye,[o(s($e),{size:"3xl",class:"size-12",label:s(t).data.first_name||a.__("Untitled"),image:s(t).data.image},null,8,["label","image"]),(d(),f(J(s(t).data.image?s(K):"div"),Ne(s(t).data.image?{options:[{icon:"upload",label:s(t).data.image?a.__("Change image"):a.__("Upload image"),onClick:l},{icon:"trash-2",label:a.__("Remove image"),onClick:()=>g("image","")}]}:{onClick:l},{class:"!absolute bottom-0 left-0 right-0"}),{default:i(()=>[r("div",Ze,[o(Re,{class:"size-4 cursor-pointer text-white"})])]),_:2},1040))]),r("div",ea,[o(s(U),{text:s(t).data.lead_name||a.__("Set first name")},{default:i(()=>[r("div",aa,C(s(t).data.lead_name||a.__("Untitled")),1)]),_:1},8,["text"]),r("div",ta,[s(X)?(d(),f(s(U),{key:0,text:a.__("Make a call")},{default:i(()=>[o(m,{class:"h-7 w-7",onClick:e[7]||(e[7]=()=>s(t).data.mobile_no?s(ae)(s(t).data.mobile_no):s(F)(a.__("No phone number set")))},{default:i(()=>[o(W,{class:"h-4 w-4"})]),_:1})]),_:1},8,["text"])):v("",!0),o(s(U),{text:a.__("Send an email")},{default:i(()=>[o(m,{class:"h-7 w-7"},{default:i(()=>[o(G,{class:"h-4 w-4",onClick:e[8]||(e[8]=M=>s(t).data.email?ce():s(F)(a.__("No email set")))})]),_:1})]),_:1},8,["text"]),o(s(U),{text:a.__("Go to website")},{default:i(()=>[o(m,{class:"h-7 w-7"},{default:i(()=>[o(be,{class:"h-4 w-4",onClick:e[9]||(e[9]=M=>s(t).data.website?s(Ee)(s(t).data.website):s(F)(a.__("No website set")))})]),_:1})]),_:1},8,["text"])]),o(E,{message:a.__(u)},null,8,["message"])])])]),_:1}),s(t).data.sla_status?(d(),f(ye,{key:0,modelValue:s(t).data,"onUpdate:modelValue":e[11]||(e[11]=l=>s(t).data=l),onUpdateField:g},null,8,["modelValue"])):v("",!0),N.value.length?(d(),p("div",sa,[r("div",la,[(d(!0),p(q,null,Me(N.value,(l,u)=>(d(),p("div",{key:l.label,class:H(["flex flex-col p-3",{"border-b":u!==N.value.length-1}])},[o(Te,{"is-opened":l.opened,label:l.label},{default:i(()=>[o(xe,{fields:l.fields,modelValue:s(t).data,"onUpdate:modelValue":e[12]||(e[12]=M=>s(t).data=M),onUpdate:g},null,8,["fields","modelValue"])]),_:2},1032,["is-opened","label"])],2))),128))])])):v("",!0)]),_:1})])):v("",!0),s(t).data?(d(),f(fe,{key:2,doc:s(t).data,modelValue:$.value,"onUpdate:modelValue":e[13]||(e[13]=l=>$.value=l),assignees:s(t).data._assignedTo,"onUpdate:assignees":e[14]||(e[14]=l=>s(t).data._assignedTo=l),onUpdate:ne},null,8,["doc","modelValue","assignees"])):v("",!0),o(I,{modelValue:k.value,"onUpdate:modelValue":e[19]||(e[19]=l=>k.value=l),options:{title:a.__("Convert to Deal"),size:"xl",actions:[{label:a.__("Convert"),variant:"solid",onClick:R}]}},{"body-content":i(()=>[r("div",oa,[r("div",na,[o(De,{class:"h-4 w-4"}),r("label",ia,C(a.__("Select organization from the list")),1)]),o(s(Y),{modelValue:y.value,"onUpdate:modelValue":e[15]||(e[15]=l=>y.value=l)},null,8,["modelValue"])]),r("div",da,[y.value?(d(),f(Q,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:V.value,doctype:"CRM Organization",onChange:e[16]||(e[16]=l=>V.value=l),emptyText:"No organization"},null,8,["value"])):(d(),p("div",ra,C(a.__("New organization will be created based on the data in details section")),1))]),r("div",ua,[r("div",ma,[o(Fe,{class:"h-4 w-4"}),r("label",ca,C(a.__("Select contact from the list")),1)]),o(s(Y),{modelValue:b.value,"onUpdate:modelValue":e[17]||(e[17]=l=>b.value=l)},null,8,["modelValue"])]),r("div",_a,[b.value?(d(),f(Q,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:c.value,doctype:"FCRM Contact",onChange:e[18]||(e[18]=l=>c.value=l),emptyText:"No contact"},null,8,["value"])):(d(),p("div",fa,C(a.__("New contact will be created based on the person's details")),1))])]),_:1},8,["modelValue","options"])],64)}}};export{Na as default};
//# sourceMappingURL=Lead-367d6596.js.map
