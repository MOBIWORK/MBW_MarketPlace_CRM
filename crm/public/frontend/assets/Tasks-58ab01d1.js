import{_ as j}from"./CustomActions-4bf9057a.js";import{m as P,u as E,a as q,g as O,w as J,r as c,o as W,s as G,c as N,b as I,d as U,e as d,f as _,h as s,i as p,j as m,F as D,k as H,l as x,t as Y,N as S,v as L,x as F,q as $,a_ as K,aY as Q,p as X,D as Z,y as ee,L as te,A as ae,M as oe,V as se,R as le}from"./index-d8c5d38f.js";import{_ as ne,a as ue}from"./LayoutHeader-13bffee4.js";import{_ as re}from"./ViewControls-05350539.js";import{C as ie}from"./CalendarIcon-dc888056.js";import{_ as de}from"./EditValueModal-75518ecd.js";import{_ as me,a as ce,b as pe,c as _e,d as fe,e as ve}from"./ListView-ccb17f09.js";import{_ as ke}from"./DatePicker-e85256ef.js";import{T as Ce}from"./TaskModal-54fd8fcc.js";import"./EditIcon-4b2b470e.js";import"./DatetimePicker-5559de25.js";import"./label-78a9a0c4.js";const ye={key:0},ge={class:"flex items-center gap-2 truncate text-base"},we={key:0,class:"truncate"},Te={key:0},Ve={key:1},be={key:2},Me=["onClick"],he={key:1},xe=["onClick"],$e={__name:"TasksListView",props:P({rows:{type:Array,required:!0},columns:{type:Array,required:!0},options:{type:Object,default:()=>({selectable:!0,showTooltip:!0,resizeColumn:!1,totalCount:0,rowCount:0})}},{modelValue:{},modelModifiers:{},list:{},listModifiers:{}}),emits:P(["loadMore","updatePageCount","showTask","columnWidthUpdated","applyFilter"],["update:modelValue","update:list"]),setup(f,{expose:z,emit:A}){const C=A,y=E(f,"modelValue"),k=E(f,"list"),n=q(),{$dialog:T}=O();J(y,(r,a)=>{r!==a&&C("updatePageCount",r)});const g=c(!1),V=c([]),b=c(()=>{});function h(r,a){V.value=r,g.value=!0,b.value=a}function w(r,a){T({title:__("Delete"),message:__("Are you sure you want to delete {0} item(s)?",[r.size]),variant:"danger",actions:[{label:__("Delete"),variant:"solid",theme:"red",onClick:l=>{N("frappe.desk.reportview.delete_items",{items:JSON.stringify(Array.from(r)),doctype:"CRM Task"}).then(()=>{I({title:__("Deleted successfully"),icon:"check",iconClasses:"text-green-600"}),a(),k.value.reload(),l()})}}]})}const M=c([]);function R(r,a){return[{label:__("Edit"),onClick:()=>h(r,a)},{label:__("Delete"),onClick:()=>w(r,a)}]}return W(()=>{var r,a,l;(r=k.value)!=null&&r.data&&(G(k.value.data,{list:k.value,call:N,createToast:I,$dialog:T,router:n}),M.value=((l=(a=k.value)==null?void 0:a.data)==null?void 0:l.listActions)||[])}),z({customListActions:M}),(r,a)=>{const l=U("FormControl"),e=U("Button");return d(),_(D,null,[s(m(ve),{columns:f.columns,rows:f.rows,options:{onRowClick:o=>C("showTask",o.name),selectable:f.options.selectable,showTooltip:f.options.showTooltip,resizeColumn:f.options.resizeColumn},"row-key":"name"},{default:p(()=>[s(m(me),{class:"mx-5",onColumnWidthUpdated:a[0]||(a[0]=o=>C("columnWidthUpdated"))}),s(m(ce),{id:"list-rows"},{default:p(()=>[(d(!0),_(D,null,H(f.rows,o=>(d(),x(m(_e),{class:"mx-5",key:o.name,row:o},{default:p(({idx:u,column:t,item:i})=>[t.key==="due_date"||t.key==="remind_task"?(d(),_("div",ye,[s(m(Y),{text:m(S)(i,"ddd, MMM D, YYYY | hh:mm a")},{default:p(()=>[L("div",ge,[s(ie),i?(d(),_("div",we,F(m(S)(i,"D MMM, hh:mm a")),1)):$("",!0)])]),_:2},1032,["text"])])):(d(),x(m(pe),{key:1,item:i},{prefix:p(()=>[t.key==="status"?(d(),_("div",Te,[s(K,{status:i},null,8,["status"])])):t.key==="priority"?(d(),_("div",Ve,[s(Q,{priority:i},null,8,["priority"])])):t.key==="assigned_to"?(d(),_("div",be,[i.full_name?(d(),x(m(X),{key:0,class:"flex items-center",image:i.user_image,label:i.full_name,size:"sm"},null,8,["image","label"])):$("",!0)])):$("",!0)]),default:p(({label:v})=>[["modified","creation"].includes(t.key)?(d(),_("div",{key:0,class:"truncate text-base",onClick:B=>C("applyFilter",{event:B,idx:u,column:t,item:i})},[s(m(Y),{text:i.label},{default:p(()=>[L("div",null,F(i.timeAgo),1)]),_:2},1032,["text"])],8,Me)):t.type==="Check"?(d(),_("div",he,[s(l,{type:"checkbox",modelValue:i,disabled:!0,class:"text-gray-900"},null,8,["modelValue"])])):(d(),_("div",{key:2,class:"truncate text-base",onClick:B=>C("applyFilter",{event:B,idx:u,column:t,item:i})},F(r.__(v)),9,xe))]),_:2},1032,["item"]))]),_:2},1032,["row"]))),128))]),_:1}),s(m(fe),null,{actions:p(({selections:o,unselectAll:u})=>[s(m(Z),{options:R(o,u)},{default:p(()=>[s(e,{icon:"more-horizontal",variant:"ghost"})]),_:2},1032,["options"])]),_:1})]),_:1},8,["columns","rows","options"]),s(m(ke),{class:"border-t px-5 py-2",modelValue:y.value,"onUpdate:modelValue":a[1]||(a[1]=o=>y.value=o),options:{rowCount:f.options.rowCount,totalCount:f.options.totalCount},onLoadMore:a[2]||(a[2]=o=>C("loadMore"))},null,8,["modelValue","options"]),s(de,{modelValue:g.value,"onUpdate:modelValue":a[3]||(a[3]=o=>g.value=o),unselectAll:b.value,"onUpdate:unselectAll":a[4]||(a[4]=o=>b.value=o),doctype:"CRM Task",selectedValues:V.value,onReload:a[5]||(a[5]=o=>k.value.reload())},null,8,["modelValue","unselectAll","selectedValues"])],64)}}},Ae={key:1,class:"flex h-full items-center justify-center"},Fe={class:"flex flex-col items-center gap-3 text-xl font-medium text-gray-500"},We={__name:"Tasks",setup(f){const z=[{label:__("Tasks"),route:{name:"Tasks"}}],{getUser:A}=ee(),{roles:C}=te(),y=c(null),k=c(!1);W(()=>{let l=C.data;for(let e=0;e<l.length;e++)if(l[e]=="System Manager"){k.value=!0;break}});const n=c({}),T=c(1),g=c(1),V=c(20),b=c(null),h=ae(()=>{var l,e,o;return(e=(l=n.value)==null?void 0:l.data)!=null&&e.data?(o=n.value)==null?void 0:o.data.data.map(u=>{var i;let t={};return(i=n.value)==null||i.data.rows.forEach(v=>{t[v]=u[v],["modified","creation"].includes(v)?t[v]={label:S(u[v],le),timeAgo:__(oe(u[v]))}:v=="assigned_to"&&(t[v]={label:u.assigned_to&&A(u.assigned_to).full_name,...u.assigned_to&&A(u.assigned_to)})}),t}):[]}),w=c(!1),M=c({name:"",title:"",description:"",assigned_to:"",due_date:"",remind_task:"",status:"Backlog",priority:"Low",reference_doctype:"CRM Lead",reference_docname:""});function R(l){var o,u;let e=(o=h.value)==null?void 0:o.find(t=>t.name===l);M.value={name:e.name,title:e.title,description:e.description,assigned_to:((u=e.assigned_to)==null?void 0:u.email)||"",due_date:e.due_date,remind_task:e.remind_task,status:e.status,priority:e.priority,reference_doctype:e.reference_doctype,reference_docname:e.reference_docname},w.value=!0}function r(){M.value={name:"",title:"",description:"",assigned_to:"",due_date:"",remind_task:"",status:"Backlog",priority:"Low",reference_doctype:"CRM Lead",reference_docname:""},w.value=!0}function a(){n.value.reload()}return(l,e)=>{const o=U("FeatherIcon"),u=U("Button");return d(),_(D,null,[s(ne,null,{"left-header":p(()=>[s(m(ue),{items:z})]),"right-header":p(()=>{var t;return[(t=y.value)!=null&&t.customListActions?(d(),x(j,{key:0,actions:y.value.customListActions},null,8,["actions"])):$("",!0),s(u,{variant:"solid",label:l.__("Create"),onClick:r},{prefix:p(()=>[s(o,{name:"plus",class:"h-4"})]),_:1},8,["label"])]}),_:1}),s(re,{ref_key:"viewControls",ref:b,modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=t=>n.value=t),loadMore:T.value,"onUpdate:loadMore":e[1]||(e[1]=t=>T.value=t),resizeColumn:g.value,"onUpdate:resizeColumn":e[2]||(e[2]=t=>g.value=t),updatedPageCount:V.value,"onUpdate:updatedPageCount":e[3]||(e[3]=t=>V.value=t),doctype:"CRM Task",showElement:!0,showFuncImport:!1,showFuncConvertTaskCustomer:k.value,placeholderText:l.__("Search task"),onAfterConvertTaskCustomer:e[4]||(e[4]=t=>a())},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount","showFuncConvertTaskCustomer","placeholderText"]),n.value.data&&h.value.length?(d(),x($e,{key:0,ref_key:"tasksListView",ref:y,modelValue:n.value.data.page_length_count,"onUpdate:modelValue":e[5]||(e[5]=t=>n.value.data.page_length_count=t),list:n.value,"onUpdate:list":e[6]||(e[6]=t=>n.value=t),rows:h.value,columns:n.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:n.value.data.row_count,totalCount:n.value.data.total_count},onLoadMore:e[7]||(e[7]=()=>T.value++),onColumnWidthUpdated:e[8]||(e[8]=()=>g.value++),onUpdatePageCount:e[9]||(e[9]=t=>V.value=t),onShowTask:R,onApplyFilter:e[10]||(e[10]=t=>b.value.applyFilter(t))},null,8,["modelValue","list","rows","columns","options"])):n.value.data?(d(),_("div",Ae,[L("div",Fe,[s(se,{class:"h-10 w-10"}),L("span",null,F(l.__("No {0} Found",[l.__("Tasks")])),1),s(u,{label:l.__("Create"),onClick:e[11]||(e[11]=t=>w.value=!0)},{prefix:p(()=>[s(o,{name:"plus",class:"h-4"})]),_:1},8,["label"])])])):$("",!0),s(Ce,{modelValue:w.value,"onUpdate:modelValue":e[12]||(e[12]=t=>w.value=t),reloadTasks:n.value,"onUpdate:reloadTasks":e[13]||(e[13]=t=>n.value=t),task:M.value},null,8,["modelValue","reloadTasks","task"])],64)}}};export{We as default};
//# sourceMappingURL=Tasks-58ab01d1.js.map
