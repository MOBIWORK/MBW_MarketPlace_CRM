import{g as Z,r as x,a as ee,b5 as ae,z as y,ab as M,x as oe,aE as j,d as v,e as s,f as d,j as a,l as _,i as m,p as l,h as i,R as te,F as ne,c as B,a1 as se,$ as ie,a0 as le,G as E,E as F,t as r,_ as re,U as ce,Q as k,D as de,v as u,aj as V,n as $,I as N}from"./index-57f524e0.js";import{_ as me,a as ue}from"./LayoutHeader-1b75ebc1.js";import{F as _e}from"./FileUploader-46b74999.js";import{_ as ge}from"./Tabs-844731e8.js";import{_ as pe,W as fe,T as ye}from"./OrganizationModal-6f1ca8c8.js";import{_ as be}from"./DealsListView-272c1ebc.js";import{_ as he}from"./ContactsListView-e31d8038.js";import{E as ve}from"./EditIcon-79477f55.js";import{C as we}from"./CameraIcon-b4c1328d.js";import{s as ze}from"./statuses-725e45e6.js";import"./Fields-05088d1a.js";import"./IndicatorIcon-42fe5203.js";import"./Link-95b990b4.js";import"./EditValueModal-38ec6b00.js";import"./DatePicker-c2c1e28a.js";import"./label-cf4377fb.js";import"./ListView-59a15338.js";const xe={key:1,class:"flex flex-1 flex-col overflow-hidden"},ke={class:"flex items-center justify-start gap-6 p-5"},Ce={class:"group relative h-24 w-24"},Ie={class:"z-1 absolute bottom-0 left-0 right-0 flex h-13 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-3 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(12px 0 0 0)","clip-path":"inset(12px 0 0 0)"}},Oe={class:"flex flex-col justify-center gap-0.5"},De={class:"text-3xl font-semibold text-gray-900"},Re={class:"flex items-center gap-2 text-base text-gray-700"},Me={key:0,class:"flex items-center gap-1.5"},je={class:""},Be={key:1,class:"text-3xl leading-[0] text-gray-600"},Ee={key:2,class:"flex items-center gap-1.5"},Fe={class:""},Ve={key:3,class:"text-3xl leading-[0] text-gray-600"},$e={key:4,class:"flex items-center gap-1.5"},Ne={class:""},Se={key:5,class:"text-3xl leading-[0] text-gray-600"},Ue={key:6,class:"flex items-center gap-1.5"},Le={class:""},Te={key:7,class:"text-3xl leading-[0] text-gray-600"},Ae={class:"mt-2 flex gap-1.5"},Pe={key:2,class:"grid flex-1 place-items-center text-xl font-medium text-gray-500"},Ge={class:"flex flex-col items-center justify-center space-y-3"},ra={__name:"Organization",props:{organizationId:{type:String,required:!0}},setup(S){const c=S,{$dialog:U}=Z(),{getDealStatus:L}=ze(),b=x(!1),w=x(!1),T=ee(),o=ae({doctype:"CRM Organization",name:c.organizationId,cache:["organization",c.organizationId],fields:["*"],auto:!0}),A=y(()=>{let e=[{label:__("Organizations"),route:{name:"Organizations"}}];return e.push({label:c.organizationId,route:{name:"Organization",params:{organizationId:c.organizationId}}}),e});function P(e){let t=e.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(t))return __("Only PNG and JPG images are allowed")}async function C(e){await B("frappe.client.set_value",{doctype:"CRM Organization",name:c.organizationId,fieldname:"organization_logo",value:(e==null?void 0:e.file_url)||""}),o.reload()}async function G(){U({title:__("Delete organization"),message:__("Are you sure you want to delete this organization?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",async onClick(e){await B("frappe.client.delete",{doctype:"CRM Organization",name:c.organizationId}),e(),T.push({name:"Organizations"})}}]})}function W(e){return e&&e.replace(/^(?:https?:\/\/)?(?:www\.)?/i,"")}const p=x(0),q=[{label:"Deals",icon:M(se,{class:"h-4 w-4"}),count:y(()=>{var e;return(e=O.data)==null?void 0:e.length})},{label:"Contacts",icon:M(ie,{class:"h-4 w-4"}),count:y(()=>{var e;return(e=D.data)==null?void 0:e.length})}],{getUser:I}=oe(),O=j({type:"list",doctype:"CRM Deal",cache:["deals",c.organizationId],fields:["name","organization","annual_revenue","status","email","mobile_no","deal_owner","modified"],filters:{organization:c.organizationId},orderBy:"modified desc",pageLength:20,auto:!0}),D=j({type:"list",doctype:"Contact",cache:["contacts",c.organizationId],fields:["name","full_name","image","email_id","mobile_no","company_name","modified"],filters:{company_name:c.organizationId},orderBy:"modified desc",pageLength:20,auto:!0}),f=y(()=>{let e=[];return e=p.value?D:O,e.data?e.data.map(t=>p.value?Q(t):J(t)):[]}),R=y(()=>p.value===0?H:K);function J(e){var t,g;return{name:e.name,organization:{label:e.organization,logo:(t=c.organization)==null?void 0:t.organization_logo},annual_revenue:le(e.annual_revenue),status:{label:e.status,color:(g=L(e.status))==null?void 0:g.iconColorClass},email:e.email,mobile_no:e.mobile_no,deal_owner:{label:e.deal_owner&&I(e.deal_owner).full_name,...e.deal_owner&&I(e.deal_owner)},modified:{label:E(e.modified,N),timeAgo:__(F(e.modified))}}}function Q(e){var t;return{name:e.name,full_name:{label:e.full_name,image_label:e.full_name,image:e.image},email:e.email_id,mobile_no:e.mobile_no,company_name:{label:e.company_name,logo:(t=c.organization)==null?void 0:t.organization_logo},modified:{label:E(e.modified,N),timeAgo:__(F(e.modified))}}}const H=[{label:__("Organization"),key:"organization",width:"11rem"},{label:__("Amount"),key:"annual_revenue",width:"9rem"},{label:__("Status"),key:"status",width:"10rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Mobile no"),key:"mobile_no",width:"11rem"},{label:__("Deal owner"),key:"deal_owner",width:"10rem"},{label:__("Last modified"),key:"modified",width:"8rem"}],K=[{label:__("Name"),key:"full_name",width:"17rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Phone"),key:"mobile_no",width:"12rem"},{label:__("Organization"),key:"company_name",width:"12rem"},{label:__("Last modified"),key:"modified",width:"8rem"}];return(e,t)=>{const g=v("FeatherIcon"),z=v("Button"),X=v("ErrorMessage"),Y=v("Badge");return s(),d(ne,null,[a(o).doc?(s(),_(me,{key:0},{"left-header":m(()=>[i(a(ue),{items:A.value},null,8,["items"])]),_:1})):l("",!0),a(o).doc?(s(),d("div",xe,[i(a(_e),{onSuccess:C,validateFile:P},{default:m(({openFileSelector:n,error:h})=>[r("div",ke,[r("div",Ce,[i(a(re),{size:"3xl",image:a(o).doc.organization_logo,label:a(o).doc.name,class:"!h-24 !w-24"},null,8,["image","label"]),(s(),_(k(a(o).doc.organization_logo?a(de):"div"),ce(a(o).doc.organization_logo?{options:[{icon:"upload",label:a(o).doc.organization_logo?e.__("Change image"):e.__("Upload image"),onClick:n},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>C("")}]}:{onClick:n},{class:"!absolute bottom-0 left-0 right-0"}),{default:m(()=>[r("div",Ie,[i(we,{class:"h-6 w-6 cursor-pointer text-white"})])]),_:2},1040))]),r("div",Oe,[r("div",De,u(a(o).doc.name),1),r("div",Re,[a(o).doc.website?(s(),d("div",Me,[i(fe,{class:"h-4 w-4"}),r("span",je,u(W(a(o).doc.website)),1)])):l("",!0),a(o).doc.website?(s(),d("span",Be," 路 ")):l("",!0),a(o).doc.industry?(s(),d("div",Ee,[i(g,{name:"briefcase",class:"h-4 w-4"}),r("span",Fe,u(a(o).doc.industry),1)])):l("",!0),a(o).doc.industry?(s(),d("span",Ve," 路 ")):l("",!0),a(o).doc.territory?(s(),d("div",$e,[i(ye,{class:"h-4 w-4"}),r("span",Ne,u(a(o).doc.territory),1)])):l("",!0),a(o).doc.territory?(s(),d("span",Se," 路 ")):l("",!0),a(o).doc.annual_revenue?(s(),d("div",Ue,[i(g,{name:"dollar-sign",class:"h-4 w-4"}),r("span",Le,u(a(o).doc.annual_revenue),1)])):l("",!0),a(o).doc.annual_revenue?(s(),d("span",Te," 路 ")):l("",!0),a(o).doc.website||a(o).doc.industry||a(o).doc.territory||a(o).doc.annual_revenue?(s(),_(z,{key:8,variant:"ghost",label:e.__("More"),class:"-ml-1 cursor-pointer hover:text-gray-900",onClick:t[0]||(t[0]=()=>{w.value=!0,b.value=!0})},null,8,["label"])):l("",!0)]),r("div",Ae,[i(z,{label:e.__("Edit"),size:"sm",onClick:t[1]||(t[1]=()=>{w.value=!1,b.value=!0})},{prefix:m(()=>[i(ve,{class:"h-4 w-4"})]),_:1},8,["label"]),i(z,{label:e.__("Delete"),theme:"red",size:"sm",onClick:G},{prefix:m(()=>[i(g,{name:"trash-2",class:"h-4 w-4"})]),_:1},8,["label"])]),i(X,{class:"mt-2",message:e.__(h)},null,8,["message"])])])]),_:1}),i(a(ge),{modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=n=>p.value=n),tabs:q},{tab:m(({tab:n,selected:h})=>[r("button",{class:$(["group flex items-center gap-2 border-b border-transparent py-2.5 text-base text-gray-600 duration-300 ease-in-out hover:border-gray-400 hover:text-gray-900",{"text-gray-900":h}])},[n.icon?(s(),_(k(n.icon),{key:0,class:"h-5"})):l("",!0),V(" "+u(e.__(n.label))+" ",1),i(Y,{class:$(["group-hover:bg-gray-900",[h?"bg-gray-900":"bg-gray-600"]]),variant:"solid",theme:"gray",size:"sm"},{default:m(()=>[V(u(n.count),1)]),_:2},1032,["class"])],2)]),default:m(({tab:n})=>[n.label==="Deals"&&f.value.length?(s(),_(be,{key:0,class:"mt-4",rows:f.value,columns:R.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):l("",!0),n.label==="Contacts"&&f.value.length?(s(),_(he,{key:1,class:"mt-4",rows:f.value,columns:R.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):l("",!0),f.value.length?l("",!0):(s(),d("div",Pe,[r("div",Ge,[(s(),_(k(n.icon),{class:"!h-10 !w-10"})),r("div",null,u(e.__("No {0} Found",[e.__(n.label)])),1)])]))]),_:1},8,["modelValue"])])):l("",!0),i(pe,{modelValue:b.value,"onUpdate:modelValue":t[3]||(t[3]=n=>b.value=n),organization:a(o),"onUpdate:organization":t[4]||(t[4]=n=>te(o)?o.value=n:null),options:{detailMode:w.value}},null,8,["modelValue","organization","options"])],64)}}};export{ra as default};
//# sourceMappingURL=Organization-9ed02fac.js.map
