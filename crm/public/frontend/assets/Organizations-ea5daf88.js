import{_ as S}from"./CustomActions-ca5e2014.js";import{m as T,u as D,a as W,g as j,w as q,r as p,o as G,s as J,c as P,b as E,d as A,e as u,f as _,h as s,i as r,j as m,F as R,k as Z,l as M,_ as H,p as O,q as K,t as B,v as I,D as Q,aO as X,z as h,a0 as Y,G as ee,E as te,Z as ae,I as oe}from"./index-57f524e0.js";import{_ as le,a as ne}from"./LayoutHeader-1b75ebc1.js";import{_ as se}from"./OrganizationModal-6f1ca8c8.js";import{_ as ie}from"./EditValueModal-38ec6b00.js";import{_ as ue,a as re,b as de,c as me,d as pe,e as ce}from"./ListView-59a15338.js";import{_ as fe}from"./DatePicker-c2c1e28a.js";import{_ as ve}from"./ViewControls-d060515f.js";import"./Fields-05088d1a.js";import"./EditIcon-79477f55.js";import"./IndicatorIcon-42fe5203.js";import"./Link-95b990b4.js";import"./label-cf4377fb.js";import"./DatetimePicker-9b4bd588.js";const _e={key:0},ge=["onClick"],Ce={key:1},ye=["onClick"],be={__name:"OrganizationsListView",props:T({rows:{type:Array,required:!0},columns:{type:Array,required:!0},options:{type:Object,default:()=>({selectable:!0,showTooltip:!0,resizeColumn:!1,totalCount:0,rowCount:0})}},{modelValue:{},modelModifiers:{},list:{},listModifiers:{}}),emits:T(["loadMore","updatePageCount","columnWidthUpdated","applyFilter"],["update:modelValue","update:list"]),setup(d,{expose:U,emit:k}){const c=k,g=D(d,"modelValue"),v=D(d,"list"),i=W(),{$dialog:y}=j();q(g,(l,e)=>{l!==e&&c("updatePageCount",l)});const C=p(!1),b=p([]),w=p(()=>{});function $(l,e){b.value=l,C.value=!0,w.value=e}function F(l,e){y({title:__("Delete"),message:__("Are you sure you want to delete {0} item(s)?",[l.size]),variant:"danger",actions:[{label:__("Delete"),variant:"solid",theme:"red",onClick:t=>{P("frappe.desk.reportview.delete_items",{items:JSON.stringify(Array.from(l)),doctype:"CRM Organization"}).then(()=>{E({title:__("Deleted successfully"),icon:"check",iconClasses:"text-green-600"}),e(),v.value.reload(),t()})}}]})}const n=p([]);function a(l,e){return[{label:__("Edit"),onClick:()=>$(l,e)},{label:__("Delete"),onClick:()=>F(l,e)}]}return G(()=>{var l,e,t;(l=v.value)!=null&&l.data&&(J(v.value.data,{list:v.value,call:P,createToast:E,$dialog:y,router:i}),n.value=((t=(e=v.value)==null?void 0:e.data)==null?void 0:t.listActions)||[])}),U({customListActions:n}),(l,e)=>{const t=A("FormControl"),V=A("Button");return u(),_(R,null,[s(m(ce),{columns:d.columns,rows:d.rows,options:{getRowRoute:o=>({name:"Organization",params:{organizationId:o.name}}),selectable:d.options.selectable,showTooltip:d.options.showTooltip,resizeColumn:d.options.resizeColumn},"row-key":"name"},{default:r(()=>[s(m(ue),{class:"mx-5",onColumnWidthUpdated:e[0]||(e[0]=o=>c("columnWidthUpdated"))}),s(m(re),{id:"list-rows"},{default:r(()=>[(u(!0),_(R,null,Z(d.rows,o=>(u(),M(m(me),{class:"mx-5",key:o.name,row:o},{default:r(({idx:x,column:z,item:f})=>[s(m(de),{item:f},{prefix:r(()=>[z.key==="organization_name"?(u(),_("div",_e,[f.label?(u(),M(m(H),{key:0,class:"flex items-center",image:f.logo,label:f.label,size:"sm"},null,8,["image","label"])):O("",!0)])):O("",!0)]),default:r(({label:N})=>[["modified","creation"].includes(z.key)?(u(),_("div",{key:0,class:"truncate text-base",onClick:L=>c("applyFilter",{event:L,idx:x,column:z,item:f})},[s(m(K),{text:f.label},{default:r(()=>[B("div",null,I(f.timeAgo),1)]),_:2},1032,["text"])],8,ge)):z.type==="Check"?(u(),_("div",Ce,[s(t,{type:"checkbox",modelValue:f,disabled:!0,class:"text-gray-900"},null,8,["modelValue"])])):(u(),_("div",{key:2,class:"truncate text-base",onClick:L=>c("applyFilter",{event:L,idx:x,column:z,item:f})},I(l.__(N)),9,ye))]),_:2},1032,["item"])]),_:2},1032,["row"]))),128))]),_:1}),s(m(pe),null,{actions:r(({selections:o,unselectAll:x})=>[s(m(Q),{options:a(o,x)},{default:r(()=>[s(V,{icon:"more-horizontal",variant:"ghost"})]),_:2},1032,["options"])]),_:1})]),_:1},8,["columns","rows","options"]),s(m(fe),{class:"border-t px-5 py-2",modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=o=>g.value=o),options:{rowCount:d.options.rowCount,totalCount:d.options.totalCount},onLoadMore:e[2]||(e[2]=o=>c("loadMore"))},null,8,["modelValue","options"]),s(ie,{modelValue:C.value,"onUpdate:modelValue":e[3]||(e[3]=o=>C.value=o),unselectAll:w.value,"onUpdate:unselectAll":e[4]||(e[4]=o=>w.value=o),doctype:"CRM Organization",selectedValues:b.value,onReload:e[5]||(e[5]=o=>v.value.reload())},null,8,["modelValue","unselectAll","selectedValues"])],64)}}},we={key:1,class:"flex h-full items-center justify-center"},ke={class:"flex flex-col items-center gap-3 text-xl font-medium text-gray-500"},Te={__name:"Organizations",setup(d){const U=X(),k=p(null),c=p(!1),g=h(()=>{var n,a,l;return(l=(a=(n=i.value)==null?void 0:n.data)==null?void 0:a.data)==null?void 0:l.find(e=>e.name===U.params.organizationId)}),v=h(()=>{let n=[{label:__("Organizations"),route:{name:"Organizations"}}];return g.value&&n.push({label:__(g.value.name),route:{name:"Organization",params:{organizationId:g.value.name}}}),n}),i=p({}),y=p(1),C=p(1),b=p(20),w=p(null),$=h(()=>{var n,a,l;return(a=(n=i.value)==null?void 0:n.data)!=null&&a.data?(l=i.value)==null?void 0:l.data.data.map(e=>{var V;let t={};return(V=i.value)==null||V.data.rows.forEach(o=>{t[o]=e[o],o==="organization_name"?t[o]={label:e.organization_name,logo:e.organization_logo}:o==="website"?t[o]=F(e.website):o==="annual_revenue"?t[o]=Y(e.annual_revenue):["modified","creation"].includes(o)&&(t[o]={label:ee(e[o],oe),timeAgo:__(te(e[o]))})}),t}):[]});function F(n){return n&&n.replace(/^(?:https?:\/\/)?(?:www\.)?/i,"")}return(n,a)=>{const l=A("FeatherIcon"),e=A("Button");return u(),_(R,null,[s(le,null,{"left-header":r(()=>[s(m(ne),{items:v.value},null,8,["items"])]),"right-header":r(()=>{var t;return[(t=k.value)!=null&&t.customListActions?(u(),M(S,{key:0,actions:k.value.customListActions},null,8,["actions"])):O("",!0),s(e,{variant:"solid",label:n.__("Create"),onClick:a[0]||(a[0]=V=>c.value=!0)},{prefix:r(()=>[s(l,{name:"plus",class:"h-4"})]),_:1},8,["label"])]}),_:1}),s(ve,{ref_key:"viewControls",ref:w,modelValue:i.value,"onUpdate:modelValue":a[1]||(a[1]=t=>i.value=t),loadMore:y.value,"onUpdate:loadMore":a[2]||(a[2]=t=>y.value=t),resizeColumn:C.value,"onUpdate:resizeColumn":a[3]||(a[3]=t=>C.value=t),updatedPageCount:b.value,"onUpdate:updatedPageCount":a[4]||(a[4]=t=>b.value=t),doctype:"CRM Organization",showElement:!0,placeholderText:n.__("Search organization")},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount","placeholderText"]),i.value.data&&$.value.length?(u(),M(be,{key:0,ref_key:"organizationsListView",ref:k,modelValue:i.value.data.page_length_count,"onUpdate:modelValue":a[5]||(a[5]=t=>i.value.data.page_length_count=t),list:i.value,"onUpdate:list":a[6]||(a[6]=t=>i.value=t),rows:$.value,columns:i.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:i.value.data.row_count,totalCount:i.value.data.total_count},onLoadMore:a[7]||(a[7]=()=>y.value++),onColumnWidthUpdated:a[8]||(a[8]=()=>C.value++),onUpdatePageCount:a[9]||(a[9]=t=>b.value=t),onApplyFilter:a[10]||(a[10]=t=>w.value.applyFilter(t))},null,8,["modelValue","list","rows","columns","options"])):i.value.data?(u(),_("div",we,[B("div",ke,[s(ae,{class:"h-10 w-10"}),B("span",null,I(n.__("No {0} Found",[n.__("Organizations")])),1),s(e,{label:n.__("Create"),onClick:a[11]||(a[11]=t=>c.value=!0)},{prefix:r(()=>[s(l,{name:"plus",class:"h-4"})]),_:1},8,["label"])])])):O("",!0),s(se,{modelValue:c.value,"onUpdate:modelValue":a[12]||(a[12]=t=>c.value=t)},null,8,["modelValue"])],64)}}};export{Te as default};
//# sourceMappingURL=Organizations-ea5daf88.js.map
