import{_ as O}from"./CustomActions-6e5afc2b.js";import{z as I,A as N,B as G,C as H,D as K,E as m,G as J,H as X,I as W,J as Y,s as z,o as r,b as p,f as u,w as c,u as d,F as E,x as Q,a as x,L as j,X as P,d as B,t as S,k as A,a_ as Z,aY as ee,K as te,M as ae,N as oe,V as se,b4 as q,b5 as le,c as ne,W as ue,a3 as ie,$ as re}from"./index-b021dd3e.js";import{_ as de,a as me}from"./LayoutHeader-f9685323.js";import{_ as ce}from"./ViewControls-afbfa000.js";import{C as pe}from"./CalendarIcon-89a087f9.js";import{_ as fe}from"./EditValueModal-89794f46.js";import{_ as _e,a as ve,b as ke,c as Ce,e as ye,d as ge}from"./ListView-913eec95.js";import{_ as we}from"./DatePicker-ecb1c2b9.js";import{T as be}from"./TaskModal-ab48bda9.js";import"./EditIcon-5d716aa9.js";import"./DatetimePicker-85b575c4.js";import"./label-241d26b1.js";const Te={key:0},Ve={class:"flex items-center gap-2 truncate text-base"},Me={key:0,class:"truncate"},he={key:0},$e={key:1},xe={key:2},Ae=["onClick"],Ue={key:1},Fe=["onClick"],Le={__name:"TasksListView",props:I({rows:{type:Array,required:!0},columns:{type:Array,required:!0},options:{type:Object,default:()=>({selectable:!0,showTooltip:!0,resizeColumn:!1,totalCount:0,rowCount:0})}},{modelValue:{},modelModifiers:{},list:{},listModifiers:{}}),emits:I(["loadMore","updatePageCount","showTask","columnWidthUpdated","applyFilter","update:selections"],["update:modelValue","update:list"]),setup(f,{expose:R,emit:U}){const k=U,g=N(f,"modelValue"),C=N(f,"list"),F=G(),{$dialog:M}=H();K(g,(i,s)=>{i!==s&&k("updatePageCount",i)});const n=m(!1),T=m([]),w=m(()=>{});function h(i,s){T.value=i,n.value=!0,w.value=s}function L(i,s){M({title:__("Delete"),message:__("Are you sure you want to delete {0} item(s)?",[i.size]),variant:"danger",actions:[{label:__("Delete"),variant:"solid",theme:"red",onClick:_=>{W("frappe.desk.reportview.delete_items",{items:JSON.stringify(Array.from(i)),doctype:"CRM Task"}).then(()=>{Y({title:__("Deleted successfully"),icon:"check",iconClasses:"text-green-600"}),s(),C.value.reload(),_()})}}]})}const V=m([]);function b(i,s){return[{label:__("Edit"),onClick:()=>h(i,s)},{label:__("Delete"),onClick:()=>L(i,s)}]}function $(i){let s=[];i.forEach(_=>{s.push(_)}),k("update:selections",s)}return J(()=>{var i,s,_;(i=C.value)!=null&&i.data&&(X(C.value.data,{list:C.value,call:W,createToast:Y,$dialog:M,router:F}),V.value=((_=(s=C.value)==null?void 0:s.data)==null?void 0:_.listActions)||[])}),R({customListActions:V}),(i,s)=>{const _=z("FormControl"),D=z("Button");return r(),p(E,null,[u(d(ge),{columns:f.columns,rows:f.rows,options:{onRowClick:a=>k("showTask",a.name),selectable:f.options.selectable,showTooltip:f.options.showTooltip,resizeColumn:f.options.resizeColumn},"row-key":"name","onUpdate:selections":s[1]||(s[1]=a=>$(a))},{default:c(()=>[u(d(_e),{class:"mx-5",onColumnWidthUpdated:s[0]||(s[0]=a=>k("columnWidthUpdated"))}),u(d(ve),{id:"list-rows"},{default:c(()=>[(r(!0),p(E,null,Q(f.rows,a=>(r(),x(d(Ce),{class:"mx-5",key:a.name,row:a},{default:c(({idx:e,column:l,item:o})=>[l.key==="due_date"||l.key==="remind_task"?(r(),p("div",Te,[u(d(j),{text:d(P)(o,"ddd, MMM D, YYYY | hh:mm a")},{default:c(()=>[B("div",Ve,[u(pe),o?(r(),p("div",Me,S(d(P)(o,"D MMM, hh:mm a")),1)):A("",!0)])]),_:2},1032,["text"])])):(r(),x(d(ke),{key:1,item:o},{prefix:c(()=>[l.key==="status"?(r(),p("div",he,[u(Z,{status:o},null,8,["status"])])):l.key==="priority"?(r(),p("div",$e,[u(ee,{priority:o},null,8,["priority"])])):l.key==="assigned_to"?(r(),p("div",xe,[o.full_name?(r(),x(d(te),{key:0,class:"flex items-center",image:o.user_image,label:o.full_name,size:"sm"},null,8,["image","label"])):A("",!0)])):A("",!0)]),default:c(({label:t})=>[["modified","creation"].includes(l.key)?(r(),p("div",{key:0,class:"truncate text-base",onClick:v=>k("applyFilter",{event:v,idx:e,column:l,item:o})},[u(d(j),{text:o.label},{default:c(()=>[B("div",null,S(o.timeAgo),1)]),_:2},1032,["text"])],8,Ae)):l.type==="Check"?(r(),p("div",Ue,[u(_,{type:"checkbox",modelValue:o,disabled:!0,class:"text-gray-900"},null,8,["modelValue"])])):(r(),p("div",{key:2,class:"truncate text-base",onClick:v=>k("applyFilter",{event:v,idx:e,column:l,item:o})},S(i.__(t)),9,Fe))]),_:2},1032,["item"]))]),_:2},1032,["row"]))),128))]),_:1}),u(d(ye),null,{actions:c(({selections:a,unselectAll:e})=>[u(d(ae),{options:b(a,e)},{default:c(()=>[u(D,{icon:"more-horizontal",variant:"ghost"})]),_:2},1032,["options"])]),_:1})]),_:1},8,["columns","rows","options"]),u(d(we),{class:"border-t px-5 py-2",modelValue:g.value,"onUpdate:modelValue":s[2]||(s[2]=a=>g.value=a),options:{rowCount:f.options.rowCount,totalCount:f.options.totalCount},onLoadMore:s[3]||(s[3]=a=>k("loadMore"))},null,8,["modelValue","options"]),u(fe,{modelValue:n.value,"onUpdate:modelValue":s[4]||(s[4]=a=>n.value=a),unselectAll:w.value,"onUpdate:unselectAll":s[5]||(s[5]=a=>w.value=a),doctype:"CRM Task",selectedValues:T.value,onReload:s[6]||(s[6]=a=>C.value.reload())},null,8,["modelValue","unselectAll","selectedValues"])],64)}}},Se={key:1,class:"flex h-full items-center justify-center"},ze={class:"flex flex-col items-center gap-3 text-xl font-medium text-gray-500"},Oe={__name:"Tasks",setup(f){const R=[{label:__("Tasks"),route:{name:"Tasks"}}],{getUser:U}=oe(),{roles:k}=se(),g=m(null),C=m(!1),F=m([]),M=a=>{var l,o;let e=a.message;if(e!=null&&e!=""){let t=(o=(l=n.value)==null?void 0:l.data)==null?void 0:o.data.filter(v=>v.name==e);t.length>0&&i(t[0].name)}};J(()=>{let a=k.data;for(let e=0;e<a.length;e++)if(a[e]=="System Manager"){C.value=!0;break}setTimeout(()=>{var l,o;let e=window.location.hash.substring(1);if(e!=null&&e!=""){let t=(o=(l=n.value)==null?void 0:l.data)==null?void 0:o.data.filter(v=>v.name==e);t.length>0&&i(t[0].name)}},400),q.on("custom-event",M)}),le(()=>{q.off("custom-event",M)});const n=m({}),T=m(1),w=m(1),h=m(20),L=m(null),V=ne(()=>{var a,e,l;return(e=(a=n.value)==null?void 0:a.data)!=null&&e.data?(l=n.value)==null?void 0:l.data.data.map(o=>{var v;let t={};return(v=n.value)==null||v.data.rows.forEach(y=>{t[y]=o[y],["modified","creation"].includes(y)?t[y]={label:P(o[y],re),timeAgo:__(ue(o[y]))}:y=="assigned_to"&&(t[y]={label:o.assigned_to&&U(o.assigned_to).full_name,...o.assigned_to&&U(o.assigned_to)})}),t}):[]}),b=m(!1),$=m({name:"",title:"",description:"",assigned_to:"",due_date:"",remind_task:"",status:"Backlog",priority:"Low",reference_doctype:"CRM Lead",reference_docname:""});function i(a){var l,o;let e=(l=V.value)==null?void 0:l.find(t=>t.name===a);$.value={name:e.name,title:e.title,description:e.description,assigned_to:((o=e.assigned_to)==null?void 0:o.email)||"",due_date:e.due_date,remind_task:e.remind_task,status:e.status,priority:e.priority,reference_doctype:e.reference_doctype,reference_docname:e.reference_docname},b.value=!0}function s(){$.value={name:"",title:"",description:"",assigned_to:"",due_date:"",remind_task:"",status:"Backlog",priority:"Low",reference_doctype:"CRM Lead",reference_docname:""},b.value=!0}function _(){n.value.reload()}function D(a){F.value=a}return(a,e)=>{const l=z("FeatherIcon"),o=z("Button");return r(),p(E,null,[u(de,null,{"left-header":c(()=>[u(d(me),{items:R})]),"right-header":c(()=>{var t;return[(t=g.value)!=null&&t.customListActions?(r(),x(O,{key:0,actions:g.value.customListActions},null,8,["actions"])):A("",!0),u(o,{variant:"solid",label:a.__("Create"),onClick:s},{prefix:c(()=>[u(l,{name:"plus",class:"h-4"})]),_:1},8,["label"])]}),_:1}),u(ce,{ref_key:"viewControls",ref:L,modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=t=>n.value=t),loadMore:T.value,"onUpdate:loadMore":e[1]||(e[1]=t=>T.value=t),resizeColumn:w.value,"onUpdate:resizeColumn":e[2]||(e[2]=t=>w.value=t),updatedPageCount:h.value,"onUpdate:updatedPageCount":e[3]||(e[3]=t=>h.value=t),doctype:"CRM Task",showElement:!0,showFuncImport:!1,showFuncConvertTaskCustomer:C.value,placeholderText:a.__("Search"),onAfterConvertTaskCustomer:e[4]||(e[4]=t=>_()),docSelect:F.value},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount","showFuncConvertTaskCustomer","placeholderText","docSelect"]),n.value.data&&V.value.length?(r(),x(Le,{key:0,ref_key:"tasksListView",ref:g,modelValue:n.value.data.page_length_count,"onUpdate:modelValue":e[5]||(e[5]=t=>n.value.data.page_length_count=t),list:n.value,"onUpdate:list":e[6]||(e[6]=t=>n.value=t),rows:V.value,columns:n.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:n.value.data.row_count,totalCount:n.value.data.total_count},onLoadMore:e[7]||(e[7]=()=>T.value++),onColumnWidthUpdated:e[8]||(e[8]=()=>w.value++),onUpdatePageCount:e[9]||(e[9]=t=>h.value=t),onShowTask:i,onApplyFilter:e[10]||(e[10]=t=>L.value.applyFilter(t)),"onUpdate:selections":e[11]||(e[11]=t=>D(t))},null,8,["modelValue","list","rows","columns","options"])):n.value.data?(r(),p("div",Se,[B("div",ze,[u(ie,{class:"h-10 w-10"}),B("span",null,S(a.__("No {0} Found",[a.__("tasks")])),1),u(o,{label:a.__("Create"),onClick:e[12]||(e[12]=t=>b.value=!0)},{prefix:c(()=>[u(l,{name:"plus",class:"h-4"})]),_:1},8,["label"])])])):A("",!0),u(be,{modelValue:b.value,"onUpdate:modelValue":e[13]||(e[13]=t=>b.value=t),reloadTasks:n.value,"onUpdate:reloadTasks":e[14]||(e[14]=t=>n.value=t),task:$.value},null,8,["modelValue","reloadTasks","task"])],64)}}};export{Oe as default};
//# sourceMappingURL=Tasks-d79ca6f3.js.map
