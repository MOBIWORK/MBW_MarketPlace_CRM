import{_ as j}from"./CustomActions-ca5e2014.js";import{m as S,u as E,a as q,g as O,w as G,r as d,o as W,s as J,c as P,b as N,d as U,e as i,f as c,h as l,i as m,j as r,F as R,k as Q,l as h,q as I,G as D,t as F,v as A,p as x,aS as H,aQ as K,_ as X,D as Z,x as ee,C as te,z as ae,E as oe,N as se,I as le}from"./index-57f524e0.js";import{_ as ne,a as ue}from"./LayoutHeader-1b75ebc1.js";import{_ as ie}from"./ViewControls-d060515f.js";import{C as re}from"./CalendarIcon-45fafaab.js";import{_ as de}from"./EditValueModal-38ec6b00.js";import{_ as me,a as ce,b as pe,c as _e,d as fe,e as ve}from"./ListView-59a15338.js";import{_ as ke}from"./DatePicker-c2c1e28a.js";import{T as Ce}from"./TaskModal-c19adbc3.js";import"./EditIcon-79477f55.js";import"./Link-95b990b4.js";import"./DatetimePicker-9b4bd588.js";import"./label-cf4377fb.js";const ye={key:0},ge={class:"flex items-center gap-2 truncate text-base"},we={key:0,class:"truncate"},be={key:0},Ve={key:1},Te={key:2},Me=["onClick"],he={key:1},xe=["onClick"],$e={__name:"TasksListView",props:S({rows:{type:Array,required:!0},columns:{type:Array,required:!0},options:{type:Object,default:()=>({selectable:!0,showTooltip:!0,resizeColumn:!1,totalCount:0,rowCount:0})}},{modelValue:{},modelModifiers:{},list:{},listModifiers:{}}),emits:S(["loadMore","updatePageCount","showTask","columnWidthUpdated","applyFilter"],["update:modelValue","update:list"]),setup(p,{expose:L,emit:$}){const k=$,C=E(p,"modelValue"),v=E(p,"list"),n=q(),{$dialog:w}=O();G(C,(u,t)=>{u!==t&&k("updatePageCount",u)});const y=d(!1),b=d([]),V=d(()=>{});function M(u,t){b.value=u,y.value=!0,V.value=t}function g(u,t){w({title:__("Delete"),message:__("Are you sure you want to delete {0} item(s)?",[u.size]),variant:"danger",actions:[{label:__("Delete"),variant:"solid",theme:"red",onClick:e=>{P("frappe.desk.reportview.delete_items",{items:JSON.stringify(Array.from(u)),doctype:"CRM Task"}).then(()=>{N({title:__("Deleted successfully"),icon:"check",iconClasses:"text-green-600"}),t(),v.value.reload(),e()})}}]})}const T=d([]);function z(u,t){return[{label:__("Edit"),onClick:()=>M(u,t)},{label:__("Delete"),onClick:()=>g(u,t)}]}return W(()=>{var u,t,e;(u=v.value)!=null&&u.data&&(J(v.value.data,{list:v.value,call:P,createToast:N,$dialog:w,router:n}),T.value=((e=(t=v.value)==null?void 0:t.data)==null?void 0:e.listActions)||[])}),L({customListActions:T}),(u,t)=>{const e=U("FormControl"),f=U("Button");return i(),c(R,null,[l(r(ve),{columns:p.columns,rows:p.rows,options:{onRowClick:o=>k("showTask",o.name),selectable:p.options.selectable,showTooltip:p.options.showTooltip,resizeColumn:p.options.resizeColumn},"row-key":"name"},{default:m(()=>[l(r(me),{class:"mx-5",onColumnWidthUpdated:t[0]||(t[0]=o=>k("columnWidthUpdated"))}),l(r(ce),{id:"list-rows"},{default:m(()=>[(i(!0),c(R,null,Q(p.rows,o=>(i(),h(r(_e),{class:"mx-5",key:o.name,row:o},{default:m(({idx:a,column:_,item:s})=>[_.key==="due_date"?(i(),c("div",ye,[l(r(I),{text:r(D)(s,"ddd, MMM D, YYYY | hh:mm a")},{default:m(()=>[F("div",ge,[l(re),s?(i(),c("div",we,A(r(D)(s,"D MMM, hh:mm a")),1)):x("",!0)])]),_:2},1032,["text"])])):(i(),h(r(pe),{key:1,item:s},{prefix:m(()=>[_.key==="status"?(i(),c("div",be,[l(H,{status:s},null,8,["status"])])):_.key==="priority"?(i(),c("div",Ve,[l(K,{priority:s},null,8,["priority"])])):_.key==="assigned_to"?(i(),c("div",Te,[s.full_name?(i(),h(r(X),{key:0,class:"flex items-center",image:s.user_image,label:s.full_name,size:"sm"},null,8,["image","label"])):x("",!0)])):x("",!0)]),default:m(({label:Y})=>[["modified","creation"].includes(_.key)?(i(),c("div",{key:0,class:"truncate text-base",onClick:B=>k("applyFilter",{event:B,idx:a,column:_,item:s})},[l(r(I),{text:s.label},{default:m(()=>[F("div",null,A(s.timeAgo),1)]),_:2},1032,["text"])],8,Me)):_.type==="Check"?(i(),c("div",he,[l(e,{type:"checkbox",modelValue:s,disabled:!0,class:"text-gray-900"},null,8,["modelValue"])])):(i(),c("div",{key:2,class:"truncate text-base",onClick:B=>k("applyFilter",{event:B,idx:a,column:_,item:s})},A(u.__(Y)),9,xe))]),_:2},1032,["item"]))]),_:2},1032,["row"]))),128))]),_:1}),l(r(fe),null,{actions:m(({selections:o,unselectAll:a})=>[l(r(Z),{options:z(o,a)},{default:m(()=>[l(f,{icon:"more-horizontal",variant:"ghost"})]),_:2},1032,["options"])]),_:1})]),_:1},8,["columns","rows","options"]),l(r(ke),{class:"border-t px-5 py-2",modelValue:C.value,"onUpdate:modelValue":t[1]||(t[1]=o=>C.value=o),options:{rowCount:p.options.rowCount,totalCount:p.options.totalCount},onLoadMore:t[2]||(t[2]=o=>k("loadMore"))},null,8,["modelValue","options"]),l(de,{modelValue:y.value,"onUpdate:modelValue":t[3]||(t[3]=o=>y.value=o),unselectAll:V.value,"onUpdate:unselectAll":t[4]||(t[4]=o=>V.value=o),doctype:"CRM Task",selectedValues:b.value,onReload:t[5]||(t[5]=o=>v.value.reload())},null,8,["modelValue","unselectAll","selectedValues"])],64)}}},Ae={key:1,class:"flex h-full items-center justify-center"},Ue={class:"flex flex-col items-center gap-3 text-xl font-medium text-gray-500"},je={__name:"Tasks",setup(p){const L=[{label:__("Tasks"),route:{name:"Tasks"}}],{getUser:$}=ee(),{roles:k}=te(),C=d(null),v=d(!1);W(()=>{let t=k.data;for(let e=0;e<t.length;e++)if(t[e]=="System Manager"){v.value=!0;break}});const n=d({}),w=d(1),y=d(1),b=d(20),V=d(null),M=ae(()=>{var t,e,f;return(e=(t=n.value)==null?void 0:t.data)!=null&&e.data?(f=n.value)==null?void 0:f.data.data.map(o=>{var _;let a={};return(_=n.value)==null||_.data.rows.forEach(s=>{a[s]=o[s],["modified","creation"].includes(s)?a[s]={label:D(o[s],le),timeAgo:__(oe(o[s]))}:s=="assigned_to"&&(a[s]={label:o.assigned_to&&$(o.assigned_to).full_name,...o.assigned_to&&$(o.assigned_to)})}),a}):[]}),g=d(!1),T=d({name:"",title:"",description:"",assigned_to:"",due_date:"",status:"Backlog",priority:"Low",reference_doctype:"CRM Lead",reference_docname:""});function z(t){var f,o;let e=(f=M.value)==null?void 0:f.find(a=>a.name===t);T.value={name:e.name,title:e.title,description:e.description,assigned_to:((o=e.assigned_to)==null?void 0:o.email)||"",due_date:e.due_date,status:e.status,priority:e.priority,reference_doctype:e.reference_doctype,reference_docname:e.reference_docname},g.value=!0}function u(){T.value={name:"",title:"",description:"",assigned_to:"",due_date:"",status:"Backlog",priority:"Low",reference_doctype:"CRM Lead",reference_docname:""},g.value=!0}return(t,e)=>{const f=U("FeatherIcon"),o=U("Button");return i(),c(R,null,[l(ne,null,{"left-header":m(()=>[l(r(ue),{items:L})]),"right-header":m(()=>{var a;return[(a=C.value)!=null&&a.customListActions?(i(),h(j,{key:0,actions:C.value.customListActions},null,8,["actions"])):x("",!0),l(o,{variant:"solid",label:t.__("Create"),onClick:u},{prefix:m(()=>[l(f,{name:"plus",class:"h-4"})]),_:1},8,["label"])]}),_:1}),l(ie,{ref_key:"viewControls",ref:V,modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=a=>n.value=a),loadMore:w.value,"onUpdate:loadMore":e[1]||(e[1]=a=>w.value=a),resizeColumn:y.value,"onUpdate:resizeColumn":e[2]||(e[2]=a=>y.value=a),updatedPageCount:b.value,"onUpdate:updatedPageCount":e[3]||(e[3]=a=>b.value=a),doctype:"CRM Task",showElement:!0,showFuncConvertTaskCustomer:v.value,placeholderText:t.__("Search task")},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount","showFuncConvertTaskCustomer","placeholderText"]),n.value.data&&M.value.length?(i(),h($e,{key:0,ref_key:"tasksListView",ref:C,modelValue:n.value.data.page_length_count,"onUpdate:modelValue":e[4]||(e[4]=a=>n.value.data.page_length_count=a),list:n.value,"onUpdate:list":e[5]||(e[5]=a=>n.value=a),rows:M.value,columns:n.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:n.value.data.row_count,totalCount:n.value.data.total_count},onLoadMore:e[6]||(e[6]=()=>w.value++),onColumnWidthUpdated:e[7]||(e[7]=()=>y.value++),onUpdatePageCount:e[8]||(e[8]=a=>b.value=a),onShowTask:z,onApplyFilter:e[9]||(e[9]=a=>V.value.applyFilter(a))},null,8,["modelValue","list","rows","columns","options"])):n.value.data?(i(),c("div",Ae,[F("div",Ue,[l(se,{class:"h-10 w-10"}),F("span",null,A(t.__("No {0} Found",[t.__("Tasks")])),1),l(o,{label:t.__("Create"),onClick:e[10]||(e[10]=a=>g.value=!0)},{prefix:m(()=>[l(f,{name:"plus",class:"h-4"})]),_:1},8,["label"])])])):x("",!0),l(Ce,{modelValue:g.value,"onUpdate:modelValue":e[11]||(e[11]=a=>g.value=a),reloadTasks:n.value,"onUpdate:reloadTasks":e[12]||(e[12]=a=>n.value=a),task:T.value},null,8,["modelValue","reloadTasks","task"])],64)}}};export{je as default};
//# sourceMappingURL=Tasks-667f4845.js.map
