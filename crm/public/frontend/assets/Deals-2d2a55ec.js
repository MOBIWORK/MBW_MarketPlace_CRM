import{_ as W}from"./CustomActions-d94ef330.js";import{y as P,u as j,a as q,r as u,z as Z,A as U,o as G,d as D,e as y,l as h,i as b,v as p,x as T,h as i,j as E,q as R,B as H,L as K,f as I,F as Q,a8 as X,M as F,N as O,O as Y,a9 as ee,R as N}from"./index-d53336e9.js";import{_ as ae,a as te}from"./LayoutHeader-5e7d45d2.js";import{_ as le}from"./DealsListView-b4c1310b.js";import{F as oe}from"./Fields-d02fad9b.js";import{s as J}from"./statuses-c8dcc01d.js";import{_ as L}from"./Switch.vue_vue_type_script_setup_true_lang-e41e856b.js";import{_ as se}from"./ViewControls-deecf68a.js";import{o as ne}from"./organizations-9991fda4.js";import"./IndicatorIcon-56c34b08.js";import"./EditValueModal-99ba3461.js";import"./DatePicker-072cd0fe.js";import"./label-d6f4dae7.js";import"./ListView-77cfc5bf.js";import"./EditIcon-d614e42f.js";import"./DatetimePicker-7fc9cdc9.js";const re={class:"mb-4 grid grid-cols-3 gap-4"},ie={class:"flex items-center gap-3 text-sm text-gray-600"},ue={class:"flex items-center gap-3 text-sm text-gray-600"},me={class:"flex flex-row-reverse gap-2"},de={__name:"DealModal",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup($){const{getUser:k}=P(),{getDealStatus:v,statusOptions:w}=J(),C=j($,"modelValue"),x=q(),m=u(null),l=Z({organization:"",organization_name:"",website:"",no_of_employees:"",territory:"",annual_revenue:"",industry:"",contact:"",salutation:"",first_name:"",last_name:"",email:"",mobile_no:"",gender:"",status:"",deal_owner:"",assign_to:JSON.stringify([])}),f=u(!1),s=u(!1),c=u(!1),S=U(()=>{let o=[];return c.value?o.push({section:"Select Organization",fields:[{label:"Organization",name:"organization",type:"link",placeholder:__("Select Organization"),doctype:"CRM Organization"}]}):o.push({section:"Organization Details",fields:[{label:"Organization Name",name:"organization_name",type:"data"},{label:"Website",name:"website",type:"data"},{label:"No of Employees",name:"no_of_employees",type:"select",options:[{label:__("1-10"),value:"1-10"},{label:__("11-50"),value:"11-50"},{label:__("51-200"),value:"51-200"},{label:__("201-500"),value:"201-500"},{label:__("501-1000"),value:"501-1000"},{label:__("1001-5000"),value:"1001-5000"},{label:__("5001-10000"),value:"5001-10000"},{label:__("10001+"),value:"10001+"}],placeholder:__("Select No Of Employees")},{label:"Territory",name:"territory",type:"link",doctype:"CRM Territory",placeholder:__("Select Territory")},{label:"Annual Revenue",name:"annual_revenue",type:"data"},{label:"Industry",name:"industry",type:"link",doctype:"CRM Industry",placeholder:__("Select Industry")}]}),s.value?o.push({section:"Select Contact",fields:[{label:"Contact",name:"contact",type:"link",placeholder:__("Select Contact"),doctype:"Contact"}]}):o.push({section:"Contact Details",fields:[{label:"Salutation",name:"salutation",type:"link",doctype:"Salutation",placeholder:__("Select Salutation")},{label:"First Name",name:"first_name",type:"data"},{label:"Email",name:"email",type:"data"},{label:"Mobile No",name:"mobile_no",type:"data"},{label:"Gender",name:"gender",type:"link",doctype:"Gender",placeholder:__("Select Gender")}]}),o.push({section:"Deal Details",columns:2,fields:[{label:"Status",name:"status",type:"select",options:z.value,prefix:v(l.status).iconColorClass},{label:"Deal Owner",name:"deal_owner",type:"user",placeholder:__("Deal Owner"),doctype:"User"}]}),o}),z=U(()=>{let o=w("deal");return l.status||(l.status=o[0].value),o});function V(){l.assign_to=JSON.stringify([l.deal_owner]),H({url:"crm.fcrm.doctype.crm_deal.crm_deal.create_deal",params:{args:l},auto:!0,validate(){if(m.value=null,l.website&&!l.website.startsWith("http")&&(l.website="https://"+l.website),l.annual_revenue&&(l.annual_revenue=l.annual_revenue.replace(/,/g,""),isNaN(l.annual_revenue)))return m.value=__("Annual Revenue should be a number"),m.value;const o=/^[\w-]+(?:\.[\w-]+)*@(?:[\w-]+\.)+[a-zA-Z]{2,}$/;if(l.email&&!o.test(l.email))return m.value=__("Invalid Email"),m.value;f.value=!0},onSuccess(o){f.value=!1,C.value=!1,x.push({name:"Deal",params:{dealId:o}})}})}return G(()=>{l.deal_owner||(l.deal_owner=k().email)}),(o,_)=>{const r=D("ErrorMessage"),a=D("Button"),t=D("Dialog");return y(),h(t,{modelValue:C.value,"onUpdate:modelValue":_[2]||(_[2]=n=>C.value=n),options:{size:"3xl",title:o.__("Create Deal")}},{"body-content":b(()=>[p("div",re,[p("div",ie,[p("div",null,T(o.__("Choose Existing Organization")),1),i(E(L),{modelValue:c.value,"onUpdate:modelValue":_[0]||(_[0]=n=>c.value=n)},null,8,["modelValue"])]),p("div",ue,[p("div",null,T(o.__("Choose Existing Contact")),1),i(E(L),{modelValue:s.value,"onUpdate:modelValue":_[1]||(_[1]=n=>s.value=n)},null,8,["modelValue"])])]),i(oe,{class:"border-t pt-4",sections:S.value,data:l},null,8,["sections","data"]),m.value?(y(),h(r,{key:0,class:"mt-4",message:o.__(m.value)},null,8,["message"])):R("",!0)]),actions:b(()=>[p("div",me,[i(a,{variant:"solid",label:o.__("Create"),loading:f.value,onClick:V},null,8,["label","loading"])])]),_:1},8,["modelValue","options"])}}},_e={key:1,class:"flex h-full items-center justify-center"},pe={class:"flex flex-col items-center gap-3 text-xl font-medium text-gray-500"},Fe={__name:"Deals",setup($){const k=[{label:__("Deals"),route:{name:"Deals"}}],{getUser:v}=P(),{getOrganization:w}=ne(),{getDealStatus:C}=J(),{roles:x}=K(),m=u(null),l=u(!1),f=u(!1);G(()=>{let r=x.data;for(let a=0;a<r.length;a++)if(r[a]=="System Manager"){f.value=!0;break}});const s=u({}),c=u(1),S=u(1),z=u(20),V=u(null),o=U(()=>{var r,a;return(a=(r=s.value)==null?void 0:r.data)!=null&&a.data?s.value.data.data.map(t=>{let n={};return s.value.data.rows.forEach(e=>{var M,A;if(n[e]=t[e],e=="organization")n[e]={label:t.organization,logo:(M=w(t.organization))==null?void 0:M.organization_logo};else if(e=="annual_revenue")n[e]=X(t.annual_revenue);else if(e=="status")n[e]={label:t.status,color:(A=C(t.status))==null?void 0:A.iconColorClass};else if(e=="sla_status"){let d=t.sla_status,g=d,B=t.sla_status=="Failed"?"red":t.sla_status=="Fulfilled"?"green":"orange";d=="First Response Due"&&(d=__(F(t.response_by)),g=O(t.response_by,N),new Date(t.response_by)<new Date&&(B="red")),n[e]={label:g,value:d,color:B}}else if(e=="deal_owner")n[e]={label:t.deal_owner&&v(t.deal_owner).full_name,...t.deal_owner&&v(t.deal_owner)};else if(e=="_assign"){let d=JSON.parse(t._assign)||[];!d.length&&t.deal_owner&&(d=[t.deal_owner]),n[e]=d.map(g=>({name:g,image:v(g).user_image,label:v(g).full_name}))}else if(["modified","creation"].includes(e))n[e]={label:O(t[e],N),timeAgo:__(F(t[e]))};else if(["first_response_time","first_responded_on","response_by"].includes(e)){let d=e=="response_by"?"response_by":"first_responded_on";n[e]={label:t[d]?O(t[d],N):"",timeAgo:t[e]?e=="first_response_time"?Y(t[e]):__(F(t[e])):""}}}),n}):[]});function _(){s.value.reload()}return(r,a)=>{const t=D("FeatherIcon"),n=D("Button");return y(),I(Q,null,[i(ae,null,{"left-header":b(()=>[i(E(te),{items:k})]),"right-header":b(()=>{var e;return[(e=m.value)!=null&&e.customListActions?(y(),h(W,{key:0,actions:m.value.customListActions},null,8,["actions"])):R("",!0),i(n,{variant:"solid",label:r.__("Create"),onClick:a[0]||(a[0]=M=>l.value=!0)},{prefix:b(()=>[i(t,{name:"plus",class:"h-4"})]),_:1},8,["label"])]}),_:1}),i(se,{ref_key:"viewControls",ref:V,modelValue:s.value,"onUpdate:modelValue":a[1]||(a[1]=e=>s.value=e),loadMore:c.value,"onUpdate:loadMore":a[2]||(a[2]=e=>c.value=e),resizeColumn:S.value,"onUpdate:resizeColumn":a[3]||(a[3]=e=>S.value=e),updatedPageCount:z.value,"onUpdate:updatedPageCount":a[4]||(a[4]=e=>z.value=e),doctype:"CRM Deal",showElement:!0,showFuncImport:!1,showFuncConvertTaskCustomer:f.value,placeholderText:r.__("Search customer"),onAfterConvertTaskCustomer:a[5]||(a[5]=e=>_())},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount","showFuncConvertTaskCustomer","placeholderText"]),s.value.data&&o.value.length?(y(),h(le,{key:0,ref_key:"dealsListView",ref:m,modelValue:s.value.data.page_length_count,"onUpdate:modelValue":a[6]||(a[6]=e=>s.value.data.page_length_count=e),list:s.value,"onUpdate:list":a[7]||(a[7]=e=>s.value=e),rows:o.value,columns:s.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:s.value.data.row_count,totalCount:s.value.data.total_count},onLoadMore:a[8]||(a[8]=()=>c.value++),onColumnWidthUpdated:a[9]||(a[9]=()=>S.value++),onUpdatePageCount:a[10]||(a[10]=e=>z.value=e),onApplyFilter:a[11]||(a[11]=e=>V.value.applyFilter(e))},null,8,["modelValue","list","rows","columns","options"])):s.value.data?(y(),I("div",_e,[p("div",pe,[i(ee,{class:"h-10 w-10"}),p("span",null,T(r.__("No {0} Found",[r.__("Deals")])),1),i(n,{label:r.__("Create"),onClick:a[12]||(a[12]=e=>l.value=!0)},{prefix:b(()=>[i(t,{name:"plus",class:"h-4"})]),_:1},8,["label"])])])):R("",!0),i(de,{modelValue:l.value,"onUpdate:modelValue":a[13]||(a[13]=e=>l.value=e)},null,8,["modelValue"])],64)}}};export{Fe as default};
//# sourceMappingURL=Deals-2d2a55ec.js.map
