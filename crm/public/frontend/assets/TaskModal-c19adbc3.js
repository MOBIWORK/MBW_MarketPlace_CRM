import{ar as U,m as g,u as b,a as $,x as j,r as m,w as O,d as v,e as h,l as w,i as o,t as n,v as f,h as l,am as L,p as P,j as i,aF as z,aS as N,aR as E,D as T,aB as x,q,aQ as A,a_ as F,c as C,B as Q}from"./index-57f524e0.js";import{_ as G}from"./Link-95b990b4.js";import{D as H}from"./DatetimePicker-9b4bd588.js";const J={class:"flex items-center gap-3"},K={class:"text-2xl font-semibold leading-6 text-gray-900"},W={class:"flex flex-col gap-4"},X={class:"mb-1.5 text-sm text-gray-600"},Y={class:"mb-1.5 text-sm text-gray-600"},Z={class:"flex items-center gap-2"},ee={class:"cursor-pointer"},ae={__name:"TaskModal",props:g({task:{type:Object,default:{}},doctype:{type:String,default:"CRM Lead"},doc:{type:String,default:""}},{modelValue:{},modelModifiers:{},reloadTasks:{},reloadTasksModifiers:{}}),emits:g(["updateTask"],["update:modelValue","update:reloadTasks"]),setup(u,{emit:te}){const r=u,c=b(u,"modelValue"),y=b(u,"reloadTasks"),M=$(),{getUser:_}=j(),k=m(null),p=m(!1),a=m({title:"",description:"",assigned_to:"",due_date:"",status:"Backlog",priority:"Low",reference_doctype:r.doctype,reference_docname:null});function D(e){a.value.status=e}function V(e){a.value.priority=e}function B(){var d;if(!((d=r.task)!=null&&d.reference_docname))return;let e=r.task.reference_doctype=="CRM Deal"?"Deal":"Lead",s={leadId:r.task.reference_docname};e=="Deal"&&(s={dealId:r.task.reference_docname}),M.push({name:e,params:s})}async function R(){a.value.assigned_to||(a.value.assigned_to=_().email),a.value.name?(await C("frappe.client.set_value",{doctype:"CRM Task",name:a.value.name,fieldname:a.value})).name&&y.value.reload():(await C("frappe.client.insert",{doc:{doctype:"CRM Task",reference_doctype:r.doctype,reference_docname:r.doc||null,...a.value}})).name&&y.value.reload(),c.value=!1}return O(()=>c.value,e=>{e&&(p.value=!1,Q(()=>{k.value.el.focus(),a.value={...r.task},a.value.title&&(p.value=!0)}))}),(e,s)=>{const d=v("Button"),S=v("TextInput"),I=v("Dialog");return h(),w(I,{modelValue:c.value,"onUpdate:modelValue":s[5]||(s[5]=t=>c.value=t),options:{size:"xl",actions:[{label:p.value?e.__("Update"):e.__("Create"),variant:"solid",onClick:()=>R()}]}},{"body-title":o(()=>{var t;return[n("div",J,[n("h3",K,f(p.value?e.__("Edit Task"):e.__("Create Task")),1),(t=u.task)!=null&&t.reference_docname?(h(),w(d,{key:0,variant:"outline",size:"sm",label:u.task.reference_doctype=="CRM Deal"?e.__("Open Deal"):e.__("Open Lead"),onClick:s[0]||(s[0]=se=>B())},{suffix:o(()=>[l(L,{class:"h-4 w-4"})]),_:1},8,["label"])):P("",!0)])]}),"body-content":o(()=>[n("div",W,[n("div",null,[n("div",X,f(e.__("Title")),1),l(S,{ref_key:"title",ref:k,variant:"outline",modelValue:a.value.title,"onUpdate:modelValue":s[1]||(s[1]=t=>a.value.title=t),placeholder:e.__("Call with customer")},null,8,["modelValue","placeholder"])]),n("div",null,[n("div",Y,f(e.__("Description")),1),l(i(z),{variant:"outline",ref:"description","editor-class":"!prose-sm overflow-auto min-h-[80px] max-h-80 py-1.5 px-2 rounded border border-gray-300 bg-white hover:border-gray-400 hover:shadow-sm focus:bg-white focus:border-gray-500 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-gray-400 text-gray-800 transition-colors",bubbleMenu:!0,content:a.value.description,onChange:s[2]||(s[2]=t=>a.value.description=t),placeholder:e.__("Took a call with customer and discussed the new project.")},null,8,["content","placeholder"])]),n("div",Z,[l(i(T),{options:i(E)(D)},{default:o(()=>[l(d,{label:e.__(a.value.status),class:"w-full justify-between"},{prefix:o(()=>[l(N,{status:a.value.status},null,8,["status"])]),_:1},8,["label"])]),_:1},8,["options"]),l(G,{class:"form-control",value:i(_)(a.value.assigned_to).full_name,doctype:"User",onChange:s[3]||(s[3]=t=>a.value.assigned_to=t),hideMe:!0},{prefix:o(()=>[l(x,{class:"mr-2 !h-4 !w-4",user:a.value.assigned_to},null,8,["user"])]),"item-prefix":o(({option:t})=>[l(x,{class:"mr-2",user:t.value,size:"sm"},null,8,["user"])]),"item-label":o(({option:t})=>[l(i(q),{text:t.value},{default:o(()=>[n("div",ee,f(i(_)(t.value).full_name),1)]),_:2},1032,["text"])]),_:1},8,["value"]),l(H,{class:"datepicker w-36","icon-left":"calendar",value:a.value.due_date,onChange:s[4]||(s[4]=t=>a.value.due_date=t),placeholder:e.__("01/04/2024 11:30 PM"),"input-class":"border-none"},null,8,["value","placeholder"]),l(i(T),{options:i(F)(V)},{default:o(()=>[l(d,{label:e.__(a.value.priority),class:"w-full justify-between"},{prefix:o(()=>[l(A,{priority:a.value.priority},null,8,["priority"])]),_:1},8,["label"])]),_:1},8,["options"])])])]),_:1},8,["modelValue","options"])}}},re=U(ae,[["__scopeId","data-v-ccad9703"]]);export{re as T};
//# sourceMappingURL=TaskModal-c19adbc3.js.map
