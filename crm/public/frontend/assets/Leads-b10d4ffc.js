import{_ as le}from"./CustomActions-ca5e2014.js";import{m as Z,u as T,a as E,g as oe,w as se,r as _,o as P,s as ne,c as S,b as O,d as z,e as n,f as C,h as r,i as v,j as w,F as J,k as ie,l as V,n as ee,_ as W,p as $,P as re,q as ue,t as R,v as H,D as de,x as Q,y as ae,z as K,A as te,B as me,C as ce,E as q,G as j,H as _e,L as pe,I as G}from"./index-57f524e0.js";import{_ as fe,a as ve}from"./LayoutHeader-1b75ebc1.js";import{I as ye}from"./IndicatorIcon-42fe5203.js";import{_ as ge,s as X}from"./statuses-725e45e6.js";import{_ as be}from"./EditValueModal-38ec6b00.js";import{_ as Ce,a as ke,b as he,c as we,d as Ve,e as Me}from"./ListView-59a15338.js";import{_ as Le}from"./DatePicker-c2c1e28a.js";import{F as xe}from"./Fields-05088d1a.js";import{_ as ze}from"./ViewControls-d060515f.js";import{o as Fe}from"./organizations-8c40ce9c.js";import"./Link-95b990b4.js";import"./label-cf4377fb.js";import"./EditIcon-79477f55.js";import"./DatetimePicker-9b4bd588.js";const $e={key:0,class:"flex items-center"},Ae={key:0},Ue={key:1},De={key:2},Ie={key:3},Ne={key:4},Be=["onClick"],Re={key:1,class:"truncate text-base"},Se={key:2},Te=["onClick"],Ee={__name:"LeadsListView",props:Z({rows:{type:Array,required:!0},columns:{type:Array,required:!0},options:{type:Object,default:()=>({selectable:!0,showTooltip:!0,resizeColumn:!1,totalCount:0,rowCount:0})}},{modelValue:{},modelModifiers:{},list:{},listModifiers:{}}),emits:Z(["loadMore","updatePageCount","columnWidthUpdated","applyFilter"],["update:modelValue","update:list"]),setup(y,{expose:F,emit:M}){const k=M,g=T(y,"modelValue"),b=T(y,"list"),m=E(),{$dialog:h}=oe();se(g,(u,t)=>{u!==t&&k("updatePageCount",u)});const s=_(!1),A=_([]),d=_(()=>{});function U(u,t){A.value=u,s.value=!0,d.value=t}function D(u,t){h({title:__("Delete"),message:__("Are you sure you want to delete {0} item(s)?",[u.size]),variant:"danger",actions:[{label:__("Delete"),variant:"solid",theme:"red",onClick:e=>{S("frappe.desk.reportview.delete_items",{items:JSON.stringify(Array.from(u)),doctype:"CRM Lead"}).then(()=>{O({title:__("Deleted successfully"),icon:"check",iconClasses:"text-green-600"}),t(),b.value.reload(),e()})}}]})}const c=_([]),L=_([]);function I(u,t){let e=[{label:__("Edit"),onClick:()=>U(u,t)},{label:__("Delete"),onClick:()=>D(u,t)}];return c.value.forEach(p=>{e.push({label:__(p.label),onClick:()=>p.onClick({list:b.value,selections:u,unselectAll:t,call:S,createToast:O,$dialog:h,router:m})})}),e}return P(()=>{var u,t,e,p,o;(u=b.value)!=null&&u.data&&(ne(b.value.data,{list:b.value,call:S,createToast:O,$dialog:h,router:m}),c.value=((e=(t=b.value)==null?void 0:t.data)==null?void 0:e.bulkActions)||[],L.value=((o=(p=b.value)==null?void 0:p.data)==null?void 0:o.listActions)||[])}),F({customListActions:L}),(u,t)=>{const e=z("Badge"),p=z("FormControl"),o=z("Button");return n(),C(J,null,[r(w(Me),{class:ee(u.$attrs.class),columns:y.columns,rows:y.rows,options:{getRowRoute:a=>({name:"Lead",params:{leadId:a.name}}),selectable:y.options.selectable,showTooltip:y.options.showTooltip,resizeColumn:y.options.resizeColumn},"row-key":"name"},{default:v(()=>[r(w(Ce),{class:"mx-5",onColumnWidthUpdated:t[0]||(t[0]=a=>k("columnWidthUpdated"))}),r(w(ke),{id:"list-rows"},{default:v(()=>[(n(!0),C(J,null,ie(y.rows,a=>(n(),V(w(we),{class:"mx-5",key:a.name,row:a},{default:v(({idx:x,column:l,item:i})=>[l.key==="_assign"?(n(),C("div",$e,[r(ge,{avatars:i,size:"sm",onClick:N=>k("applyFilter",{event:N,idx:x,column:l,item:i})},null,8,["avatars","onClick"])])):(n(),V(w(he),{key:1,item:i},{prefix:v(()=>[l.key==="status"?(n(),C("div",Ae,[r(ye,{class:ee(i.color)},null,8,["class"])])):l.key==="lead_name"?(n(),C("div",Ue,[i.label?(n(),V(w(W),{key:0,class:"flex items-center",image:i.image,label:i.image_label,size:"sm"},null,8,["image","label"])):$("",!0)])):l.key==="organization"?(n(),C("div",De,[i.label?(n(),V(w(W),{key:0,class:"flex items-center",image:i.logo,label:i.label,size:"sm"},null,8,["image","label"])):$("",!0)])):l.key==="lead_owner"?(n(),C("div",Ie,[i.full_name?(n(),V(w(W),{key:0,class:"flex items-center",image:i.user_image,label:i.full_name,size:"sm"},null,8,["image","label"])):$("",!0)])):l.key==="mobile_no"?(n(),C("div",Ne,[r(re,{class:"h-4 w-4"})])):$("",!0)]),default:v(({label:N})=>[["modified","creation","first_response_time","first_responded_on","response_by"].includes(l.key)?(n(),C("div",{key:0,class:"truncate text-base",onClick:f=>k("applyFilter",{event:f,idx:x,column:l,item:i})},[r(w(ue),{text:i.label},{default:v(()=>[R("div",null,H(i.timeAgo),1)]),_:2},1032,["text"])],8,Be)):l.key==="sla_status"?(n(),C("div",Re,[i.value?(n(),V(e,{key:0,variant:"subtle",theme:i.color,size:"md",label:i.value,onClick:f=>k("applyFilter",{event:f,idx:x,column:l,item:i})},null,8,["theme","label","onClick"])):$("",!0)])):l.type==="Check"?(n(),C("div",Se,[r(p,{type:"checkbox",modelValue:i,disabled:!0,class:"text-gray-900"},null,8,["modelValue"])])):(n(),C("div",{key:3,class:"truncate text-base",onClick:f=>k("applyFilter",{event:f,idx:x,column:l,item:i})},H(u.__(N)),9,Te))]),_:2},1032,["item"]))]),_:2},1032,["row"]))),128))]),_:1}),r(w(Ve),null,{actions:v(({selections:a,unselectAll:x})=>[r(w(de),{options:I(a,x)},{default:v(()=>[r(o,{icon:"more-horizontal",variant:"ghost"})]),_:2},1032,["options"])]),_:1})]),_:1},8,["class","columns","rows","options"]),g.value?(n(),V(w(Le),{key:0,class:"border-t px-5 py-2",modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=a=>g.value=a),options:{rowCount:y.options.rowCount,totalCount:y.options.totalCount},onLoadMore:t[2]||(t[2]=a=>k("loadMore"))},null,8,["modelValue","options"])):$("",!0),r(be,{modelValue:s.value,"onUpdate:modelValue":t[3]||(t[3]=a=>s.value=a),unselectAll:d.value,"onUpdate:unselectAll":t[4]||(t[4]=a=>d.value=a),doctype:"CRM Lead",selectedValues:A.value,onReload:t[5]||(t[5]=a=>b.value.reload())},null,8,["modelValue","unselectAll","selectedValues"])],64)}}},Pe={class:"flex flex-row-reverse gap-2"},Oe={__name:"LeadModal",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(y){const{getUser:F}=Q(),{getLeadStatus:M,statusOptions:k}=X(),g=T(y,"modelValue"),b=E(),m=_(null),h=_(!1),s=ae({salutation:"",first_name:"",last_name:"",email:"",mobile_no:"",gender:"",organization:"",website:"",no_of_employees:"",territory:"",annual_revenue:"",industry:"",status:"",lead_owner:"",note:""}),A=K(()=>[{section:"Contact Details",fields:[{label:"Salutation",name:"salutation",type:"link",placeholder:__("Mr"),doctype:"Salutation"},{label:"First Name",name:"first_name",mandatory:!0,type:"data",placeholder:""},{label:"Email",name:"email",type:"data",placeholder:__("example@gmail.com")},{label:"Mobile No",name:"mobile_no",type:"data",placeholder:"0876543210"},{label:"Gender",name:"gender",type:"link",doctype:"Gender",placeholder:__("Male")}]},{section:"Organization Details",fields:[{label:"Organization",name:"organization",type:"data",placeholder:__("MBW Technologies")},{label:"Website",name:"website",type:"data",placeholder:__("https://example.com")},{label:"No of Employees",name:"no_of_employees",type:"select",options:[{label:__("1-10"),value:"1-10"},{label:__("11-50"),value:"11-50"},{label:__("51-200"),value:"51-200"},{label:__("201-500"),value:"201-500"},{label:__("501-1000"),value:"501-1000"},{label:__("1001-5000"),value:"1001-5000"},{label:__("5001-10000"),value:"5001-10000"},{label:__("10001+"),value:"10001+"}],placeholder:"1-10"},{label:"Territory",name:"territory",type:"link",doctype:"CRM Territory",placeholder:__("VietNam")},{label:"Annual Revenue",name:"annual_revenue",type:"data",placeholder:"1000000"},{label:"Industry",name:"industry",type:"link",doctype:"CRM Industry",placeholder:__("Technology")}]},{section:"Note Details",columns:3,fields:[{label:"",name:"note",type:"dropdownNote",placeholder:"",doctype:""}]},{section:"Other Details",columns:2,fields:[{label:"Status",name:"status",type:"select",options:U.value,prefix:M(s.status).iconColorClass},{label:"Lead Owner",name:"lead_owner",type:"user",placeholder:__("Lead Owner"),doctype:"User"}]}]),d=te({url:"frappe.client.insert",makeParams(c){return{doc:{doctype:"CRM Lead",...c}}}}),U=K(()=>{let c=k("lead");return s.status||(s.status=c[0].value),c});async function D(){d.submit(s,{validate(){if(m.value=null,!s.first_name)return m.value=__("First Name is mandatory"),m.value;if(s.website&&!s.website.startsWith("http")&&(s.website="https://"+s.website),s.annual_revenue&&(s.annual_revenue=s.annual_revenue.replace(/,/g,""),isNaN(s.annual_revenue)))return m.value=__("Annual Revenue should be a number"),m.value;if(s.mobile_no&&isNaN(s.mobile_no.replace(/[-+() ]/g,"")))return m.value=__("Mobile No should be a number"),m.value;if(s.email&&!s.email.includes("@"))return m.value=__("Invalid Email"),m.value;h.value=!0},async onSuccess(c){h.value=!1,g.value=!1,b.push({name:"Lead",params:{leadId:c.name}});const L=/<[^>]>/g.test(s.note);s.note&&L&&await S("frappe.client.insert",{doc:{doctype:"FCRM Note",title:c.name,content:s.note,reference_doctype:"CRM Lead",reference_docname:""}})}})}return P(()=>{s.lead_owner||(s.lead_owner=F().email)}),(c,L)=>{const I=z("ErrorMessage"),u=z("Button"),t=z("Dialog");return n(),V(t,{modelValue:g.value,"onUpdate:modelValue":L[0]||(L[0]=e=>g.value=e),options:{size:"3xl",title:c.__("Create Lead")}},{"body-content":v(()=>[r(xe,{sections:A.value,data:s},null,8,["sections","data"]),m.value?(n(),V(I,{key:0,class:"mt-4",message:c.__(m.value)},null,8,["message"])):$("",!0)]),actions:v(()=>[R("div",Pe,[r(u,{variant:"solid",label:c.__("Create"),loading:h.value,onClick:D},null,8,["label","loading"])])]),_:1},8,["modelValue","options"])}}},We=R("iframe",{id:"myFrame",style:{width:"100%",height:"350px"},src:"/app/data-import/new-data-import"},null,-1),qe={class:"flex flex-row-reverse gap-2"},je={__name:"ImportModal",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(y){Q(),X();const F=T(y,"modelValue");E(),_(null);const M=_(!1);function k(){F.value=!1}return P(()=>{me(()=>{const g=document.getElementById("myFrame");console.log(g)})}),(g,b)=>{const m=z("Button"),h=z("Dialog");return n(),V(h,{modelValue:F.value,"onUpdate:modelValue":b[0]||(b[0]=s=>F.value=s),options:{size:"4xl",title:g.__("Import")}},{"body-content":v(()=>[We]),actions:v(()=>[R("div",qe,[r(m,{variant:"solid",label:g.__("Close"),loading:M.value,onClick:k},null,8,["label","loading"])])]),_:1},8,["modelValue","options"])}}},Ge={key:1,class:"flex h-full items-center justify-center"},Je={class:"flex flex-col items-center gap-3 text-xl font-medium text-gray-500"},ua={__name:"Leads",setup(y){const F=[{label:__("Leads"),route:{name:"Leads"}}],{getUser:M}=Q(),{getOrganization:k}=Fe(),{getLeadStatus:g}=X(),{roles:b}=ce();E();const m=_(!1);P(()=>{let t=b.data;for(let e=0;e<t.length;e++)if(t[e]=="System Manager"){m.value=!0;break}});const h=_(null),s=_(!1),A=_(!1),d=_({}),U=_(1),D=_(1),c=_(20),L=_(null),I=K(()=>{var t,e,p;return(e=(t=d.value)==null?void 0:t.data)!=null&&e.data?(p=d.value)==null?void 0:p.data.data.map(o=>{var x;let a={};return(x=d.value)==null||x.data.rows.forEach(l=>{var i,N;if(a[l]=o[l],l=="lead_name")a[l]={label:o.first_name,image:o.image,image_label:o.first_name};else if(l=="organization")a[l]={label:o.organization,logo:(i=k(o.organization))==null?void 0:i.organization_logo};else if(l=="status")a[l]={label:o.status,color:(N=g(o.status))==null?void 0:N.iconColorClass};else if(l=="sla_status"){let f=o.sla_status,B=f,Y=o.sla_status=="Failed"?"red":o.sla_status=="Fulfilled"?"green":"orange";f=="First Response Due"&&(f=__(q(o.response_by)),B=j(o.response_by,G),new Date(o.response_by)<new Date&&(Y="red")),a[l]={label:B,value:f,color:Y}}else if(l=="lead_owner")a[l]={label:o.lead_owner&&M(o.lead_owner).full_name,...o.lead_owner&&M(o.lead_owner)};else if(l=="_assign"){let f=JSON.parse(o._assign)||[];!f.length&&o.lead_owner&&(f=[o.lead_owner]),a[l]=f.map(B=>({name:B,image:M(B).user_image,label:M(B).full_name}))}else if(["modified","creation"].includes(l))a[l]={label:j(o[l],G),timeAgo:__(q(o[l]))};else if(["first_response_time","first_responded_on","response_by"].includes(l)){let f=l=="response_by"?"response_by":"first_responded_on";a[l]={label:o[f]?j(o[f],G):"",timeAgo:o[l]?l=="first_response_time"?_e(o[l]):__(q(o[l])):""}}}),a}):[]});ae({salutation:"",first_name:"",last_name:"",lead_name:"",organization:"",status:"",email:"",mobile_no:"",lead_owner:""}),te({url:"frappe.client.insert",makeParams(t){return{doc:{doctype:"CRM Lead",...t}}}});function u(){A.value=!0,setTimeout(()=>{const t=document.getElementById("myFrame");if(t){const e=t.contentWindow;e&&(console.log(e),e.addEventListener("load",()=>{const p=e.document.querySelector(".navbar.navbar-expand");console.log(p),p&&(p.style.display="none")}))}},100)}return(t,e)=>{const p=z("FeatherIcon"),o=z("Button");return n(),C(J,null,[r(fe,null,{"left-header":v(()=>[r(w(ve),{items:F})]),"right-header":v(()=>{var a;return[(a=h.value)!=null&&a.customListActions?(n(),V(le,{key:0,actions:h.value.customListActions},null,8,["actions"])):$("",!0),r(o,{variant:"solid",label:t.__("Create"),onClick:e[0]||(e[0]=x=>s.value=!0)},{prefix:v(()=>[r(p,{name:"plus",class:"h-4"})]),_:1},8,["label"])]}),_:1}),r(ze,{ref_key:"viewControls",ref:L,modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=a=>d.value=a),loadMore:U.value,"onUpdate:loadMore":e[2]||(e[2]=a=>U.value=a),resizeColumn:D.value,"onUpdate:resizeColumn":e[3]||(e[3]=a=>D.value=a),updatedPageCount:c.value,"onUpdate:updatedPageCount":e[4]||(e[4]=a=>c.value=a),doctype:"CRM Lead",filters:{converted:0},showElement:!0,showFuncImport:!0,showFuncConvertTaskCustomer:m.value,placeholderText:t.__("Search customer"),onShowImportModal:u},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount","showFuncConvertTaskCustomer","placeholderText"]),d.value.data&&I.value.length?(n(),V(Ee,{key:0,ref_key:"leadsListView",ref:h,modelValue:d.value.data.page_length_count,"onUpdate:modelValue":e[5]||(e[5]=a=>d.value.data.page_length_count=a),list:d.value,"onUpdate:list":e[6]||(e[6]=a=>d.value=a),rows:I.value,columns:d.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:d.value.data.row_count,totalCount:d.value.data.total_count},onLoadMore:e[7]||(e[7]=()=>U.value++),onColumnWidthUpdated:e[8]||(e[8]=()=>D.value++),onUpdatePageCount:e[9]||(e[9]=a=>c.value=a),onApplyFilter:e[10]||(e[10]=a=>L.value.applyFilter(a))},null,8,["modelValue","list","rows","columns","options"])):d.value.data?(n(),C("div",Ge,[R("div",Je,[r(pe,{class:"h-10 w-10"}),R("span",null,H(t.__("No {0} Found",[t.__("Leads")])),1),r(o,{label:t.__("Create"),onClick:e[11]||(e[11]=a=>s.value=!0)},{prefix:v(()=>[r(p,{name:"plus",class:"h-4"})]),_:1},8,["label"])])])):$("",!0),r(Oe,{modelValue:s.value,"onUpdate:modelValue":e[12]||(e[12]=a=>s.value=a)},null,8,["modelValue"]),r(je,{modelValue:A.value,"onUpdate:modelValue":e[13]||(e[13]=a=>A.value=a)},null,8,["modelValue"])],64)}}};export{ua as default};
//# sourceMappingURL=Leads-b10d4ffc.js.map
