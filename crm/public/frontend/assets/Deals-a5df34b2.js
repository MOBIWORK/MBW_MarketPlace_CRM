import{_ as G}from"./CustomActions-18832e4f.js";import{y as P,u as q,a as J,r as m,z as Z,A as U,o as W,d as D,e as b,l as k,i as y,v as _,x as R,h as u,j as $,q as O,B as H,L as K,f as I,F as Q,a7 as X,M as S,N as T,O as Y,a8 as ee,R as N}from"./index-80088746.js";import{_ as ae,a as te}from"./LayoutHeader-7089cfb2.js";import{_ as le}from"./DealsListView-1f97f8b0.js";import{F as oe}from"./Fields-ba420322.js";import{s as j}from"./statuses-1abc44ff.js";import{_ as L}from"./Switch.vue_vue_type_script_setup_true_lang-f1352420.js";import{_ as se}from"./ViewControls-7a58e2fd.js";import{o as ne}from"./organizations-953e77cb.js";import"./IndicatorIcon-5582d004.js";import"./EditValueModal-46e7e5c5.js";import"./DatePicker-a6ecc925.js";import"./label-f4398aab.js";import"./Link-39cf38cd.js";import"./ListView-d2d0d480.js";import"./EditIcon-fdcbaced.js";import"./DatetimePicker-a73e56ce.js";const re={class:"mb-4 grid grid-cols-3 gap-4"},ie={class:"flex items-center gap-3 text-sm text-gray-600"},ue={class:"flex items-center gap-3 text-sm text-gray-600"},me={class:"flex flex-row-reverse gap-2"},de={__name:"DealModal",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(A){const{getUser:x}=P(),{getDealStatus:v,statusOptions:M}=j(),C=q(A,"modelValue"),w=J(),r=m(null),l=Z({organization:"",organization_name:"",website:"",no_of_employees:"",territory:"",annual_revenue:"",industry:"",contact:"",salutation:"",first_name:"",last_name:"",email:"",mobile_no:"",gender:"",status:"",deal_owner:""}),f=m(!1),s=m(!1),c=m(!1),h=U(()=>{let o=[];return c.value?o.push({section:"Select Organization",fields:[{label:"Organization",name:"organization",type:"link",placeholder:__("MBW Technologies"),doctype:"CRM Organization"}]}):o.push({section:"Organization Details",fields:[{label:"Organization Name",name:"organization_name",type:"data",placeholder:__("MBW Technologies")},{label:"Website",name:"website",type:"data",placeholder:__("https://example.com")},{label:"No of Employees",name:"no_of_employees",type:"select",options:[{label:__("1-10"),value:"1-10"},{label:__("11-50"),value:"11-50"},{label:__("51-200"),value:"51-200"},{label:__("201-500"),value:"201-500"},{label:__("501-1000"),value:"501-1000"},{label:__("1001-5000"),value:"1001-5000"},{label:__("5001-10000"),value:"5001-10000"},{label:__("10001+"),value:"10001+"}],placeholder:"1-10"},{label:"Territory",name:"territory",type:"link",doctype:"CRM Territory",placeholder:__("VietNam")},{label:"Annual Revenue",name:"annual_revenue",type:"data",placeholder:"9,999,999"},{label:"Industry",name:"industry",type:"link",doctype:"CRM Industry",placeholder:__("Technology")}]}),s.value?o.push({section:"Select Contact",fields:[{label:"Contact",name:"contact",type:"link",placeholder:"",doctype:"Contact"}]}):o.push({section:"Contact Details",fields:[{label:"Salutation",name:"salutation",type:"link",doctype:"Salutation",placeholder:__("Mr")},{label:"First Name",name:"first_name",type:"data",placeholder:""},{label:"Email",name:"email",type:"data",placeholder:__("example@gmail.com")},{label:"Mobile No",name:"mobile_no",type:"data",placeholder:"0876543210"},{label:"Gender",name:"gender",type:"link",doctype:"Gender",placeholder:__("Male")}]}),o.push({section:"Deal Details",columns:2,fields:[{label:"Status",name:"status",type:"select",options:V.value,prefix:v(l.status).iconColorClass},{label:"Deal Owner",name:"deal_owner",type:"user",placeholder:__("Deal Owner"),doctype:"User"}]}),o}),V=U(()=>{let o=M("deal");return l.status||(l.status=o[0].value),o});function z(){H({url:"crm.fcrm.doctype.crm_deal.crm_deal.create_deal",params:{args:l},auto:!0,validate(){if(r.value=null,l.website&&!l.website.startsWith("http")&&(l.website="https://"+l.website),l.annual_revenue&&(l.annual_revenue=l.annual_revenue.replace(/,/g,""),isNaN(l.annual_revenue)))return r.value=__("Annual Revenue should be a number"),r.value;const o=/^[\w-]+(?:\.[\w-]+)*@(?:[\w-]+\.)+[a-zA-Z]{2,}$/,p=/^(\+84|0)\d{9}$/;if(l.mobile_no&&!p.test(l.mobile_no))return r.value=__("Mobile No should be a number"),r.value;if(l.email&&!o.test(l.email))return r.value=__("Invalid Email"),r.value;f.value=!0},onSuccess(o){f.value=!1,C.value=!1,w.push({name:"Deal",params:{dealId:o}})}})}return W(()=>{l.deal_owner||(l.deal_owner=x().email)}),(o,p)=>{const i=D("ErrorMessage"),a=D("Button"),t=D("Dialog");return b(),k(t,{modelValue:C.value,"onUpdate:modelValue":p[2]||(p[2]=n=>C.value=n),options:{size:"3xl",title:o.__("Create Deal")}},{"body-content":y(()=>[_("div",re,[_("div",ie,[_("div",null,R(o.__("Choose Existing Organization")),1),u($(L),{modelValue:c.value,"onUpdate:modelValue":p[0]||(p[0]=n=>c.value=n)},null,8,["modelValue"])]),_("div",ue,[_("div",null,R(o.__("Choose Existing Contact")),1),u($(L),{modelValue:s.value,"onUpdate:modelValue":p[1]||(p[1]=n=>s.value=n)},null,8,["modelValue"])])]),u(oe,{class:"border-t pt-4",sections:h.value,data:l},null,8,["sections","data"]),r.value?(b(),k(i,{key:0,class:"mt-4",message:o.__(r.value)},null,8,["message"])):O("",!0)]),actions:y(()=>[_("div",me,[u(a,{variant:"solid",label:o.__("Create"),loading:f.value,onClick:z},null,8,["label","loading"])])]),_:1},8,["modelValue","options"])}}},pe={key:1,class:"flex h-full items-center justify-center"},_e={class:"flex flex-col items-center gap-3 text-xl font-medium text-gray-500"},Te={__name:"Deals",setup(A){const x=[{label:__("Deals"),route:{name:"Deals"}}],{getUser:v}=P(),{getOrganization:M}=ne(),{getDealStatus:C}=j(),{roles:w}=K(),r=m(null),l=m(!1),f=m(!1);W(()=>{let i=w.data;for(let a=0;a<i.length;a++)if(i[a]=="System Manager"){f.value=!0;break}});const s=m({}),c=m(1),h=m(1),V=m(20),z=m(null),o=U(()=>{var i,a;return(a=(i=s.value)==null?void 0:i.data)!=null&&a.data?s.value.data.data.map(t=>{let n={};return s.value.data.rows.forEach(e=>{var F,E;if(n[e]=t[e],e=="organization")n[e]={label:t.organization,logo:(F=M(t.organization))==null?void 0:F.organization_logo};else if(e=="annual_revenue")n[e]=X(t.annual_revenue);else if(e=="status")n[e]={label:t.status,color:(E=C(t.status))==null?void 0:E.iconColorClass};else if(e=="sla_status"){let d=t.sla_status,g=d,B=t.sla_status=="Failed"?"red":t.sla_status=="Fulfilled"?"green":"orange";d=="First Response Due"&&(d=__(S(t.response_by)),g=T(t.response_by,N),new Date(t.response_by)<new Date&&(B="red")),n[e]={label:g,value:d,color:B}}else if(e=="deal_owner")n[e]={label:t.deal_owner&&v(t.deal_owner).full_name,...t.deal_owner&&v(t.deal_owner)};else if(e=="_assign"){let d=JSON.parse(t._assign)||[];!d.length&&t.deal_owner&&(d=[t.deal_owner]),n[e]=d.map(g=>({name:g,image:v(g).user_image,label:v(g).full_name}))}else if(["modified","creation"].includes(e))n[e]={label:T(t[e],N),timeAgo:__(S(t[e]))};else if(["first_response_time","first_responded_on","response_by"].includes(e)){let d=e=="response_by"?"response_by":"first_responded_on";n[e]={label:t[d]?T(t[d],N):"",timeAgo:t[e]?e=="first_response_time"?Y(t[e]):__(S(t[e])):""}}}),n}):[]});function p(){s.value.reload()}return(i,a)=>{const t=D("FeatherIcon"),n=D("Button");return b(),I(Q,null,[u(ae,null,{"left-header":y(()=>[u($(te),{items:x})]),"right-header":y(()=>{var e;return[(e=r.value)!=null&&e.customListActions?(b(),k(G,{key:0,actions:r.value.customListActions},null,8,["actions"])):O("",!0),u(n,{variant:"solid",label:i.__("Create"),onClick:a[0]||(a[0]=F=>l.value=!0)},{prefix:y(()=>[u(t,{name:"plus",class:"h-4"})]),_:1},8,["label"])]}),_:1}),u(se,{ref_key:"viewControls",ref:z,modelValue:s.value,"onUpdate:modelValue":a[1]||(a[1]=e=>s.value=e),loadMore:c.value,"onUpdate:loadMore":a[2]||(a[2]=e=>c.value=e),resizeColumn:h.value,"onUpdate:resizeColumn":a[3]||(a[3]=e=>h.value=e),updatedPageCount:V.value,"onUpdate:updatedPageCount":a[4]||(a[4]=e=>V.value=e),doctype:"CRM Deal",showElement:!0,showFuncImport:!1,showFuncConvertTaskCustomer:f.value,placeholderText:i.__("Search customer"),onAfterConvertTaskCustomer:a[5]||(a[5]=e=>p())},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount","showFuncConvertTaskCustomer","placeholderText"]),s.value.data&&o.value.length?(b(),k(le,{key:0,ref_key:"dealsListView",ref:r,modelValue:s.value.data.page_length_count,"onUpdate:modelValue":a[6]||(a[6]=e=>s.value.data.page_length_count=e),list:s.value,"onUpdate:list":a[7]||(a[7]=e=>s.value=e),rows:o.value,columns:s.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:s.value.data.row_count,totalCount:s.value.data.total_count},onLoadMore:a[8]||(a[8]=()=>c.value++),onColumnWidthUpdated:a[9]||(a[9]=()=>h.value++),onUpdatePageCount:a[10]||(a[10]=e=>V.value=e),onApplyFilter:a[11]||(a[11]=e=>z.value.applyFilter(e))},null,8,["modelValue","list","rows","columns","options"])):s.value.data?(b(),I("div",pe,[_("div",_e,[u(ee,{class:"h-10 w-10"}),_("span",null,R(i.__("No {0} Found",[i.__("Deals")])),1),u(n,{label:i.__("Create"),onClick:a[12]||(a[12]=e=>l.value=!0)},{prefix:y(()=>[u(t,{name:"plus",class:"h-4"})]),_:1},8,["label"])])])):O("",!0),u(de,{modelValue:l.value,"onUpdate:modelValue":a[13]||(a[13]=e=>l.value=e)},null,8,["modelValue"])],64)}}};export{Te as default};
//# sourceMappingURL=Deals-a5df34b2.js.map
