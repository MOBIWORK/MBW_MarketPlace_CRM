import{m as w,u as x,r as m,w as R,d as b,e as U,l as k,i as S,v as t,E as g,x as f,h as s,j as o,I,aN as q,bn as B,c as y,aD as O}from"./index-2f04319e.js";const J={class:"flex flex-col gap-4"},$={class:"flex gap-4"},z={class:"flex-1"},F={class:"mb-1.5 text-sm text-gray-600"},L=t("span",{class:"text-red-500"},"*",-1),A={class:"flex-1"},G={class:"mb-1.5 text-sm text-gray-600"},H={class:"mb-1.5 text-sm text-gray-600"},K=t("span",{class:"text-red-500"},"*",-1),P={class:"mb-1.5 text-sm text-gray-600"},Q=t("span",{class:"text-red-500"},"*",-1),Y={__name:"EmailTemplateModal",props:w({emailTemplate:{type:Object,default:{}}},{modelValue:{},modelModifiers:{},reloadEmailTemplates:{},reloadEmailTemplatesModifiers:{}}),emits:w(["after"],["update:modelValue","update:reloadEmailTemplates"]),setup(c,{emit:W}){const v=c,r=x(c,"modelValue"),C=x(c,"reloadEmailTemplates"),i=m(""),h=m(null),T=m(null),d=m(!1);let a=m({});async function M(){if(!E())return;const e={...v.emailTemplate},l={...a.value},u=e.name!==l.name;delete e.name,delete l.name;const p=JSON.stringify(e)!==JSON.stringify(l),_=l;if(!u&&!p){r.value=!1;return}u&&await j(),p&&await D(_),V()}async function j(){return await y("frappe.client.rename_doc",{doctype:"Email Template",old_name:v.emailTemplate.name,new_name:a.value.name})}async function D(e){return(await y("frappe.client.set_value",{doctype:"Email Template",name:a.value.name,fieldname:e})).name}async function N(){if(!E())return;(await y("frappe.client.insert",{doc:{doctype:"Email Template",...a.value}})).name&&V()}function V(e){var l;(l=C.value)==null||l.reload(),r.value=!1}function E(){return a.value.name?a.value.subject?!a.value.response||a.value.response==="<p></p>"?(i.value="Content is required",!1):!0:(i.value="Subject is required",!1):(i.value="Name is required",!1)}return R(()=>r.value,e=>{e&&(d.value=!1,i.value="",O(()=>{a.value.name?h.value.el.focus():T.value.el.focus(),a.value={...v.emailTemplate},a.value.name&&(d.value=!0)}))}),(e,l)=>{const u=b("TextInput"),p=b("ErrorMessage"),_=b("Dialog");return U(),k(_,{modelValue:r.value,"onUpdate:modelValue":l[5]||(l[5]=n=>r.value=n),options:{title:d.value?e.__(c.emailTemplate.name):e.__("Create Email Template"),size:"xl",actions:[{label:d.value?e.__("Update"):e.__("Create"),variant:"solid",onClick:()=>d.value?M():N()}]}},{"body-content":S(()=>[t("div",J,[t("div",$,[t("div",z,[t("div",F,[g(f(e.__("Name"))+" ",1),L]),s(u,{ref_key:"nameRef",ref:T,variant:"outline",modelValue:o(a).name,"onUpdate:modelValue":l[0]||(l[0]=n=>o(a).name=n),placeholder:e.__("")},null,8,["modelValue","placeholder"])]),t("div",A,[t("div",G,f(e.__("Doctype")),1),s(o(I),{variant:"outline",modelValue:o(a).reference_doctype,"onUpdate:modelValue":l[1]||(l[1]=n=>o(a).reference_doctype=n),options:["CRM Deal","CRM Lead"],placeholder:e.__("CRM Deal")},null,8,["modelValue","placeholder"])])]),t("div",null,[t("div",H,[g(f(e.__("Subject"))+" ",1),K]),s(u,{ref_key:"subjectRef",ref:h,variant:"outline",modelValue:o(a).subject,"onUpdate:modelValue":l[2]||(l[2]=n=>o(a).subject=n),placeholder:e.__("")},null,8,["modelValue","placeholder"])]),t("div",null,[t("div",P,[g(f(e.__("Content"))+" ",1),Q]),s(o(q),{variant:"outline",ref:"content","editor-class":"!prose-sm overflow-auto min-h-[180px] max-h-80 py-1.5 px-2 rounded border border-gray-300 bg-white hover:border-gray-400 hover:shadow-sm focus:bg-white focus:border-gray-500 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-gray-400 text-gray-800 transition-colors",bubbleMenu:!0,content:o(a).response,onChange:l[3]||(l[3]=n=>o(a).response=n),placeholder:e.__("")},null,8,["content","placeholder"])]),t("div",null,[s(o(B),{modelValue:o(a).enabled,"onUpdate:modelValue":l[4]||(l[4]=n=>o(a).enabled=n),label:e.__("Enabled")},null,8,["modelValue","label"])]),s(p,{message:e.__(i.value)},null,8,["message"])])]),_:1},8,["modelValue","options"])}}};export{Y as _};
//# sourceMappingURL=EmailTemplateModal-d3928480.js.map
