import{_ as H}from"./CustomActions-78928ae0.js";import{A as W,B as Q,C as X,G as i,O as Y,c as $,H as J,s as z,o as b,a as D,w as y,d as p,t as E,f as u,u as R,k as A,Q as Z,V as q,b as P,F as K,ah as ee,W as U,X as N,Y as ae,ai as te,$ as T}from"./index-fd4111d0.js";import{_ as le,a as oe}from"./LayoutHeader-4431816a.js";import{_ as se}from"./DealsListView-06ed0bae.js";import{F as ne}from"./Fields-0f4da799.js";import{s as j}from"./statuses-ded37fc4.js";import{_ as G}from"./Switch.vue_vue_type_script_setup_true_lang-4098f148.js";import{_ as re}from"./ViewControls-fd4f1e0f.js";import{o as ie}from"./organizations-47b1381a.js";import"./IndicatorIcon-b09272ab.js";import"./EditValueModal-3deb1bd3.js";import"./DatePicker-808a1e66.js";import"./label-3c481436.js";import"./ListView-dc019d7b.js";import"./EditIcon-fc06c5a8.js";import"./DatetimePicker-76bd67f8.js";const ue={class:"mb-4 grid grid-cols-3 gap-4"},de={class:"flex items-center gap-3 text-sm text-gray-600"},me={class:"flex items-center gap-3 text-sm text-gray-600"},_e={class:"flex flex-row-reverse gap-2"},pe={__name:"DealModal",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(B){const{getUser:w}=W(),{getDealStatus:c,statusOptions:h}=j(),C=Q(B,"modelValue"),x=X(),d=i(null),l=Y({organization:"",organization_name:"",website:"",no_of_employees:"",territory:"",annual_revenue:"",industry:"",contact:"",salutation:"",first_name:"",last_name:"",email:"",mobile_no:"",gender:"",status:"",deal_owner:"",assign_to:JSON.stringify([])}),v=i(!1),f=i(!1),s=i(!1),S=$(()=>{let o=[];return s.value?o.push({section:"Select Organization",fields:[{label:"Organization",name:"organization",type:"link",placeholder:__("Select Organization"),doctype:"CRM Organization"}]}):o.push({section:"Organization Details",fields:[{label:"Organization Name",name:"organization_name",type:"data"},{label:"Website",name:"website",type:"data"},{label:"No of Employees",name:"no_of_employees",type:"select",options:[{label:__("1-10"),value:"1-10"},{label:__("11-50"),value:"11-50"},{label:__("51-200"),value:"51-200"},{label:__("201-500"),value:"201-500"},{label:__("501-1000"),value:"501-1000"},{label:__("1001-5000"),value:"1001-5000"},{label:__("5001-10000"),value:"5001-10000"},{label:__("10001+"),value:"10001+"}],placeholder:__("Select No Of Employees")},{label:"Territory",name:"territory",type:"link",doctype:"CRM Territory",placeholder:__("Select Territory")},{label:"Annual Revenue",name:"annual_revenue",type:"data"},{label:"Industry",name:"industry",type:"link",doctype:"CRM Industry",placeholder:__("Select Industry")}]}),f.value?o.push({section:"Select Contact",fields:[{label:"Contact",name:"contact",type:"link",placeholder:__("Select Contact"),doctype:"FCRM Contact"}]}):o.push({section:"Contact Details",fields:[{label:"Salutation",name:"salutation",type:"link",doctype:"Salutation",placeholder:__("Select Salutation")},{label:"First Name",name:"first_name",type:"data"},{label:"Email",name:"email",type:"data"},{label:"Mobile No",name:"mobile_no",type:"data"},{label:"Gender",name:"gender",type:"link",doctype:"Gender",placeholder:__("Select Gender")}]}),o.push({section:"Deal Details",columns:2,fields:[{label:"Status",name:"status",type:"select",options:V.value,prefix:c(l.status).iconColorClass},{label:"Deal Owner",name:"deal_owner",type:"user",placeholder:__("Deal Owner"),doctype:"User"}]}),o}),V=$(()=>{let o=h("deal");return l.status||(l.status=o[0].value),o});function k(){l.assign_to=JSON.stringify([l.deal_owner]),Z({url:"crm.fcrm.doctype.crm_deal.crm_deal.create_deal",params:{args:l},auto:!0,validate(){if(d.value=null,l.website&&!l.website.startsWith("http")&&(l.website="https://"+l.website),l.annual_revenue&&(l.annual_revenue=l.annual_revenue.replace(/,/g,""),isNaN(l.annual_revenue)))return d.value=__("Annual Revenue should be a number"),d.value;const o=/^[\w-]+(?:\.[\w-]+)*@(?:[\w-]+\.)+[a-zA-Z]{2,}$/;if(l.email&&!o.test(l.email))return d.value=__("Invalid Email"),d.value;v.value=!0},onSuccess(o){v.value=!1,C.value=!1,x.push({name:"Deal",params:{dealId:o}})}})}return J(()=>{l.deal_owner||(l.deal_owner=w().email)}),(o,_)=>{const F=z("ErrorMessage"),M=z("Button"),n=z("Dialog");return b(),D(n,{modelValue:C.value,"onUpdate:modelValue":_[2]||(_[2]=a=>C.value=a),options:{size:"3xl",title:o.__("Create Deal")}},{"body-content":y(()=>[p("div",ue,[p("div",de,[p("div",null,E(o.__("Choose Existing Organization")),1),u(R(G),{modelValue:s.value,"onUpdate:modelValue":_[0]||(_[0]=a=>s.value=a)},null,8,["modelValue"])]),p("div",me,[p("div",null,E(o.__("Choose Existing Contact")),1),u(R(G),{modelValue:f.value,"onUpdate:modelValue":_[1]||(_[1]=a=>f.value=a)},null,8,["modelValue"])])]),u(ne,{class:"border-t pt-4",sections:S.value,data:l},null,8,["sections","data"]),d.value?(b(),D(F,{key:0,class:"mt-4",message:o.__(d.value)},null,8,["message"])):A("",!0)]),actions:y(()=>[p("div",_e,[u(M,{variant:"solid",label:o.__("Create"),loading:v.value,onClick:k},null,8,["label","loading"])])]),_:1},8,["modelValue","options"])}}},ce={key:1,class:"flex h-full items-center justify-center"},ve={class:"flex flex-col items-center gap-3 text-xl font-medium text-gray-500"},Ue={__name:"Deals",setup(B){const w=[{label:__("Deals"),route:{name:"Deals"}}],{getUser:c}=W(),{getOrganization:h}=ie(),{getDealStatus:C}=j(),{roles:x}=q(),d=i(null),l=i(!1),v=i(!1),f=i([]);J(()=>{let n=x.data;for(let a=0;a<n.length;a++)if(n[a]=="System Manager"){v.value=!0;break}});const s=i({}),S=i(1),V=i(1),k=i(20),o=i(null),_=$(()=>{var n,a;return(a=(n=s.value)==null?void 0:n.data)!=null&&a.data?s.value.data.data.map(t=>{let r={};return s.value.data.rows.forEach(e=>{var O,I;if(r[e]=t[e],e=="organization")r[e]={label:t.organization,logo:(O=h(t.organization))==null?void 0:O.organization_logo};else if(e=="annual_revenue")r[e]=ee(t.annual_revenue);else if(e=="status")r[e]={label:t.status,color:(I=C(t.status))==null?void 0:I.iconColorClass};else if(e=="sla_status"){let m=t.sla_status,g=m,L=t.sla_status=="Failed"?"red":t.sla_status=="Fulfilled"?"green":"orange";m=="First Response Due"&&(m=__(U(t.response_by)),g=N(t.response_by,T),new Date(t.response_by)<new Date&&(L="red")),r[e]={label:g,value:m,color:L}}else if(e=="deal_owner")r[e]={label:t.deal_owner&&c(t.deal_owner).full_name,...t.deal_owner&&c(t.deal_owner)};else if(e=="_assign"){let m=JSON.parse(t._assign)||[];!m.length&&t.deal_owner&&(m=[t.deal_owner]),r[e]=m.map(g=>({name:g,image:c(g).user_image,label:c(g).full_name}))}else if(["modified","creation"].includes(e))r[e]={label:N(t[e],T),timeAgo:__(U(t[e]))};else if(["first_response_time","first_responded_on","response_by"].includes(e)){let m=e=="response_by"?"response_by":"first_responded_on";r[e]={label:t[m]?N(t[m],T):"",timeAgo:t[e]?e=="first_response_time"?ae(t[e]):__(U(t[e])):""}}}),r}):[]});function F(){s.value.reload()}function M(n){f.value=n}return(n,a)=>{const t=z("FeatherIcon"),r=z("Button");return b(),P(K,null,[u(le,null,{"left-header":y(()=>[u(R(oe),{items:w})]),"right-header":y(()=>{var e;return[(e=d.value)!=null&&e.customListActions?(b(),D(H,{key:0,actions:d.value.customListActions},null,8,["actions"])):A("",!0),u(r,{variant:"solid",label:n.__("Create"),onClick:a[0]||(a[0]=O=>l.value=!0)},{prefix:y(()=>[u(t,{name:"plus",class:"h-4"})]),_:1},8,["label"])]}),_:1}),u(re,{ref_key:"viewControls",ref:o,modelValue:s.value,"onUpdate:modelValue":a[1]||(a[1]=e=>s.value=e),loadMore:S.value,"onUpdate:loadMore":a[2]||(a[2]=e=>S.value=e),resizeColumn:V.value,"onUpdate:resizeColumn":a[3]||(a[3]=e=>V.value=e),updatedPageCount:k.value,"onUpdate:updatedPageCount":a[4]||(a[4]=e=>k.value=e),doctype:"CRM Deal",showElement:!0,showFuncImport:!1,showFuncConvertTaskCustomer:v.value,placeholderText:n.__("Search"),onAfterConvertTaskCustomer:a[5]||(a[5]=e=>F()),docSelect:f.value},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount","showFuncConvertTaskCustomer","placeholderText","docSelect"]),s.value.data&&_.value.length?(b(),D(se,{key:0,ref_key:"dealsListView",ref:d,modelValue:s.value.data.page_length_count,"onUpdate:modelValue":a[6]||(a[6]=e=>s.value.data.page_length_count=e),list:s.value,"onUpdate:list":a[7]||(a[7]=e=>s.value=e),rows:_.value,columns:s.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:s.value.data.row_count,totalCount:s.value.data.total_count},onLoadMore:a[8]||(a[8]=()=>S.value++),onColumnWidthUpdated:a[9]||(a[9]=()=>V.value++),onUpdatePageCount:a[10]||(a[10]=e=>k.value=e),onApplyFilter:a[11]||(a[11]=e=>o.value.applyFilter(e)),"onUpdate:selections":a[12]||(a[12]=e=>M(e))},null,8,["modelValue","list","rows","columns","options"])):s.value.data?(b(),P("div",ce,[p("div",ve,[u(te,{class:"h-10 w-10"}),p("span",null,E(n.__("No {0} Found",[n.__("deal")])),1),u(r,{label:n.__("Create"),onClick:a[13]||(a[13]=e=>l.value=!0)},{prefix:y(()=>[u(t,{name:"plus",class:"h-4"})]),_:1},8,["label"])])])):A("",!0),u(pe,{modelValue:l.value,"onUpdate:modelValue":a[14]||(a[14]=e=>l.value=e)},null,8,["modelValue"])],64)}}};export{Ue as default};
//# sourceMappingURL=Deals-c080df78.js.map
