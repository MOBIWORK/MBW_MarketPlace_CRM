import{ar as W,g as X,x as Y,a as Z,r as C,z as h,ab as ee,A as M,d as y,e as s,f as c,j as a,l as u,i as m,p as r,h as n,F as ae,c as $,a1 as te,a0 as oe,G as se,E as le,t as i,_ as j,U as ne,Q as v,v as d,N as ie,n as k,P as re,q as ce,aj as B,I as me}from"./index-57f524e0.js";import{_ as de,a as _e}from"./LayoutHeader-1b75ebc1.js";import{F as ue}from"./FileUploader-46b74999.js";import{_ as pe}from"./Tabs-844731e8.js";import{C as ge,_ as fe}from"./ContactModal-f10d59c5.js";import{E as be}from"./EditIcon-79477f55.js";import{C as he}from"./CameraIcon-b4c1328d.js";import{_ as ye}from"./DealsListView-272c1ebc.js";import{o as ve}from"./organizations-8c40ce9c.js";import{s as xe}from"./statuses-725e45e6.js";import{c as I}from"./settings-804601ba.js";import"./Fields-05088d1a.js";import"./IndicatorIcon-42fe5203.js";import"./Link-95b990b4.js";import"./EditValueModal-38ec6b00.js";import"./DatePicker-c2c1e28a.js";import"./label-cf4377fb.js";import"./ListView-59a15338.js";const we={key:1,class:"flex h-full flex-col overflow-hidden"},Ce={class:"flex items-center justify-start gap-6 p-5"},ke={class:"group relative h-24 w-24"},Ie={class:"z-1 absolute bottom-0 left-0 right-0 flex h-14 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-3 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(12px 0 0 0)","clip-path":"inset(12px 0 0 0)"}},ze={class:"flex flex-col gap-0.5 truncate"},De={class:"truncate text-3xl font-semibold"},Ee={key:0},Fe={class:"flex items-center gap-2 text-base text-gray-700"},Ve={key:0,class:"flex items-center gap-1.5"},Me={class:""},$e={key:1,class:"text-3xl leading-[0] text-gray-600"},je={class:""},Be={key:3,class:"text-3xl leading-[0] text-gray-600"},Ne={key:4,class:"flex items-center gap-1.5"},Se={class:""},Ue={key:5,class:"text-3xl leading-[0] text-gray-600"},Ae={class:"mt-2 flex gap-1.5"},Pe={key:1,class:"grid flex-1 place-items-center text-xl font-medium text-gray-500"},Oe={class:"flex flex-col items-center justify-center space-y-3"},Re={__name:"Contact",props:{contactId:{type:String,required:!0}},setup(N){const{$dialog:S,makeCall:U}=X(),{getUser:z}=Y(),{getOrganization:D}=ve(),{getDealStatus:A}=xe(),_=N,P=Z(),g=C(!1),x=C(!1),O=h(()=>{var o;let e=[{label:__("Contacts"),route:{name:"Contacts"}}];return e.push({label:(o=t.data)==null?void 0:o.full_name,route:{name:"Contact",params:{contactId:_.contactId}}}),e});function R(e){let o=e.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(o))return __("Only PNG and JPG images are allowed")}async function E(e){await $("frappe.client.set_value",{doctype:"Contact",name:_.contactId,fieldname:"image",value:(e==null?void 0:e.file_url)||""}),t.reload()}async function G(){S({title:__("Delete contact"),message:__("Are you sure you want to delete this contact?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",async onClick(e){await $("frappe.client.delete",{doctype:"Contact",name:_.contactId}),e(),P.push({name:"Contacts"})}}]})}const F=C(0),T=[{label:"Deals",icon:ee(te,{class:"h-4 w-4"}),count:h(()=>{var e;return(e=f.data)==null?void 0:e.length})}],t=M({url:"crm.api.contact.get_contact",cache:["contact",_.contactId],params:{name:_.contactId},auto:!0,transform:e=>({...e,actual_mobile_no:e.mobile_no,mobile_no:e.mobile_no})}),f=M({url:"crm.api.contact.get_linked_deals",cache:["deals",_.contactId],params:{contact:_.contactId},auto:!0}),w=h(()=>!f.data||f.data==[]?[]:f.data.map(e=>L(e))),q=h(()=>J);function L(e){var o,p;return{name:e.name,organization:{label:e.organization,logo:(o=D(e.organization))==null?void 0:o.organization_logo},annual_revenue:oe(e.annual_revenue),status:{label:e.status,color:(p=A(e.status))==null?void 0:p.iconColorClass},email:e.email,mobile_no:e.mobile_no,deal_owner:{label:e.deal_owner&&z(e.deal_owner).full_name,...e.deal_owner&&z(e.deal_owner)},modified:{label:se(e.modified,me),timeAgo:__(le(e.modified))}}}const J=[{label:__("Organization"),key:"organization",width:"11rem"},{label:__("Amount"),key:"annual_revenue",width:"9rem"},{label:__("Status"),key:"status",width:"10rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Mobile no"),key:"mobile_no",width:"11rem"},{label:__("Deal owner"),key:"deal_owner",width:"10rem"},{label:__("Last modified"),key:"modified",width:"8rem"}];return(e,o)=>{const p=y("Button"),Q=y("FeatherIcon"),H=y("ErrorMessage"),K=y("Badge");return s(),c(ae,null,[a(t).data?(s(),u(de,{key:0},{"left-header":m(()=>[n(a(_e),{items:O.value},null,8,["items"])]),_:1})):r("",!0),a(t).data?(s(),c("div",we,[n(a(ue),{onSuccess:E,validateFile:R},{default:m(({openFileSelector:l,error:b})=>{var V;return[i("div",Ce,[i("div",ke,[n(a(j),{size:"3xl",class:"h-24 w-24",label:a(t).data.full_name,image:a(t).data.image},null,8,["label","image"]),(s(),u(v(a(t).data.image?fe:"div"),ne(a(t).data.image?{options:[{icon:"upload",label:a(t).data.image?e.__("Change image"):e.__("Upload image"),onClick:l},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>E("")}]}:{onClick:l},{class:"!absolute bottom-0 left-0 right-0"}),{default:m(()=>[i("div",Ie,[n(he,{class:"h-6 w-6 cursor-pointer text-white"})])]),_:2},1040))]),i("div",ze,[i("div",De,[a(t).data.salutation?(s(),c("span",Ee,d(a(t).data.salutation+". "),1)):r("",!0),i("span",null,d(a(t).data.full_name),1)]),i("div",Fe,[a(t).data.email_id?(s(),c("div",Ve,[n(ie,{class:"h-4 w-4"}),i("span",Me,d(a(t).data.email_id),1)])):r("",!0),a(t).data.email_id?(s(),c("span",$e," · ")):r("",!0),a(t).data.actual_mobile_no?(s(),u(v(a(I)?a(ce):"div"),{key:2,text:e.__("Make Call")},{default:m(()=>[i("div",{class:k(["flex items-center gap-1.5",a(I)?"cursor-pointer":""]),onClick:o[0]||(o[0]=Ge=>a(I)&&a(U)(a(t).data.actual_mobile_no))},[n(re,{class:"h-4 w-4"}),i("span",je,d(a(t).data.actual_mobile_no),1)],2)]),_:1},8,["text"])):r("",!0),a(t).data.actual_mobile_no?(s(),c("span",Be," · ")):r("",!0),a(t).data.company_name?(s(),c("div",Ne,[n(a(j),{size:"xs",label:a(t).data.company_name,image:(V=a(D)(a(t).data.company_name))==null?void 0:V.organization_logo},null,8,["label","image"]),i("span",Se,d(a(t).data.company_name),1)])):r("",!0),a(t).data.company_name?(s(),c("span",Ue," · ")):r("",!0),a(t).data.email_id||a(t).data.mobile_no||a(t).data.company_name?(s(),u(p,{key:6,variant:"ghost",label:e.__("More"),class:"-ml-1 cursor-pointer hover:text-gray-900",onClick:o[1]||(o[1]=()=>{x.value=!0,g.value=!0})},null,8,["label"])):r("",!0)]),i("div",Ae,[n(p,{label:e.__("Edit"),size:"sm",onClick:o[2]||(o[2]=()=>{x.value=!1,g.value=!0})},{prefix:m(()=>[n(be,{class:"h-4 w-4"})]),_:1},8,["label"]),n(p,{label:e.__("Delete"),theme:"red",size:"sm",onClick:G},{prefix:m(()=>[n(Q,{name:"trash-2",class:"h-4 w-4"})]),_:1},8,["label"])]),n(H,{message:e.__(b)},null,8,["message"])])])]}),_:1}),n(a(pe),{class:"overflow-hidden",modelValue:F.value,"onUpdate:modelValue":o[3]||(o[3]=l=>F.value=l),tabs:T},{tab:m(({tab:l,selected:b})=>[i("button",{class:k(["group flex items-center gap-2 border-b border-transparent py-2.5 text-base text-gray-600 duration-300 ease-in-out hover:border-gray-400 hover:text-gray-900",{"text-gray-900":b}])},[l.icon?(s(),u(v(l.icon),{key:0,class:"h-5"})):r("",!0),B(" "+d(e.__(l.label))+" ",1),n(K,{class:k(["group-hover:bg-gray-900",[b?"bg-gray-900":"bg-gray-600"]]),variant:"solid",theme:"gray",size:"sm"},{default:m(()=>[B(d(l.count),1)]),_:2},1032,["class"])],2)]),default:m(({tab:l})=>[l.label==="Deals"&&w.value.length?(s(),u(ye,{key:0,class:"mt-4",rows:w.value,columns:q.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):r("",!0),w.value.length?r("",!0):(s(),c("div",Pe,[i("div",Oe,[(s(),u(v(l.icon),{class:"!h-10 !w-10"})),i("div",null,d(e.__("No {0} Found",[e.__(l.label)])),1)])]))]),_:1},8,["modelValue"])])):r("",!0),n(ge,{modelValue:g.value,"onUpdate:modelValue":o[4]||(o[4]=l=>g.value=l),contact:a(t),options:{detailMode:x.value}},null,8,["modelValue","contact","options"])],64)}}},ia=W(Re,[["__scopeId","data-v-e940a3fb"]]);export{ia as default};
//# sourceMappingURL=Contact-c6aed21e.js.map
