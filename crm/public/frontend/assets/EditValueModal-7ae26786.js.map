{"version":3,"file":"EditValueModal-7ae26786.js","sources":["../../../../frontend/src/components/Modals/EditValueModal.vue"],"sourcesContent":["<template>\n  <Dialog v-model=\"show\" :options=\"{ title: __('Bulk Edit') }\">\n    <template #body-content>\n      <div class=\"mb-4\">\n        <div class=\"mb-1.5 text-sm text-gray-600\">{{ __('Field') }}</div>\n        <Autocomplete\n          :value=\"field.label\"\n          :options=\"fields.data\"\n          @change=\"(e) => changeField(e)\"\n          :placeholder=\"__('Source')\"\n        />\n      </div>\n      <div>\n        <div class=\"mb-1.5 text-sm text-gray-600\">{{ __('Value') }}</div>\n        <component\n          :is=\"getValueComponent(field)\"\n          :value=\"newValue\"\n          size=\"md\"\n          @change=\"(v) => updateValue(v)\"\n          :placeholder=\"__('Contact Us')\"\n        />\n      </div>\n    </template>\n    <template #actions>\n      <Button\n        class=\"w-full\"\n        variant=\"solid\"\n        @click=\"updateValues\"\n        :loading=\"loading\"\n        :label=\"__('Update {0} Records', [recordCount])\"\n      />\n    </template>\n  </Dialog>\n</template>\n\n<script setup>\nimport DatePicker from '@/components/Controls/DatePicker.vue'\nimport Link from '@/components/Controls/Link.vue'\nimport Autocomplete from '@/components/frappe-ui/Autocomplete.vue'\nimport { FormControl, call, createResource, TextEditor } from 'frappe-ui'\nimport { ref, computed, onMounted, h } from 'vue'\n\nconst typeCheck = ['Check']\nconst typeLink = ['Link', 'Dynamic Link']\nconst typeNumber = ['Float', 'Int', 'Currency', 'Percent']\nconst typeSelect = ['Select']\nconst typeEditor = ['Text Editor']\nconst typeDate = ['Date', 'Datetime']\n\nconst props = defineProps({\n  doctype: {\n    type: String,\n    required: true,\n  },\n  selectedValues: {\n    type: Array,\n    required: true,\n  },\n})\n\nconst show = defineModel()\nconst unselectAll = defineModel('unselectAll')\n\nconst emit = defineEmits(['reload'])\n\nconst fields = createResource({\n  url: 'crm.api.doc.get_fields',\n  cache: ['fields', props.doctype],\n  params: {\n    doctype: props.doctype,\n  },\n})\n\nonMounted(() => {\n  if (fields.data?.length) return\n  fields.fetch()\n})\n\nconst recordCount = computed(() => props.selectedValues?.size || 0)\n\nconst field = ref({\n  label: '',\n  type: '',\n  value: '',\n  options: '',\n})\n\nconst newValue = ref('')\nconst loading = ref(false)\n\nfunction updateValues() {\n  let fieldVal = newValue.value\n  if (field.value.type == 'Check') {\n    fieldVal = fieldVal == 'Yes' ? 1 : 0\n  }\n  loading.value = true\n  call(\n    'frappe.desk.doctype.bulk_update.bulk_update.submit_cancel_or_update_docs',\n    {\n      doctype: props.doctype,\n      docnames: Array.from(props.selectedValues),\n      action: 'update',\n      data: {\n        [field.value.value]: fieldVal || null,\n      },\n    }\n  ).then(() => {\n    field.value = {\n      label: '',\n      type: '',\n      value: '',\n      options: '',\n    }\n    newValue.value = ''\n    loading.value = false\n    show.value = false\n    unselectAll.value()\n    emit('reload')\n  })\n}\n\nfunction changeField(f) {\n  newValue.value = ''\n  if (!f) return\n  field.value = f\n}\n\nfunction updateValue(v) {\n  let value = v.target ? v.target.value : v\n  newValue.value = value\n}\n\nfunction getValueComponent(f) {\n  const { type, options } = f\n  if (typeSelect.includes(type) || typeCheck.includes(type)) {\n    const _options = type == 'Check' ? ['Yes', 'No'] : getSelectOptions(options)\n    return h(FormControl, {\n      type: 'select',\n      options: _options.map((o) => ({\n        label: o,\n        value: o,\n      })),\n    })\n  } else if (typeLink.includes(type)) {\n    if (type == 'Dynamic Link') {\n      return h(FormControl, { type: 'text' })\n    }\n    return h(Link, { class: 'form-control', doctype: options })\n  } else if (typeNumber.includes(type)) {\n    return h(FormControl, { type: 'number' })\n  } else if (typeDate.includes(type)) {\n    return h(DatePicker)\n  } else if (typeEditor.includes(type)) {\n    return h(TextEditor, {\n      variant: 'outline',\n      editorClass:\n        '!prose-sm overflow-auto min-h-[80px] max-h-80 py-1.5 px-2 rounded border border-gray-300 bg-white hover:border-gray-400 hover:shadow-sm focus:bg-white focus:border-gray-500 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-gray-400 text-gray-800 transition-colors',\n      bubbleMenu: true,\n      content: newValue.value,\n    })\n  } else {\n    return h(FormControl, { type: 'text' })\n  }\n}\n</script>\n"],"names":["typeCheck","typeLink","typeNumber","typeSelect","typeEditor","typeDate","props","__props","show","_useModel","unselectAll","emit","__emit","fields","createResource","onMounted","_a","recordCount","computed","field","ref","newValue","loading","updateValues","fieldVal","call","changeField","f","updateValue","v","value","getValueComponent","type","options","_options","h","FormControl","o","Link","DatePicker","TextEditor"],"mappings":"wlBA0CA,MAAMA,EAAY,CAAC,OAAO,EACpBC,EAAW,CAAC,OAAQ,cAAc,EAClCC,EAAa,CAAC,QAAS,MAAO,WAAY,SAAS,EACnDC,EAAa,CAAC,QAAQ,EACtBC,EAAa,CAAC,aAAa,EAC3BC,EAAW,CAAC,OAAQ,UAAU,EAE9BC,EAAQC,EAWRC,EAAOC,gBAAY,EACnBC,EAAcD,EAAWF,EAAC,aAAa,EAEvCI,EAAOC,EAEPC,EAASC,EAAe,CAC5B,IAAK,yBACL,MAAO,CAAC,SAAUR,EAAM,OAAO,EAC/B,OAAQ,CACN,QAASA,EAAM,OAChB,CACH,CAAC,EAEDS,EAAU,IAAM,QACVC,EAAAH,EAAO,OAAP,MAAAG,EAAa,QACjBH,EAAO,MAAO,CAChB,CAAC,EAED,MAAMI,EAAcC,EAAS,IAAM,OAAA,QAAAF,EAAAV,EAAM,iBAAN,YAAAU,EAAsB,OAAQ,EAAC,EAE5DG,EAAQC,EAAI,CAChB,MAAO,GACP,KAAM,GACN,MAAO,GACP,QAAS,EACX,CAAC,EAEKC,EAAWD,EAAI,EAAE,EACjBE,EAAUF,EAAI,EAAK,EAEzB,SAASG,GAAe,CACtB,IAAIC,EAAWH,EAAS,MACpBF,EAAM,MAAM,MAAQ,UACtBK,EAAWA,GAAY,MAAQ,EAAI,GAErCF,EAAQ,MAAQ,GAChBG,EACE,2EACA,CACE,QAASnB,EAAM,QACf,SAAU,MAAM,KAAKA,EAAM,cAAc,EACzC,OAAQ,SACR,KAAM,CACJ,CAACa,EAAM,MAAM,KAAK,EAAGK,GAAY,IAClC,CACF,CACF,EAAC,KAAK,IAAM,CACXL,EAAM,MAAQ,CACZ,MAAO,GACP,KAAM,GACN,MAAO,GACP,QAAS,EACV,EACDE,EAAS,MAAQ,GACjBC,EAAQ,MAAQ,GAChBd,EAAK,MAAQ,GACbE,EAAY,MAAO,EACnBC,EAAK,QAAQ,CACjB,CAAG,CACH,CAEA,SAASe,EAAYC,EAAG,CACtBN,EAAS,MAAQ,GACZM,IACLR,EAAM,MAAQQ,EAChB,CAEA,SAASC,EAAYC,EAAG,CACtB,IAAIC,EAAQD,EAAE,OAASA,EAAE,OAAO,MAAQA,EACxCR,EAAS,MAAQS,CACnB,CAEA,SAASC,EAAkBJ,EAAG,CAC5B,KAAM,CAAE,KAAAK,EAAM,QAAAC,CAAO,EAAKN,EAC1B,GAAIxB,EAAW,SAAS6B,CAAI,GAAKhC,EAAU,SAASgC,CAAI,EAAG,CACzD,MAAME,EAAWF,GAAQ,QAAU,CAAC,MAAO,IAAI,EAAI,iBAAiBC,CAAO,EAC3E,OAAOE,EAAEC,EAAa,CACpB,KAAM,SACN,QAASF,EAAS,IAAKG,IAAO,CAC5B,MAAOA,EACP,MAAOA,CACf,EAAQ,CACR,CAAK,CACF,KAAM,QAAIpC,EAAS,SAAS+B,CAAI,EAC3BA,GAAQ,eACHG,EAAEC,EAAa,CAAE,KAAM,MAAM,CAAE,EAEjCD,EAAEG,EAAM,CAAE,MAAO,eAAgB,QAASL,EAAS,EACjD/B,EAAW,SAAS8B,CAAI,EAC1BG,EAAEC,EAAa,CAAE,KAAM,QAAQ,CAAE,EAC/B/B,EAAS,SAAS2B,CAAI,EACxBG,EAAEI,CAAU,EACVnC,EAAW,SAAS4B,CAAI,EAC1BG,EAAEK,EAAY,CACnB,QAAS,UACT,YACE,6RACF,WAAY,GACZ,QAASnB,EAAS,KACxB,CAAK,EAEMc,EAAEC,EAAa,CAAE,KAAM,MAAM,CAAE,CAE1C"}