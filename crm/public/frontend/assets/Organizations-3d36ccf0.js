import{_ as W}from"./CustomActions-6e5afc2b.js";import{z as T,A as D,B as j,C as q,D as J,E as r,G as X,H as G,I as E,J as P,s as A,o as d,b as g,f as s,w as m,u as f,F as B,x as H,a as M,K,k as U,L as Q,d as h,t as I,M as Y,aX as Z,c as S,ah as ee,X as te,W as ae,ae as oe,$ as le}from"./index-b021dd3e.js";import{_ as ne,a as se}from"./LayoutHeader-f9685323.js";import{_ as ie}from"./OrganizationModal-ee1e8b70.js";import{_ as ue}from"./EditValueModal-89794f46.js";import{_ as re,a as de,b as me,c as pe,e as ce,d as fe}from"./ListView-913eec95.js";import{_ as ve}from"./DatePicker-ecb1c2b9.js";import{_ as _e}from"./ViewControls-afbfa000.js";import"./Fields-e3ae06e2.js";import"./EditIcon-5d716aa9.js";import"./IndicatorIcon-50d2ec44.js";import"./label-241d26b1.js";import"./DatetimePicker-85b575c4.js";const ge={key:0},Ce=["onClick"],ye={key:1},be=["onClick"],we={__name:"OrganizationsListView",props:T({rows:{type:Array,required:!0},columns:{type:Array,required:!0},options:{type:Object,default:()=>({selectable:!0,showTooltip:!0,resizeColumn:!1,totalCount:0,rowCount:0})}},{modelValue:{},modelModifiers:{},list:{},listModifiers:{}}),emits:T(["loadMore","updatePageCount","columnWidthUpdated","applyFilter","update:selections"],["update:modelValue","update:list"]),setup(p,{expose:F,emit:k}){const c=k,b=D(p,"modelValue"),v=D(p,"list"),O=j(),{$dialog:i}=q();J(b,(e,t)=>{e!==t&&c("updatePageCount",e)});const C=r(!1),w=r([]),y=r(()=>{});function V(e,t){w.value=e,C.value=!0,y.value=t}function $(e,t){i({title:__("Delete"),message:__("Are you sure you want to delete {0} item(s)?",[e.size]),variant:"danger",actions:[{label:__("Delete"),variant:"solid",theme:"red",onClick:l=>{E("frappe.desk.reportview.delete_items",{items:JSON.stringify(Array.from(e)),doctype:"CRM Organization"}).then(()=>{P({title:__("Deleted successfully"),icon:"check",iconClasses:"text-green-600"}),t(),v.value.reload(),l()})}}]})}const x=r([]);function L(e,t){return[{label:__("Edit"),onClick:()=>V(e,t)},{label:__("Delete"),onClick:()=>$(e,t)}]}function o(e){let t=[];e.forEach(l=>{t.push(l)}),c("update:selections",t)}return X(()=>{var e,t,l;(e=v.value)!=null&&e.data&&(G(v.value.data,{list:v.value,call:E,createToast:P,$dialog:i,router:O}),x.value=((l=(t=v.value)==null?void 0:t.data)==null?void 0:l.listActions)||[])}),F({customListActions:x}),(e,t)=>{const l=A("FormControl"),a=A("Button");return d(),g(B,null,[s(f(fe),{columns:p.columns,rows:p.rows,options:{getRowRoute:n=>({name:"Organization",params:{organizationId:n.name}}),selectable:p.options.selectable,showTooltip:p.options.showTooltip,resizeColumn:p.options.resizeColumn},"row-key":"name","onUpdate:selections":t[1]||(t[1]=n=>o(n))},{default:m(()=>[s(f(re),{class:"mx-5",onColumnWidthUpdated:t[0]||(t[0]=n=>c("columnWidthUpdated"))}),s(f(de),{id:"list-rows"},{default:m(()=>[(d(!0),g(B,null,H(p.rows,n=>(d(),M(f(pe),{class:"mx-5",key:n.name,row:n},{default:m(({idx:u,column:z,item:_})=>[s(f(me),{item:_},{prefix:m(()=>[z.key==="organization_name"?(d(),g("div",ge,[_.label?(d(),M(f(K),{key:0,class:"flex items-center",image:_.logo,label:_.label,size:"sm"},null,8,["image","label"])):U("",!0)])):U("",!0)]),default:m(({label:N})=>[["modified","creation"].includes(z.key)?(d(),g("div",{key:0,class:"truncate text-base",onClick:R=>c("applyFilter",{event:R,idx:u,column:z,item:_})},[s(f(Q),{text:_.label},{default:m(()=>[h("div",null,I(_.timeAgo),1)]),_:2},1032,["text"])],8,Ce)):z.type==="Check"?(d(),g("div",ye,[s(l,{type:"checkbox",modelValue:_,disabled:!0,class:"text-gray-900"},null,8,["modelValue"])])):(d(),g("div",{key:2,class:"truncate text-base",onClick:R=>c("applyFilter",{event:R,idx:u,column:z,item:_})},I(e.__(N)),9,be))]),_:2},1032,["item"])]),_:2},1032,["row"]))),128))]),_:1}),s(f(ce),null,{actions:m(({selections:n,unselectAll:u})=>[s(f(Y),{options:L(n,u)},{default:m(()=>[s(a,{icon:"more-horizontal",variant:"ghost"})]),_:2},1032,["options"])]),_:1})]),_:1},8,["columns","rows","options"]),s(f(ve),{class:"border-t px-5 py-2",modelValue:b.value,"onUpdate:modelValue":t[2]||(t[2]=n=>b.value=n),options:{rowCount:p.options.rowCount,totalCount:p.options.totalCount},onLoadMore:t[3]||(t[3]=n=>c("loadMore"))},null,8,["modelValue","options"]),s(ue,{modelValue:C.value,"onUpdate:modelValue":t[4]||(t[4]=n=>C.value=n),unselectAll:y.value,"onUpdate:unselectAll":t[5]||(t[5]=n=>y.value=n),doctype:"CRM Organization",selectedValues:w.value,onReload:t[6]||(t[6]=n=>v.value.reload())},null,8,["modelValue","unselectAll","selectedValues"])],64)}}},ke={key:1,class:"flex h-full items-center justify-center"},ze={class:"flex flex-col items-center gap-3 text-xl font-medium text-gray-500"},Ie={__name:"Organizations",setup(p){const F=Z(),k=r(null),c=r(!1),b=r([]),v=S(()=>{var o,e,t;return(t=(e=(o=i.value)==null?void 0:o.data)==null?void 0:e.data)==null?void 0:t.find(l=>l.name===F.params.organizationId)}),O=S(()=>{let o=[{label:__("Organizations"),route:{name:"Organizations"}}];return v.value&&o.push({label:__(v.value.name),route:{name:"Organization",params:{organizationId:v.value.name}}}),o}),i=r({}),C=r(1),w=r(1),y=r(20),V=r(null),$=S(()=>{var o,e,t;return(e=(o=i.value)==null?void 0:o.data)!=null&&e.data?(t=i.value)==null?void 0:t.data.data.map(l=>{var n;let a={};return(n=i.value)==null||n.data.rows.forEach(u=>{a[u]=l[u],u==="organization_name"?a[u]={label:l.organization_name,logo:l.organization_logo}:u==="website"?a[u]=x(l.website):u==="annual_revenue"?a[u]=ee(l.annual_revenue):["modified","creation"].includes(u)&&(a[u]={label:te(l[u],le),timeAgo:__(ae(l[u]))})}),a}):[]});function x(o){return o&&o.replace(/^(?:https?:\/\/)?(?:www\.)?/i,"")}function L(o){b.value=o}return(o,e)=>{const t=A("FeatherIcon"),l=A("Button");return d(),g(B,null,[s(ne,null,{"left-header":m(()=>[s(f(se),{items:O.value},null,8,["items"])]),"right-header":m(()=>{var a;return[(a=k.value)!=null&&a.customListActions?(d(),M(W,{key:0,actions:k.value.customListActions},null,8,["actions"])):U("",!0),s(l,{variant:"solid",label:o.__("Create"),onClick:e[0]||(e[0]=n=>c.value=!0)},{prefix:m(()=>[s(t,{name:"plus",class:"h-4"})]),_:1},8,["label"])]}),_:1}),s(_e,{ref_key:"viewControls",ref:V,modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=a=>i.value=a),loadMore:C.value,"onUpdate:loadMore":e[2]||(e[2]=a=>C.value=a),resizeColumn:w.value,"onUpdate:resizeColumn":e[3]||(e[3]=a=>w.value=a),updatedPageCount:y.value,"onUpdate:updatedPageCount":e[4]||(e[4]=a=>y.value=a),doctype:"CRM Organization",showElement:!0,placeholderText:o.__("Search organization"),docSelect:b.value},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount","placeholderText","docSelect"]),i.value.data&&$.value.length?(d(),M(we,{key:0,ref_key:"organizationsListView",ref:k,modelValue:i.value.data.page_length_count,"onUpdate:modelValue":e[5]||(e[5]=a=>i.value.data.page_length_count=a),list:i.value,"onUpdate:list":e[6]||(e[6]=a=>i.value=a),rows:$.value,columns:i.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:i.value.data.row_count,totalCount:i.value.data.total_count},onLoadMore:e[7]||(e[7]=()=>C.value++),onColumnWidthUpdated:e[8]||(e[8]=()=>w.value++),onUpdatePageCount:e[9]||(e[9]=a=>y.value=a),onApplyFilter:e[10]||(e[10]=a=>V.value.applyFilter(a)),"onUpdate:selections":e[11]||(e[11]=a=>L(a))},null,8,["modelValue","list","rows","columns","options"])):i.value.data?(d(),g("div",ke,[h("div",ze,[s(oe,{class:"h-10 w-10"}),h("span",null,I(o.__("No {0} Found",[o.__("organizations")])),1),s(l,{label:o.__("Create"),onClick:e[12]||(e[12]=a=>c.value=!0)},{prefix:m(()=>[s(t,{name:"plus",class:"h-4"})]),_:1},8,["label"])])])):U("",!0),s(ie,{modelValue:c.value,"onUpdate:modelValue":e[13]||(e[13]=a=>c.value=a)},null,8,["modelValue"])],64)}}};export{Ie as default};
//# sourceMappingURL=Organizations-3d36ccf0.js.map
