import{_ as _e,a as pe,A as fe,C as ve,b as ge,L as be,S as xe,c as Ce}from"./SLASection-7b74116f.js";import{g as ye,S as he,a as we,B as P,T as ke,U as Ve,o as Ie,r as _,A as T,d as U,e as d,f as v,j as s,l as p,i as n,q as g,h as o,F as q,b as y,c as B,V as W,P as G,W as Ue,X as ze,Y as Ae,Z as J,n as X,D as Y,$ as Le,v as i,x as f,a0 as $e,p as Se,a1 as Ee,t as z,a2 as M,a3 as Ne,k as De,a4 as Te,a5 as Be,a6 as Z,a7 as Me}from"./index-c24d0e80.js";import{I as Fe}from"./IndicatorIcon-6da46cb2.js";import{C as je}from"./CameraIcon-b7b99ab5.js";import{_ as Oe,a as Re}from"./LayoutHeader-f4141a44.js";import{s as Pe,_ as qe}from"./statuses-ea7f6642.js";import{_ as We}from"./CustomActions-fff8b307.js";import{o as Ge}from"./organizations-aff83443.js";import{c as H,w as Je}from"./settings-95ae48e5.js";import{F as Xe}from"./FileUploader-fffa04ee.js";import{_ as K}from"./Switch.vue_vue_type_script_setup_true_lang-9e1f5a50.js";import{_ as Ye}from"./Tabs-cd086e65.js";import"./FadedScrollableDiv-ec740faa.js";import"./CalendarIcon-47c72ba0.js";import"./EmailTemplateModal-258b37b4.js";import"./TaskModal-ed44619e.js";import"./DatetimePicker-dd440c1e.js";/* empty css                                                                       */import"./label-0a4351d9.js";const Ze={key:1,class:"flex h-full overflow-hidden"},He={class:"flex items-center justify-start gap-5 border-b p-5"},Ke={class:"group relative size-12"},Qe={class:"z-1 absolute bottom-0.5 left-0 right-0.5 flex h-9 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-3 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(12px 0 0 0)","clip-path":"inset(12px 0 0 0)"}},ea={class:"flex flex-col gap-2.5 truncate"},aa={class:"truncate text-2xl font-medium"},ta={class:"flex gap-1.5"},sa={key:1,class:"flex flex-1 flex-col justify-between overflow-hidden"},la={class:"flex flex-col overflow-y-auto"},oa={class:"mb-4 flex items-center gap-2 text-gray-600"},na={class:"block text-base"},ia={class:"ml-6"},da={class:"flex items-center justify-between text-base"},ra={key:1,class:"mt-2.5 text-base"},ua={class:"mb-4 mt-6 flex items-center gap-2 text-gray-600"},ma={class:"block text-base"},ca={class:"ml-6"},_a={class:"flex items-center justify-between text-base"},pa={key:1,class:"mt-2.5 text-base"},Na={__name:"Lead",props:{leadId:{type:String,required:!0}},setup(Q){const{$dialog:ee,makeCall:ae}=ye(),{getContactByName:h,contacts:te}=he(),{organizations:se}=Ge(),{statusOptions:le,getLeadStatus:oe}=Pe(),A=we(),L=Q,a=P({url:"crm.fcrm.doctype.crm_lead.api.get_lead",params:{name:L.leadId},cache:["lead",L.leadId],onSuccess:t=>{ke(t),Ve(t,{doc:t,$dialog:ee,router:A,updateField:b,createToast:y,deleteDoc:me,call:B})}});Ie(()=>{a.data||(a.fetch(),window.location.hash!=null&&window.location.hash!=""&&(w.value=4))});const $=_(!1),S=_(!1);function ne(){a.fetch()}function F(t,e,r){if(e=Array.isArray(t)?"":e,!Array.isArray(t)&&ie(t,e))return;let m=1;P({url:"frappe.client.set_value",params:{doctype:"CRM Lead",name:L.leadId,fieldname:t,value:e},auto:!0,onSuccess:()=>{a.reload(),$.value=!0,y({title:__("Lead updated"),icon:"check",iconClasses:"text-green-600"}),r==null||r()},onError:N=>{var I;m>0&&(y({title:__("Error updating lead"),text:__((I=N.messages)==null?void 0:I[0]),icon:"x",iconClasses:"text-red-600"}),m-=1)}})}function ie(t,e){var m;let r=a.data.all_fields||{};return(m=r[t])!=null&&m.reqd&&!e?(y({title:__("Error Updating Lead"),text:__("{0} is a required field",[r[t].label]),icon:"x",iconClasses:"text-red-600"}),!0):!1}const de=T(()=>{let t=[{label:__("Leads"),route:{name:"Leads"}}];return t.push({label:a.data.first_name||__("Untitled"),route:{name:"Lead",params:{leadId:a.data.name}}}),t}),w=_(0),re=T(()=>[{name:"Activity",label:__("Activity"),icon:fe},{name:"Emails",label:__("Emails"),icon:W},{name:"Calls",label:__("Calls"),icon:G,condition:()=>H.value},{name:"Tasks",label:__("Tasks"),icon:Ue},{name:"Notes",label:__("Notes"),icon:ze},{name:"Comment",label:__("Comment"),icon:ve},{name:"WhatsApp",label:__("WhatsApp"),icon:Ae,condition:()=>Je.value}].filter(e=>e.condition?e.condition():!0));function ue(t){let e=t.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(e))return __("Only PNG and JPG images are allowed")}const E=T(()=>{let t=a.data;return t?(console.log(t.doctype_fields),t.doctype_fields):[]});function b(t,e,r){F(t,e,()=>{a.data[t]=e,r==null||r()}),t=="status"&&e=="Chất lượng"&&(k.value=!0)}async function me(t){await B("frappe.client.delete",{doctype:"CRM Lead",name:t}),A.push({name:"Leads"})}const k=_(!1),x=_(!1),C=_(!1),c=_(""),V=_("");async function j(t){let e=!1;if(x.value&&!c.value){y({title:__("Error"),text:__("Please select an existing contact"),icon:"x",iconClasses:"text-red-600"});return}if(C.value&&!V.value){y({title:__("Error"),text:__("Please select an existing organization"),icon:"x",iconClasses:"text-red-600"});return}if(x.value&&c.value&&(a.data.salutation=h(c.value).salutation,a.data.first_name=h(c.value).first_name,a.data.last_name=h(c.value).last_name,a.data.email_id=h(c.value).email_id,a.data.mobile_no=h(c.value).mobile_no,x.value=!1,e=!0),C.value&&V.value&&(a.data.organization=V.value,C.value=!1,e=!0),e)F({salutation:a.data.salutation,first_name:a.data.first_name,last_name:a.data.last_name,email_id:a.data.email_id,mobile_no:a.data.mobile_no,organization:a.data.organization},"",()=>j(!0)),k.value=!1;else{let r=await B("crm.api.doc.convert_to_deal",{lead:a.data.name});r&&(t&&(await se.reload(),await te.reload()),A.push({name:"Deal",params:{dealId:r}}))}}const O=_(null);function ce(){O.value.emailBox.show=!0}return(t,e)=>{var R;const r=U("FeatherIcon"),m=U("Button"),N=U("ErrorMessage"),I=U("Dialog");return d(),v(q,null,[s(a).data?(d(),p(Oe,{key:0},{"left-header":n(()=>[o(s(Re),{items:de.value},null,8,["items"])]),"right-header":n(()=>{var l;return[s(a).data._customActions?(d(),p(We,{key:0,actions:s(a).data._customActions},null,8,["actions"])):g("",!0),(d(),p(J(((l=s(a).data._assignedTo)==null?void 0:l.length)==1?"Button":"div"),null,{default:n(()=>[o(qe,{avatars:s(a).data._assignedTo,onClick:e[0]||(e[0]=u=>S.value=!0)},null,8,["avatars"])]),_:1})),o(s(Y),{options:s(le)("lead",b)},{default:n(({open:u})=>[o(m,{label:t.__(s(a).data.status),class:X(s(oe)(s(a).data.status).colorClass)},{prefix:n(()=>[o(Fe)]),suffix:n(()=>[o(r,{name:u?"chevron-up":"chevron-down",class:"h-4"},null,8,["name"])]),_:2},1032,["label","class"])]),_:1},8,["options"]),o(m,{label:t.__("Convert to Deal"),variant:"solid",onClick:e[1]||(e[1]=u=>k.value=!0)},null,8,["label"])]}),_:1})):g("",!0),(R=s(a))!=null&&R.data?(d(),v("div",Ze,[o(s(Ye),{modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=l=>w.value=l),tabs:re.value},{default:n(({tab:l})=>[o(ge,{ref_key:"activities",ref:O,doctype:"CRM Lead",title:l.name,reload:$.value,"onUpdate:reload":e[2]||(e[2]=u=>$.value=u),tabIndex:w.value,"onUpdate:tabIndex":e[3]||(e[3]=u=>w.value=u),modelValue:s(a),"onUpdate:modelValue":e[4]||(e[4]=u=>Le(a)?a.value=u:null)},null,8,["title","reload","tabIndex","modelValue"])]),_:1},8,["modelValue","tabs"]),o(_e,{class:"flex flex-col justify-between border-l",side:"right"},{default:n(()=>[i("div",{class:"flex h-10.5 cursor-copy items-center border-b px-5 py-2.5 text-lg font-medium",onClick:e[6]||(e[6]=l=>s($e)(s(a).data.name))},f(t.__(s(a).data.name)),1),o(s(Xe),{onSuccess:e[10]||(e[10]=l=>b("image",l.file_url)),validateFile:ue},{default:n(({openFileSelector:l,error:u})=>[i("div",He,[i("div",Ke,[o(s(Se),{size:"3xl",class:"size-12",label:s(a).data.first_name||t.__("Untitled"),image:s(a).data.image},null,8,["label","image"]),(d(),p(J(s(a).data.image?s(Y):"div"),Ee(s(a).data.image?{options:[{icon:"upload",label:s(a).data.image?t.__("Change image"):t.__("Upload image"),onClick:l},{icon:"trash-2",label:t.__("Remove image"),onClick:()=>b("image","")}]}:{onClick:l},{class:"!absolute bottom-0 left-0 right-0"}),{default:n(()=>[i("div",Qe,[o(je,{class:"size-4 cursor-pointer text-white"})])]),_:2},1040))]),i("div",ea,[o(s(z),{text:s(a).data.lead_name||t.__("Set first name")},{default:n(()=>[i("div",aa,f(s(a).data.lead_name||t.__("Untitled")),1)]),_:1},8,["text"]),i("div",ta,[s(H)?(d(),p(s(z),{key:0,text:t.__("Make a call")},{default:n(()=>[o(m,{class:"h-7 w-7",onClick:e[7]||(e[7]=()=>s(a).data.mobile_no?s(ae)(s(a).data.mobile_no):s(M)(t.__("No phone number set")))},{default:n(()=>[o(G,{class:"h-4 w-4"})]),_:1})]),_:1},8,["text"])):g("",!0),o(s(z),{text:t.__("Send an email")},{default:n(()=>[o(m,{class:"h-7 w-7"},{default:n(()=>[o(W,{class:"h-4 w-4",onClick:e[8]||(e[8]=D=>s(a).data.email?ce():s(M)(t.__("No email set")))})]),_:1})]),_:1},8,["text"]),o(s(z),{text:t.__("Go to website")},{default:n(()=>[o(m,{class:"h-7 w-7"},{default:n(()=>[o(be,{class:"h-4 w-4",onClick:e[9]||(e[9]=D=>s(a).data.website?s(Ne)(s(a).data.website):s(M)(t.__("No website set")))})]),_:1})]),_:1},8,["text"])]),o(N,{message:t.__(u)},null,8,["message"])])])]),_:1}),s(a).data.sla_status?(d(),p(xe,{key:0,modelValue:s(a).data,"onUpdate:modelValue":e[11]||(e[11]=l=>s(a).data=l),onUpdateField:b},null,8,["modelValue"])):g("",!0),E.value.length?(d(),v("div",sa,[i("div",la,[(d(!0),v(q,null,De(E.value,(l,u)=>(d(),v("div",{key:l.label,class:X(["flex flex-col p-3",{"border-b":u!==E.value.length-1}])},[o(Te,{"is-opened":l.opened,label:l.label},{default:n(()=>[o(Ce,{fields:l.fields,modelValue:s(a).data,"onUpdate:modelValue":e[12]||(e[12]=D=>s(a).data=D),onUpdate:b},null,8,["fields","modelValue"])]),_:2},1032,["is-opened","label"])],2))),128))])])):g("",!0)]),_:1})])):g("",!0),s(a).data?(d(),p(pe,{key:2,doc:s(a).data,modelValue:S.value,"onUpdate:modelValue":e[13]||(e[13]=l=>S.value=l),assignees:s(a).data._assignedTo,"onUpdate:assignees":e[14]||(e[14]=l=>s(a).data._assignedTo=l),onUpdate:ne},null,8,["doc","modelValue","assignees"])):g("",!0),o(I,{modelValue:k.value,"onUpdate:modelValue":e[19]||(e[19]=l=>k.value=l),options:{title:t.__("Convert to Deal"),size:"xl",actions:[{label:t.__("Convert"),variant:"solid",onClick:j}]}},{"body-content":n(()=>[i("div",oa,[o(Be,{class:"h-4 w-4"}),i("label",na,f(t.__("Organization")),1)]),i("div",ia,[i("div",da,[i("div",null,f(t.__("Choose Existing")),1),o(s(K),{modelValue:C.value,"onUpdate:modelValue":e[15]||(e[15]=l=>C.value=l)},null,8,["modelValue"])]),C.value?(d(),p(Z,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:V.value,doctype:"CRM Organization",onChange:e[16]||(e[16]=l=>V.value=l)},null,8,["value"])):(d(),v("div",ra,f(t.__("New organization will be created based on the data in details section")),1))]),i("div",ua,[o(Me,{class:"h-4 w-4"}),i("label",ma,f(t.__("Contact")),1)]),i("div",ca,[i("div",_a,[i("div",null,f(t.__("Choose Existing")),1),o(s(K),{modelValue:x.value,"onUpdate:modelValue":e[17]||(e[17]=l=>x.value=l)},null,8,["modelValue"])]),x.value?(d(),p(Z,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:c.value,doctype:"Contact",onChange:e[18]||(e[18]=l=>c.value=l)},null,8,["value"])):(d(),v("div",pa,f(t.__("New contact will be created based on the person's details")),1))])]),_:1},8,["modelValue","options"])],64)}}};export{Na as default};
//# sourceMappingURL=Lead-d2700117.js.map
