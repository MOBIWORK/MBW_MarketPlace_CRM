import{_ as $,m as k,u as h,a as j,y as O,r as f,w as L,d as v,e as b,l as x,i as n,v as s,x as d,h as o,at as N,q as P,j as r,aN as z,a_ as A,aZ as E,D as w,aJ as T,t as q,a6 as J,aY as Y,b4 as Z,c as C,aD as F}from"./index-feace97c.js";import{D}from"./DatetimePicker-56ea989f.js";const G={class:"flex items-center gap-3"},H={class:"text-2xl font-semibold leading-6 text-gray-900"},K={class:"flex flex-col gap-4"},Q={class:"mb-1.5 text-sm text-gray-600"},W={class:"mb-1.5 text-sm text-gray-600"},X={class:"flex items-center gap-4 grid grid-cols-3"},ee={class:"w-full"},ae={class:"mb-1.5 text-sm text-gray-600"},te={class:"mb-1.5 text-sm text-gray-600"},se={class:"cursor-pointer"},le={class:"w-full"},oe={class:"mb-1.5 text-sm text-gray-600"},ne={class:"flex items-center gap-4 grid grid-cols-2"},ie={__name:"TaskModal",props:k({task:{type:Object,default:{}},doctype:{type:String,default:"CRM Lead"},doc:{type:String,default:""}},{modelValue:{},modelModifiers:{},reloadTasks:{},reloadTasksModifiers:{}}),emits:k(["updateTask"],["update:modelValue","update:reloadTasks"]),setup(c,{emit:re}){const i=c,_=h(c,"modelValue"),y=h(c,"reloadTasks"),M=j(),{getUser:m}=O(),g=f(null),p=f(!1),a=f({title:"",description:"",assigned_to:"",due_date:"",remind_task:"",status:"Backlog",priority:"Low",reference_doctype:i.doctype,reference_docname:null});function V(e){a.value.status=e}function R(e){a.value.priority=e}function S(){var u;if(!((u=i.task)!=null&&u.reference_docname))return;let e=i.task.reference_doctype=="CRM Deal"?"Deal":"Lead",l={leadId:i.task.reference_docname};e=="Deal"&&(l={dealId:i.task.reference_docname}),M.push({name:e,params:l})}async function B(){a.value.assigned_to||(a.value.assigned_to=m().email),a.value.name?(await C("frappe.client.set_value",{doctype:"CRM Task",name:a.value.name,fieldname:a.value})).name&&y.value.reload():(await C("frappe.client.insert",{doc:{doctype:"CRM Task",reference_doctype:i.doctype,reference_docname:i.doc||null,...a.value}})).name&&y.value.reload(),_.value=!1}return L(()=>_.value,e=>{e&&(p.value=!1,F(()=>{g.value.el.focus(),a.value={...i.task},a.value.title&&(p.value=!0)}))}),(e,l)=>{const u=v("Button"),I=v("TextInput"),U=v("Dialog");return b(),x(U,{modelValue:_.value,"onUpdate:modelValue":l[6]||(l[6]=t=>_.value=t),options:{size:"xl",actions:[{label:p.value?e.__("Update"):e.__("Create"),variant:"solid",onClick:()=>B()}]}},{"body-title":n(()=>{var t;return[s("div",G,[s("h3",H,d(p.value?e.__("Edit Task"):e.__("Create Task")),1),(t=c.task)!=null&&t.reference_docname?(b(),x(u,{key:0,variant:"outline",size:"sm",label:c.task.reference_doctype=="CRM Deal"?e.__("Open Deal"):e.__("Open Lead"),onClick:l[0]||(l[0]=de=>S())},{suffix:n(()=>[o(N,{class:"h-4 w-4"})]),_:1},8,["label"])):P("",!0)])]}),"body-content":n(()=>[s("div",K,[s("div",null,[s("div",Q,d(e.__("Title")),1),o(I,{ref_key:"title",ref:g,variant:"outline",modelValue:a.value.title,"onUpdate:modelValue":l[1]||(l[1]=t=>a.value.title=t),placeholder:e.__("Call with customer")},null,8,["modelValue","placeholder"])]),s("div",null,[s("div",W,d(e.__("Description")),1),o(r(z),{variant:"outline",ref:"description","editor-class":"!prose-sm overflow-auto min-h-[80px] max-h-80 py-1.5 px-2 rounded border border-gray-300 bg-white hover:border-gray-400 hover:shadow-sm focus:bg-white focus:border-gray-500 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-gray-400 text-gray-800 transition-colors",bubbleMenu:!0,content:a.value.description,onChange:l[2]||(l[2]=t=>a.value.description=t),placeholder:e.__("Took a call with customer and discussed the new project.")},null,8,["content","placeholder"])]),s("div",X,[s("div",ee,[s("div",ae,d(e.__("Status")),1),o(r(w),{options:r(E)(V)},{default:n(()=>[o(u,{label:e.__(a.value.status),style:{width:"165px","justify-content":"flex-start"}},{prefix:n(()=>[o(A,{status:a.value.status},null,8,["status"])]),_:1},8,["label"])]),_:1},8,["options"])]),s("div",null,[s("div",te,d(e.__("Assign To")),1),o(J,{class:"form-control",value:r(m)(a.value.assigned_to).full_name,doctype:"User",onChange:l[3]||(l[3]=t=>a.value.assigned_to=t),hideMe:!0},{prefix:n(()=>[o(T,{class:"mr-2 !h-4 !w-4",user:a.value.assigned_to},null,8,["user"])]),"item-prefix":n(({option:t})=>[o(T,{class:"mr-2",user:t.value,size:"sm"},null,8,["user"])]),"item-label":n(({option:t})=>[o(r(q),{text:t.value},{default:n(()=>[s("div",se,d(r(m)(t.value).full_name),1)]),_:2},1032,["text"])]),_:1},8,["value"])]),s("div",le,[s("div",oe,d(e.__("Priority")),1),o(r(w),{options:r(Z)(R)},{default:n(()=>[o(u,{label:e.__(a.value.priority),style:{width:"165px","justify-content":"flex-start"}},{prefix:n(()=>[o(Y,{priority:a.value.priority},null,8,["priority"])]),_:1},8,["label"])]),_:1},8,["options"])])]),s("div",ne,[s("div",null,[o(D,{class:"datepicker",style:{width:"100%"},"icon-left":"calendar",value:a.value.due_date,onChange:l[4]||(l[4]=t=>a.value.due_date=t),placeholder:e.__("Due Date"),"input-class":"border-none"},null,8,["value","placeholder"])]),s("div",null,[o(D,{class:"datepicker",style:{width:"100%"},"icon-left":"calendar",value:a.value.remind_task,onChange:l[5]||(l[5]=t=>a.value.remind_task=t),placeholder:e.__("Remind task"),"input-class":"border-none"},null,8,["value","placeholder"])])])])]),_:1},8,["modelValue","options"])}}},_e=$(ie,[["__scopeId","data-v-63c2e941"]]);export{_e as T};
//# sourceMappingURL=TaskModal-440e5125.js.map
