import{_ as G}from"./CustomActions-ca5e2014.js";import{x as L,u as j,a as H,r as m,y as J,z as U,o as P,d as V,e as g,l as z,i as b,t as p,v as T,h as u,j as E,p as O,A as q,C as K,f as A,F as Q,a0 as X,E as F,G as S,H as Y,a1 as Z,I as N}from"./index-57f524e0.js";import{_ as ee,a as ae}from"./LayoutHeader-1b75ebc1.js";import{_ as le}from"./DealsListView-272c1ebc.js";import{F as te}from"./Fields-05088d1a.js";import{s as W}from"./statuses-725e45e6.js";import{_ as I}from"./Switch.vue_vue_type_script_setup_true_lang-6e39c11b.js";import{_ as oe}from"./ViewControls-d060515f.js";import{o as se}from"./organizations-8c40ce9c.js";import"./IndicatorIcon-42fe5203.js";import"./EditValueModal-38ec6b00.js";import"./DatePicker-c2c1e28a.js";import"./label-cf4377fb.js";import"./Link-95b990b4.js";import"./ListView-59a15338.js";import"./EditIcon-79477f55.js";import"./DatetimePicker-9b4bd588.js";const ne={class:"mb-4 grid grid-cols-3 gap-4"},re={class:"flex items-center gap-3 text-sm text-gray-600"},ie={class:"flex items-center gap-3 text-sm text-gray-600"},ue={class:"flex flex-row-reverse gap-2"},me={__name:"DealModal",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(R){const{getUser:M}=L(),{getDealStatus:c,statusOptions:k}=W(),y=j(R,"modelValue"),x=H(),i=m(null),t=J({organization:"",organization_name:"",website:"",no_of_employees:"",territory:"",annual_revenue:"",industry:"",contact:"",salutation:"",first_name:"",last_name:"",email:"",mobile_no:"",gender:"",status:"",deal_owner:""}),v=m(!1),s=m(!1),_=m(!1),C=U(()=>{let o=[];return _.value?o.push({section:"Select Organization",fields:[{label:"Organization",name:"organization",type:"link",placeholder:__("MBW Technologies"),doctype:"CRM Organization"}]}):o.push({section:"Organization Details",fields:[{label:"Organization Name",name:"organization_name",type:"data",placeholder:__("MBW Technologies")},{label:"Website",name:"website",type:"data",placeholder:__("https://example.com")},{label:"No of Employees",name:"no_of_employees",type:"select",options:[{label:__("1-10"),value:"1-10"},{label:__("11-50"),value:"11-50"},{label:__("51-200"),value:"51-200"},{label:__("201-500"),value:"201-500"},{label:__("501-1000"),value:"501-1000"},{label:__("1001-5000"),value:"1001-5000"},{label:__("5001-10000"),value:"5001-10000"},{label:__("10001+"),value:"10001+"}],placeholder:"1-10"},{label:"Territory",name:"territory",type:"link",doctype:"CRM Territory",placeholder:__("VietNam")},{label:"Annual Revenue",name:"annual_revenue",type:"data",placeholder:"9,999,999"},{label:"Industry",name:"industry",type:"link",doctype:"CRM Industry",placeholder:__("Technology")}]}),s.value?o.push({section:"Select Contact",fields:[{label:"Contact",name:"contact",type:"link",placeholder:"",doctype:"Contact"}]}):o.push({section:"Contact Details",fields:[{label:"Salutation",name:"salutation",type:"link",doctype:"Salutation",placeholder:__("Mr")},{label:"First Name",name:"first_name",type:"data",placeholder:""},{label:"Email",name:"email",type:"data",placeholder:__("example@gmail.com")},{label:"Mobile No",name:"mobile_no",type:"data",placeholder:"0876543210"},{label:"Gender",name:"gender",type:"link",doctype:"Gender",placeholder:__("Male")}]}),o.push({section:"Deal Details",columns:2,fields:[{label:"Status",name:"status",type:"select",options:h.value,prefix:c(t.status).iconColorClass},{label:"Deal Owner",name:"deal_owner",type:"user",placeholder:__("Deal Owner"),doctype:"User"}]}),o}),h=U(()=>{let o=k("deal");return t.status||(t.status=o[0].value),o});function D(){q({url:"crm.fcrm.doctype.crm_deal.crm_deal.create_deal",params:{args:t},auto:!0,validate(){if(i.value=null,t.website&&!t.website.startsWith("http")&&(t.website="https://"+t.website),t.annual_revenue&&(t.annual_revenue=t.annual_revenue.replace(/,/g,""),isNaN(t.annual_revenue)))return i.value=__("Annual Revenue should be a number"),i.value;if(t.mobile_no&&isNaN(t.mobile_no.replace(/[-+() ]/g,"")))return i.value=__("Mobile No should be a number"),i.value;if(t.email&&!t.email.includes("@"))return i.value=__("Invalid Email"),i.value;v.value=!0},onSuccess(o){v.value=!1,y.value=!1,x.push({name:"Deal",params:{dealId:o}})}})}return P(()=>{t.deal_owner||(t.deal_owner=M().email)}),(o,n)=>{const a=V("ErrorMessage"),l=V("Button"),r=V("Dialog");return g(),z(r,{modelValue:y.value,"onUpdate:modelValue":n[2]||(n[2]=e=>y.value=e),options:{size:"3xl",title:o.__("Create Deal")}},{"body-content":b(()=>[p("div",ne,[p("div",re,[p("div",null,T(o.__("Choose Existing Organization")),1),u(E(I),{modelValue:_.value,"onUpdate:modelValue":n[0]||(n[0]=e=>_.value=e)},null,8,["modelValue"])]),p("div",ie,[p("div",null,T(o.__("Choose Existing Contact")),1),u(E(I),{modelValue:s.value,"onUpdate:modelValue":n[1]||(n[1]=e=>s.value=e)},null,8,["modelValue"])])]),u(te,{class:"border-t pt-4",sections:C.value,data:t},null,8,["sections","data"]),i.value?(g(),z(a,{key:0,class:"mt-4",message:o.__(i.value)},null,8,["message"])):O("",!0)]),actions:b(()=>[p("div",ue,[u(l,{variant:"solid",label:o.__("Create"),loading:v.value,onClick:D},null,8,["label","loading"])])]),_:1},8,["modelValue","options"])}}},de={key:1,class:"flex h-full items-center justify-center"},pe={class:"flex flex-col items-center gap-3 text-xl font-medium text-gray-500"},Se={__name:"Deals",setup(R){const M=[{label:__("Deals"),route:{name:"Deals"}}],{getUser:c}=L(),{getOrganization:k}=se(),{getDealStatus:y}=W(),{roles:x}=K(),i=m(null),t=m(!1),v=m(!1);P(()=>{let n=x.data;for(let a=0;a<n.length;a++)if(n[a]=="System Manager"){v.value=!0;break}});const s=m({}),_=m(1),C=m(1),h=m(20),D=m(null),o=U(()=>{var n,a;return(a=(n=s.value)==null?void 0:n.data)!=null&&a.data?s.value.data.data.map(l=>{let r={};return s.value.data.rows.forEach(e=>{var w,$;if(r[e]=l[e],e=="organization")r[e]={label:l.organization,logo:(w=k(l.organization))==null?void 0:w.organization_logo};else if(e=="annual_revenue")r[e]=X(l.annual_revenue);else if(e=="status")r[e]={label:l.status,color:($=y(l.status))==null?void 0:$.iconColorClass};else if(e=="sla_status"){let d=l.sla_status,f=d,B=l.sla_status=="Failed"?"red":l.sla_status=="Fulfilled"?"green":"orange";d=="First Response Due"&&(d=__(F(l.response_by)),f=S(l.response_by,N),new Date(l.response_by)<new Date&&(B="red")),r[e]={label:f,value:d,color:B}}else if(e=="deal_owner")r[e]={label:l.deal_owner&&c(l.deal_owner).full_name,...l.deal_owner&&c(l.deal_owner)};else if(e=="_assign"){let d=JSON.parse(l._assign)||[];!d.length&&l.deal_owner&&(d=[l.deal_owner]),r[e]=d.map(f=>({name:f,image:c(f).user_image,label:c(f).full_name}))}else if(["modified","creation"].includes(e))r[e]={label:S(l[e],N),timeAgo:__(F(l[e]))};else if(["first_response_time","first_responded_on","response_by"].includes(e)){let d=e=="response_by"?"response_by":"first_responded_on";r[e]={label:l[d]?S(l[d],N):"",timeAgo:l[e]?e=="first_response_time"?Y(l[e]):__(F(l[e])):""}}}),r}):[]});return(n,a)=>{const l=V("FeatherIcon"),r=V("Button");return g(),A(Q,null,[u(ee,null,{"left-header":b(()=>[u(E(ae),{items:M})]),"right-header":b(()=>{var e;return[(e=i.value)!=null&&e.customListActions?(g(),z(G,{key:0,actions:i.value.customListActions},null,8,["actions"])):O("",!0),u(r,{variant:"solid",label:n.__("Create"),onClick:a[0]||(a[0]=w=>t.value=!0)},{prefix:b(()=>[u(l,{name:"plus",class:"h-4"})]),_:1},8,["label"])]}),_:1}),u(oe,{ref_key:"viewControls",ref:D,modelValue:s.value,"onUpdate:modelValue":a[1]||(a[1]=e=>s.value=e),loadMore:_.value,"onUpdate:loadMore":a[2]||(a[2]=e=>_.value=e),resizeColumn:C.value,"onUpdate:resizeColumn":a[3]||(a[3]=e=>C.value=e),updatedPageCount:h.value,"onUpdate:updatedPageCount":a[4]||(a[4]=e=>h.value=e),doctype:"CRM Deal",showElement:!0,showFuncConvertTaskCustomer:v.value,placeholderText:n.__("Search customer")},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount","showFuncConvertTaskCustomer","placeholderText"]),s.value.data&&o.value.length?(g(),z(le,{key:0,ref_key:"dealsListView",ref:i,modelValue:s.value.data.page_length_count,"onUpdate:modelValue":a[5]||(a[5]=e=>s.value.data.page_length_count=e),list:s.value,"onUpdate:list":a[6]||(a[6]=e=>s.value=e),rows:o.value,columns:s.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:s.value.data.row_count,totalCount:s.value.data.total_count},onLoadMore:a[7]||(a[7]=()=>_.value++),onColumnWidthUpdated:a[8]||(a[8]=()=>C.value++),onUpdatePageCount:a[9]||(a[9]=e=>h.value=e),onApplyFilter:a[10]||(a[10]=e=>D.value.applyFilter(e))},null,8,["modelValue","list","rows","columns","options"])):s.value.data?(g(),A("div",de,[p("div",pe,[u(Z,{class:"h-10 w-10"}),p("span",null,T(n.__("No {0} Found",[n.__("Deals")])),1),u(r,{label:n.__("Create"),onClick:a[11]||(a[11]=e=>t.value=!0)},{prefix:b(()=>[u(l,{name:"plus",class:"h-4"})]),_:1},8,["label"])])])):O("",!0),u(me,{modelValue:t.value,"onUpdate:modelValue":a[12]||(a[12]=e=>t.value=e)},null,8,["modelValue"])],64)}}};export{Se as default};
//# sourceMappingURL=Deals-06d6c905.js.map
