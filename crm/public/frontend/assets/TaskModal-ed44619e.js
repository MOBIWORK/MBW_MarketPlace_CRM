import{_ as $,m as k,u as h,a as O,y as j,r as f,w as L,d as v,e as b,l as x,i as n,v as t,x as i,h as o,at as N,q as P,j as d,aN as z,a_ as A,aZ as E,D as w,aJ as T,t as q,a6 as J,aY as Y,b4 as Z,c as D,aD as F}from"./index-c24d0e80.js";import{D as C}from"./DatetimePicker-dd440c1e.js";const G={class:"flex items-center gap-3"},H={class:"text-2xl font-semibold leading-6 text-gray-900"},K={class:"flex flex-col gap-4"},Q={class:"mb-1.5 text-sm text-gray-600"},W={class:"mb-1.5 text-sm text-gray-600"},X={class:"flex items-center gap-4 grid grid-cols-3"},ee={class:"w-full"},ae={class:"mb-1.5 text-sm text-gray-600"},te={class:"mb-1.5 text-sm text-gray-600"},se={class:"cursor-pointer"},le={class:"w-full"},oe={class:"mb-1.5 text-sm text-gray-600"},ne={class:"flex items-center gap-4 grid grid-cols-2"},ie={class:"mb-1.5 text-sm text-gray-600"},re={class:"mb-1.5 text-sm text-gray-600"},de={__name:"TaskModal",props:k({task:{type:Object,default:{}},doctype:{type:String,default:"CRM Lead"},doc:{type:String,default:""}},{modelValue:{},modelModifiers:{},reloadTasks:{},reloadTasksModifiers:{}}),emits:k(["updateTask"],["update:modelValue","update:reloadTasks"]),setup(c,{emit:ue}){const r=c,_=h(c,"modelValue"),y=h(c,"reloadTasks"),M=O(),{getUser:m}=j(),g=f(null),p=f(!1),a=f({title:"",description:"",assigned_to:"",due_date:"",remind_task:"",status:"Backlog",priority:"Low",reference_doctype:r.doctype,reference_docname:null});function V(e){a.value.status=e}function R(e){a.value.priority=e}function S(){var u;if(!((u=r.task)!=null&&u.reference_docname))return;let e=r.task.reference_doctype=="CRM Deal"?"Deal":"Lead",l={leadId:r.task.reference_docname};e=="Deal"&&(l={dealId:r.task.reference_docname}),M.push({name:e,params:l})}async function B(){a.value.assigned_to||(a.value.assigned_to=m().email),a.value.name?(await D("frappe.client.set_value",{doctype:"CRM Task",name:a.value.name,fieldname:a.value})).name&&y.value.reload():(await D("frappe.client.insert",{doc:{doctype:"CRM Task",reference_doctype:r.doctype,reference_docname:r.doc||null,...a.value}})).name&&y.value.reload(),_.value=!1}return L(()=>_.value,e=>{e&&(p.value=!1,F(()=>{g.value.el.focus(),a.value={...r.task},a.value.title&&(p.value=!0)}))}),(e,l)=>{const u=v("Button"),I=v("TextInput"),U=v("Dialog");return b(),x(U,{modelValue:_.value,"onUpdate:modelValue":l[6]||(l[6]=s=>_.value=s),options:{size:"xl",actions:[{label:p.value?e.__("Update"):e.__("Create"),variant:"solid",onClick:()=>B()}]}},{"body-title":n(()=>{var s;return[t("div",G,[t("h3",H,i(p.value?e.__("Edit Task"):e.__("Create Task")),1),(s=c.task)!=null&&s.reference_docname?(b(),x(u,{key:0,variant:"outline",size:"sm",label:c.task.reference_doctype=="CRM Deal"?e.__("Open Deal"):e.__("Open Lead"),onClick:l[0]||(l[0]=ce=>S())},{suffix:n(()=>[o(N,{class:"h-4 w-4"})]),_:1},8,["label"])):P("",!0)])]}),"body-content":n(()=>[t("div",K,[t("div",null,[t("div",Q,i(e.__("Task name")),1),o(I,{ref_key:"title",ref:g,variant:"outline",modelValue:a.value.title,"onUpdate:modelValue":l[1]||(l[1]=s=>a.value.title=s),placeholder:e.__("")},null,8,["modelValue","placeholder"])]),t("div",null,[t("div",W,i(e.__("Description")),1),o(d(z),{variant:"outline",ref:"description","editor-class":"!prose-sm overflow-auto min-h-[80px] max-h-80 py-1.5 px-2 rounded border border-gray-300 bg-white hover:border-gray-400 hover:shadow-sm focus:bg-white focus:border-gray-500 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-gray-400 text-gray-800 transition-colors",bubbleMenu:!0,content:a.value.description,onChange:l[2]||(l[2]=s=>a.value.description=s),placeholder:e.__("")},null,8,["content","placeholder"])]),t("div",X,[t("div",ee,[t("div",ae,i(e.__("Status")),1),o(d(w),{options:d(E)(V)},{default:n(()=>[o(u,{label:e.__(a.value.status),style:{width:"165px","justify-content":"flex-start"}},{prefix:n(()=>[o(A,{status:a.value.status},null,8,["status"])]),_:1},8,["label"])]),_:1},8,["options"])]),t("div",null,[t("div",te,i(e.__("Assign To")),1),o(J,{class:"form-control truncate",value:d(m)(a.value.assigned_to).full_name,doctype:"User",onChange:l[3]||(l[3]=s=>a.value.assigned_to=s),hideMe:!0},{prefix:n(()=>[o(T,{class:"mr-2 !h-4 !w-4",user:a.value.assigned_to},null,8,["user"])]),"item-prefix":n(({option:s})=>[o(T,{class:"mr-2",user:s.value,size:"sm"},null,8,["user"])]),"item-label":n(({option:s})=>[o(d(q),{text:s.value},{default:n(()=>[t("div",se,i(d(m)(s.value).full_name),1)]),_:2},1032,["text"])]),_:1},8,["value"])]),t("div",le,[t("div",oe,i(e.__("Priority")),1),o(d(w),{options:d(Z)(R)},{default:n(()=>[o(u,{label:e.__(a.value.priority),style:{width:"165px","justify-content":"flex-start"}},{prefix:n(()=>[o(Y,{priority:a.value.priority},null,8,["priority"])]),_:1},8,["label"])]),_:1},8,["options"])])]),t("div",ne,[t("div",null,[t("div",ie,i(e.__("Deadline")),1),o(C,{class:"datepicker",style:{width:"100%"},"icon-left":"calendar",value:a.value.due_date,onChange:l[4]||(l[4]=s=>a.value.due_date=s),placeholder:e.__("Select Due Date"),"input-class":"border-none"},null,8,["value","placeholder"])]),t("div",null,[t("div",re,i(e.__("Remind task")),1),o(C,{class:"datepicker",style:{width:"100%"},"icon-left":"calendar",value:a.value.remind_task,onChange:l[5]||(l[5]=s=>a.value.remind_task=s),placeholder:e.__("Select Remind task"),"input-class":"border-none"},null,8,["value","placeholder"])])])])]),_:1},8,["modelValue","options"])}}},me=$(de,[["__scopeId","data-v-69da9ce4"]]);export{me as T};
//# sourceMappingURL=TaskModal-ed44619e.js.map
