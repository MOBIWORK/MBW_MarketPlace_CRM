import{_ as H}from"./statuses-ded37fc4.js";import{I as K}from"./IndicatorIcon-b09272ab.js";import{z as R,B as E,C as Q,D as X,A as Y,E as Z,G as g,H as ee,I as te,J as z,K as M,s as x,o as s,b as i,f as r,w as p,u,F as I,x as le,a as y,n as S,L as N,k as w,P as se,M as oe,d as P,t as D,N as ae}from"./index-fd4111d0.js";import{_ as ne}from"./EditValueModal-3deb1bd3.js";import{_ as ie,a as re,b as ue,c as de,e as ce,d as _e}from"./ListView-dc019d7b.js";import{_ as me}from"./DatePicker-808a1e66.js";const fe={key:0,class:"flex items-center"},ke=["onClick"],pe=["onClick"],ye=["onClick"],Ce=["onClick"],ve=["onClick"],be={key:1,class:"truncate text-base"},ge={key:2},we={key:3},he=["onClick"],De={__name:"DealsListView",props:R({rows:{type:Array,required:!0},columns:{type:Array,required:!0},options:{type:Object,default:()=>({selectable:!0,showTooltip:!0,resizeColumn:!1,totalCount:0,rowCount:0})}},{modelValue:{},modelModifiers:{},list:{},listModifiers:{}}),emits:R(["loadMore","updatePageCount","columnWidthUpdated","applyFilter","update:selections"],["update:modelValue","update:list"]),setup(c,{expose:T,emit:W}){const C=W,h=E(c,"modelValue"),f=E(c,"list"),B=Q(),{$dialog:V}=X(),{getUser:q}=Y();Z(h,(l,e)=>{l!==e&&C("updatePageCount",l)});const A=g(!1),F=g([]),$=g(()=>{});function k(l,e,n,m){["mobile_no","email","lead_name","_assign","assign_to"].includes(n.key)||C("applyFilter",{event:l,idx:e,column:n,item:m})}function J(l){let e=[];l.forEach(n=>{e.push(n)}),C("update:selections",e)}function O(l,e){F.value=l,A.value=!0,$.value=e}function j(l,e){V({title:__("Delete"),message:__("Are you sure you want to delete {0} item(s).All related documents will be deleted accordingly?",[l.size]),variant:"danger",actions:[{label:__("Delete"),variant:"solid",theme:"red",onClick:n=>{z("crm.api.doc.delete_items_for_leads_deals",{items:JSON.stringify(Array.from(l)),doctype:"CRM Deal"}).then(()=>{M({title:__("Deleted successfully"),icon:"check",iconClasses:"text-green-600"}),e(),f.value.reload(),n()})}}]})}const U=g([]),L=g([]);function G(l,e){let n=[{label:__("Edit"),onClick:()=>O(l,e)},{label:__("Delete"),onClick:()=>j(l,e)}];return U.value.forEach(m=>{n.push({label:__(m.label),onClick:()=>m.onClick({list:f.value,selections:l,unselectAll:e,call:z,createToast:M,$dialog:V,router:B})})}),n}return ee(()=>{var l,e,n,m,v;(l=f.value)!=null&&l.data&&(te(f.value.data,{list:f.value,call:z,createToast:M,$dialog:V,router:B}),U.value=((n=(e=f.value)==null?void 0:e.data)==null?void 0:n.bulkActions)||[],L.value=((v=(m=f.value)==null?void 0:m.data)==null?void 0:v.listActions)||[])}),T({customListActions:L}),(l,e)=>{const n=x("Badge"),m=x("FormControl"),v=x("Button");return s(),i(I,null,[r(u(_e),{class:S(l.$attrs.class),columns:c.columns,rows:c.rows,options:{getRowRoute:o=>({name:"Deal",params:{dealId:o.name}}),selectable:c.options.selectable,showTooltip:c.options.showTooltip,resizeColumn:c.options.resizeColumn},"row-key":"name","onUpdate:selections":e[1]||(e[1]=o=>J(o))},{default:p(()=>[r(u(ie),{class:"mx-5",onColumnWidthUpdated:e[0]||(e[0]=o=>C("columnWidthUpdated"))}),r(u(re),{id:"list-rows"},{default:p(()=>[(s(!0),i(I,null,le(c.rows,o=>(s(),y(u(de),{class:"mx-5",key:o.name,row:o},{default:p(({idx:_,column:a,item:t})=>[a.key==="_assign"?(s(),i("div",fe,[r(H,{avatars:t,size:"sm",onClick:d=>k(d,_,a,t)},null,8,["avatars","onClick"])])):(s(),y(u(ue),{key:1,item:t},{prefix:p(()=>[a.key==="status"?(s(),i("div",{key:0,onClick:d=>k(d,_,a,t)},[r(K,{class:S(t.color)},null,8,["class"])],8,ke)):a.key==="organization"?(s(),i("div",{key:1,onClick:d=>k(d,_,a,t)},[t.label?(s(),y(u(N),{key:0,class:"flex items-center",image:t.logo,label:t.label,size:"sm"},null,8,["image","label"])):w("",!0)],8,pe)):a.key==="deal_owner"?(s(),i("div",{key:2,onClick:d=>k(d,_,a,t)},[t.full_name?(s(),y(u(N),{key:0,class:"flex items-center",image:t.user_image,label:t.full_name,size:"sm"},null,8,["image","label"])):w("",!0)],8,ye)):a.key==="mobile_no"?(s(),i("div",{key:3,onClick:d=>k(d,_,a,t)},[r(se,{class:"h-4 w-4"})],8,Ce)):w("",!0)]),default:p(({label:d})=>[["modified","creation","first_response_time","first_responded_on","response_by"].includes(a.key)?(s(),i("div",{key:0,class:"truncate text-base",onClick:b=>k(b,_,a,t)},[r(u(oe),{text:t.label},{default:p(()=>[P("div",null,D(t.timeAgo),1)]),_:2},1032,["text"])],8,ve)):a.key==="sla_status"?(s(),i("div",be,[t.value?(s(),y(n,{key:0,variant:"subtle",theme:t.color,size:"md",label:t.value,onClick:b=>k(b,_,a,t)},null,8,["theme","label","onClick"])):w("",!0)])):["modified_by","owner"].includes(a.key)?(s(),i("div",ge,[P("div",null,D(u(q)(t).first_name),1)])):a.type==="Check"?(s(),i("div",we,[r(m,{type:"checkbox",modelValue:t,disabled:!0,class:"text-gray-900"},null,8,["modelValue"])])):(s(),i("div",{key:4,class:"truncate text-base",onClick:b=>k(b,_,a,t)},D(l.__(d)),9,he))]),_:2},1032,["item"]))]),_:2},1032,["row"]))),128))]),_:1}),r(u(ce),null,{actions:p(({selections:o,unselectAll:_})=>[r(u(ae),{options:G(o,_)},{default:p(()=>[r(v,{icon:"more-horizontal",variant:"ghost"})]),_:2},1032,["options"])]),_:1})]),_:1},8,["class","columns","rows","options"]),h.value?(s(),y(u(me),{key:0,class:"border-t px-5 py-2",modelValue:h.value,"onUpdate:modelValue":e[2]||(e[2]=o=>h.value=o),options:{rowCount:c.options.rowCount,totalCount:c.options.totalCount},onLoadMore:e[3]||(e[3]=o=>C("loadMore"))},null,8,["modelValue","options"])):w("",!0),r(ne,{modelValue:A.value,"onUpdate:modelValue":e[4]||(e[4]=o=>A.value=o),unselectAll:$.value,"onUpdate:unselectAll":e[5]||(e[5]=o=>$.value=o),doctype:"CRM Deal",selectedValues:F.value,onReload:e[6]||(e[6]=o=>f.value.reload())},null,8,["modelValue","unselectAll","selectedValues"])],64)}}};export{De as _};
//# sourceMappingURL=DealsListView-06ed0bae.js.map
