import{l as X,C as H,N as Y,B as Z,E as w,c as h,ar as ee,Q as V,s as y,o as s,b as c,u as a,a as u,w as m,k as r,f as n,F as ae,I as $,ai as te,ah as oe,X as se,W as le,d as i,K as B,aa as ne,a7 as v,t as d,a3 as ie,n as k,P as re,L as ce,j as N,$ as me}from"./index-b021dd3e.js";import{_ as de,a as _e}from"./LayoutHeader-f9685323.js";import{F as ue}from"./FileUploader-54954eb8.js";import{_ as pe}from"./Tabs-e35b80e8.js";import{C as ge,_ as fe}from"./ContactModal-9ead13fc.js";import{E as be}from"./EditIcon-5d716aa9.js";import{C as he}from"./CameraIcon-bde40d64.js";import{_ as ye}from"./DealsListView-20dec933.js";import{o as ve}from"./organizations-a5377829.js";import{s as xe}from"./statuses-1864e107.js";import{c as I}from"./settings-1aa712ea.js";import"./Fields-e3ae06e2.js";import"./IndicatorIcon-50d2ec44.js";import"./EditValueModal-89794f46.js";import"./DatePicker-ecb1c2b9.js";import"./label-241d26b1.js";import"./ListView-913eec95.js";const Ce={key:1,class:"flex h-full flex-col overflow-hidden"},we={class:"flex items-center justify-start gap-6 p-5"},ke={class:"group relative h-24 w-24"},Ie={class:"z-1 absolute bottom-0 left-0 right-0 flex h-14 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-3 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(12px 0 0 0)","clip-path":"inset(12px 0 0 0)"}},ze={class:"flex flex-col gap-0.5 truncate"},Fe={class:"truncate text-3xl font-semibold"},Me={key:0},De={class:"flex items-center gap-2 text-base text-gray-700"},Ee={key:0,class:"flex items-center gap-1.5"},Ve={class:""},$e={key:1,class:"text-3xl leading-[0] text-gray-600"},Be={class:""},Ne={key:3,class:"text-3xl leading-[0] text-gray-600"},Se={key:4,class:"flex items-center gap-1.5"},je={class:""},Re={key:5,class:"text-3xl leading-[0] text-gray-600"},Pe={class:"mt-2 flex gap-1.5"},Ue={key:1,class:"grid flex-1 place-items-center text-xl font-medium text-gray-500"},Ae={class:"flex flex-col items-center justify-center space-y-3"},Oe={__name:"Contact",props:{contactId:{type:String,required:!0}},setup(S){const{$dialog:j,makeCall:R}=H(),{getUser:z}=Y(),{getOrganization:F}=ve(),{getDealStatus:P}=xe(),_=S,U=Z(),g=w(!1),x=w(!1),A=h(()=>{var o;let e=[{label:__("Contacts"),route:{name:"Contacts"}}];return e.push({label:(o=t.data)==null?void 0:o.full_name,route:{name:"Contact",params:{contactId:_.contactId}}}),e});function O(e){let o=e.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(o))return __("Only PNG and JPG images are allowed")}async function M(e){await $("frappe.client.set_value",{doctype:"FCRM Contact",name:_.contactId,fieldname:"image",value:(e==null?void 0:e.file_url)||""}),t.reload()}async function L(){j({title:__("Delete contact"),message:__("Are you sure you want to delete this contact?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",async onClick(e){await $("frappe.client.delete",{doctype:"FCRM Contact",name:_.contactId}),e(),U.push({name:"Contacts"})}}]})}const D=w(0),T=[{label:"Deals",icon:ee(te,{class:"h-4 w-4"}),count:h(()=>{var e;return(e=f.data)==null?void 0:e.length})}],t=V({url:"crm.api.contact.get_contact",cache:["FCRM Contact",_.contactId],params:{name:_.contactId},auto:!0,transform:e=>({...e,actual_mobile_no:e.mobile_no,mobile_no:e.mobile_no})}),f=V({url:"crm.api.contact.get_linked_deals",cache:["deals",_.contactId],params:{contact:_.contactId},auto:!0}),C=h(()=>!f.data||f.data==[]?[]:f.data.map(e=>q(e))),G=h(()=>J);function q(e){var o,p;return{name:e.name,organization:{label:e.organization,logo:(o=F(e.organization))==null?void 0:o.organization_logo},annual_revenue:oe(e.annual_revenue),status:{label:e.status,color:(p=P(e.status))==null?void 0:p.iconColorClass},email:e.email,mobile_no:e.mobile_no,deal_owner:{label:e.deal_owner&&z(e.deal_owner).full_name,...e.deal_owner&&z(e.deal_owner)},modified:{label:se(e.modified,me),timeAgo:__(le(e.modified))}}}const J=[{label:__("Organization"),key:"organization",width:"11rem"},{label:__("Amount"),key:"annual_revenue",width:"9rem"},{label:__("Status"),key:"status",width:"10rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Mobile no"),key:"mobile_no",width:"11rem"},{label:__("Deal owner"),key:"deal_owner",width:"10rem"},{label:__("Last modified"),key:"modified",width:"8rem"}];return(e,o)=>{const p=y("Button"),K=y("FeatherIcon"),Q=y("ErrorMessage"),W=y("Badge");return s(),c(ae,null,[a(t).data?(s(),u(de,{key:0},{"left-header":m(()=>[n(a(_e),{items:A.value},null,8,["items"])]),_:1})):r("",!0),a(t).data?(s(),c("div",Ce,[n(a(ue),{onSuccess:M,validateFile:O},{default:m(({openFileSelector:l,error:b})=>{var E;return[i("div",we,[i("div",ke,[n(a(B),{size:"3xl",class:"h-24 w-24",label:a(t).data.full_name,image:a(t).data.image},null,8,["label","image"]),(s(),u(v(a(t).data.image?fe:"div"),ne(a(t).data.image?{options:[{icon:"upload",label:a(t).data.image?e.__("Change image"):e.__("Upload image"),onClick:l},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>M("")}]}:{onClick:l},{class:"!absolute bottom-0 left-0 right-0"}),{default:m(()=>[i("div",Ie,[n(he,{class:"h-6 w-6 cursor-pointer text-white"})])]),_:2},1040))]),i("div",ze,[i("div",Fe,[a(t).data.salutation?(s(),c("span",Me,d(a(t).data.salutation+". "),1)):r("",!0),i("span",null,d(a(t).data.full_name),1)]),i("div",De,[a(t).data.email_id?(s(),c("div",Ee,[n(ie,{class:"h-4 w-4"}),i("span",Ve,d(a(t).data.email_id),1)])):r("",!0),a(t).data.email_id?(s(),c("span",$e," · ")):r("",!0),a(t).data.actual_mobile_no?(s(),u(v(a(I)?a(ce):"div"),{key:2,text:e.__("Make Call")},{default:m(()=>[i("div",{class:k(["flex items-center gap-1.5",a(I)?"cursor-pointer":""]),onClick:o[0]||(o[0]=Le=>a(I)&&a(R)(a(t).data.actual_mobile_no))},[n(re,{class:"h-4 w-4"}),i("span",Be,d(a(t).data.actual_mobile_no),1)],2)]),_:1},8,["text"])):r("",!0),a(t).data.actual_mobile_no?(s(),c("span",Ne," · ")):r("",!0),a(t).data.company_name?(s(),c("div",Se,[n(a(B),{size:"xs",label:a(t).data.company_name,image:(E=a(F)(a(t).data.company_name))==null?void 0:E.organization_logo},null,8,["label","image"]),i("span",je,d(a(t).data.company_name),1)])):r("",!0),a(t).data.company_name?(s(),c("span",Re," · ")):r("",!0),a(t).data.email_id||a(t).data.mobile_no||a(t).data.company_name?(s(),u(p,{key:6,variant:"ghost",label:e.__("More"),class:"-ml-1 cursor-pointer hover:text-gray-900",onClick:o[1]||(o[1]=()=>{x.value=!0,g.value=!0})},null,8,["label"])):r("",!0)]),i("div",Pe,[n(p,{label:e.__("Edit"),size:"sm",onClick:o[2]||(o[2]=()=>{x.value=!1,g.value=!0})},{prefix:m(()=>[n(be,{class:"h-4 w-4"})]),_:1},8,["label"]),n(p,{label:e.__("Delete"),theme:"red",size:"sm",onClick:L},{prefix:m(()=>[n(K,{name:"trash-2",class:"h-4 w-4"})]),_:1},8,["label"])]),n(Q,{message:e.__(b)},null,8,["message"])])])]}),_:1}),n(a(pe),{class:"overflow-hidden",modelValue:D.value,"onUpdate:modelValue":o[3]||(o[3]=l=>D.value=l),tabs:T},{tab:m(({tab:l,selected:b})=>[i("button",{class:k(["group flex items-center gap-2 border-b border-transparent py-2.5 text-base text-gray-600 duration-300 ease-in-out hover:border-gray-400 hover:text-gray-900",{"text-gray-900":b}])},[l.icon?(s(),u(v(l.icon),{key:0,class:"h-5"})):r("",!0),N(" "+d(e.__(l.label))+" ",1),n(W,{class:k(["group-hover:bg-gray-900",[b?"bg-gray-900":"bg-gray-600"]]),variant:"solid",theme:"gray",size:"sm"},{default:m(()=>[N(d(l.count),1)]),_:2},1032,["class"])],2)]),default:m(({tab:l})=>[l.label==="Deals"&&C.value.length?(s(),u(ye,{key:0,class:"mt-4",rows:C.value,columns:G.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):r("",!0),C.value.length?r("",!0):(s(),c("div",Ue,[i("div",Ae,[(s(),u(v(l.icon),{class:"!h-10 !w-10"})),i("div",null,d(e.__("No {0} Found",[e.__(l.label)])),1)])]))]),_:1},8,["modelValue"])])):r("",!0),n(ge,{modelValue:g.value,"onUpdate:modelValue":o[4]||(o[4]=l=>g.value=l),contact:a(t),options:{detailMode:x.value}},null,8,["modelValue","contact","options"])],64)}}},na=X(Oe,[["__scopeId","data-v-ed985593"]]);export{na as default};
//# sourceMappingURL=Contact-f92d462d.js.map
