import{l as $,z as y,B as k,C as I,A as O,G as m,E as U,s as b,o as h,a as x,w as n,d as s,t as i,f as o,aB as A,k as z,u as r,aO as N,a_ as P,aZ as j,N as T,aL as w,M as E,af as G,aY as J,b6 as Y,b7 as Z,J as C,aG as q}from"./index-fd4111d0.js";import{D}from"./DatetimePicker-76bd67f8.js";const F={class:"flex items-center gap-3"},H={class:"text-2xl font-semibold leading-6 text-gray-900"},K={class:"flex flex-col gap-4"},Q={class:"mb-1.5 text-sm text-gray-600"},W={class:"mb-1.5 text-sm text-gray-600"},X={class:"flex items-center gap-4 grid grid-cols-3"},ee={class:"w-full"},ae={class:"mb-1.5 text-sm text-gray-600"},te={class:"mb-1.5 text-sm text-gray-600"},se={class:"cursor-pointer"},le={class:"w-full"},oe={class:"mb-1.5 text-sm text-gray-600"},ne={class:"flex items-center gap-4 grid grid-cols-2"},ie={class:"mb-1.5 text-sm text-gray-600"},re={class:"mb-1.5 text-sm text-gray-600"},de={__name:"TaskModal",props:y({task:{type:Object,default:{}},doctype:{type:String,default:"CRM Lead"},doc:{type:String,default:""}},{modelValue:{},modelModifiers:{},reloadTasks:{},reloadTasksModifiers:{}}),emits:y(["updateTask"],["update:modelValue","update:reloadTasks"]),setup(c,{emit:ue}){const d=c,_=k(c,"modelValue"),v=k(c,"reloadTasks"),M=I(),{getUser:f}=O(),g=m(null),p=m(!1),a=m({title:"",description:"",assigned_to:"",due_date:"",remind_task:"",status:"Backlog",priority:"Low",reference_doctype:d.doctype,reference_docname:null});function V(e){a.value.status=e}function R(e){a.value.priority=e}function ce(){}function S(){var u;if(!((u=d.task)!=null&&u.reference_docname))return;let e=d.task.reference_doctype=="CRM Deal"?"Deal":"Lead",l={leadId:d.task.reference_docname};e=="Deal"&&(l={dealId:d.task.reference_docname}),M.push({name:e,params:l})}async function B(){a.value.assigned_to||(a.value.assigned_to=f().email),a.value.name?(await C("frappe.client.set_value",{doctype:"CRM Task",name:a.value.name,fieldname:a.value})).name&&v.value.reload():(await C("frappe.client.insert",{doc:{doctype:"CRM Task",reference_doctype:d.doctype,reference_docname:d.doc||null,...a.value}})).name&&v.value.reload(),_.value=!1}return U(()=>_.value,e=>{e&&(p.value=!1,q(()=>{g.value.el.focus(),a.value={...d.task},a.value.title&&(p.value=!0)}))}),(e,l)=>{const u=b("Button"),L=b("TextInput");return h(),x(r(Z),{modelValue:_.value,"onUpdate:modelValue":l[6]||(l[6]=t=>_.value=t),options:{size:"xl",actions:[{label:p.value?e.__("Update"):e.__("Create"),variant:"solid",onClick:()=>B()}]},onAfterLeave:l[7]||(l[7]=t=>void 0)},{"body-title":n(()=>{var t;return[s("div",F,[s("h3",H,i(p.value?e.__("Edit Task"):e.__("Create Task")),1),(t=c.task)!=null&&t.reference_docname?(h(),x(u,{key:0,variant:"outline",size:"sm",label:c.task.reference_doctype=="CRM Deal"?e.__("Open Deal"):e.__("Open Lead"),onClick:l[0]||(l[0]=_e=>S())},{suffix:n(()=>[o(A,{class:"h-4 w-4"})]),_:1},8,["label"])):z("",!0)])]}),"body-content":n(()=>[s("div",K,[s("div",null,[s("div",Q,i(e.__("Task name")),1),o(L,{ref_key:"title",ref:g,variant:"outline",modelValue:a.value.title,"onUpdate:modelValue":l[1]||(l[1]=t=>a.value.title=t),placeholder:e.__("")},null,8,["modelValue","placeholder"])]),s("div",null,[s("div",W,i(e.__("Description")),1),o(r(N),{variant:"outline",ref:"description","editor-class":"!prose-sm overflow-auto min-h-[80px] max-h-80 py-1.5 px-2 rounded border border-gray-300 bg-white hover:border-gray-400 hover:shadow-sm focus:bg-white focus:border-gray-500 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-gray-400 text-gray-800 transition-colors",bubbleMenu:!0,content:a.value.description,onChange:l[2]||(l[2]=t=>a.value.description=t),placeholder:e.__("")},null,8,["content","placeholder"])]),s("div",X,[s("div",ee,[s("div",ae,i(e.__("Status")),1),o(r(T),{options:r(j)(V)},{default:n(()=>[o(u,{label:e.__(a.value.status),style:{width:"165px","justify-content":"flex-start"}},{prefix:n(()=>[o(P,{status:a.value.status},null,8,["status"])]),_:1},8,["label"])]),_:1},8,["options"])]),s("div",null,[s("div",te,i(e.__("Assign To")),1),o(G,{class:"form-control truncate",value:r(f)(a.value.assigned_to).full_name,doctype:"User",onChange:l[3]||(l[3]=t=>a.value.assigned_to=t),hideMe:!0},{prefix:n(()=>[o(w,{class:"mr-2 !h-4 !w-4",user:a.value.assigned_to},null,8,["user"])]),"item-prefix":n(({option:t})=>[o(w,{class:"mr-2",user:t.value,size:"sm"},null,8,["user"])]),"item-label":n(({option:t})=>[o(r(E),{text:t.value},{default:n(()=>[s("div",se,i(r(f)(t.value).full_name),1)]),_:2},1032,["text"])]),_:1},8,["value"])]),s("div",le,[s("div",oe,i(e.__("Priority")),1),o(r(T),{options:r(Y)(R)},{default:n(()=>[o(u,{label:e.__(a.value.priority),style:{width:"165px","justify-content":"flex-start"}},{prefix:n(()=>[o(J,{priority:a.value.priority},null,8,["priority"])]),_:1},8,["label"])]),_:1},8,["options"])])]),s("div",ne,[s("div",null,[s("div",ie,i(e.__("Deadline")),1),o(D,{class:"datepicker","icon-left":"calendar",value:a.value.due_date,onChange:l[4]||(l[4]=t=>a.value.due_date=t),placeholder:e.__("Select Due Date"),"input-class":"border-none"},null,8,["value","placeholder"])]),s("div",null,[s("div",re,i(e.__("Remind task")),1),o(D,{class:"datepicker","icon-left":"calendar",value:a.value.remind_task,onChange:l[5]||(l[5]=t=>a.value.remind_task=t),placeholder:e.__("Select Reminder"),"input-class":"border-none",maxDate:a.value.due_date},null,8,["value","placeholder","maxDate"])])])])]),_:1},8,["modelValue","options"])}}},me=$(de,[["__scopeId","data-v-a7fa5aee"]]);export{me as T};
//# sourceMappingURL=TaskModal-3d86a4d5.js.map
